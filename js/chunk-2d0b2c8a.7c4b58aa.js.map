{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/renderers/DictionaryRenderer.js"],"names":["w","x","getLogger","v","e","super","this","_ongoingRequests","Map","_symbolCache","config","fieldMap","scaleExpression","scaleExpressionTitle","url","type","s","scalingExpressionInfo","expression","returnType","t","r","origin","writeVisualVariables","visualVariables","_dictionaryPromise","fetchResources","i","_symbolFields","attributes","o","n","toString","a","get","catch","pop","l","split","p","u","length","indexOf","_itemNames","has","push","substr","map","Number","toRgba","primitiveName","propertyName","value","m","_cimPartsToCIMSymbol","put","collectVVRequiredFields","name","add","error","abortOptions","responseType","query","f","data","authoringInfo","_refSymbolUrlTemplate","cimRefTemplateUrl","Set","itemsNames","symbol","configuration","hasOwnProperty","c","fields","filter","spatialReference","then","scale","repurposeFeature","geometry","evaluate","$feature","$view","reduce","getAttributeHash","JSON","stringify","replace","set","delete","primitiveOverrides","symbolLayers","unshift","Array","_getSymbolPart","_combineSymbolParts","Object","json","read","source","write","target","prototype","String","enabled","S"],"mappings":"kHAAA,WAI2kCA,EAJ3kC,gRAI6kC,MAAMC,EAAE,OAAEC,UAAU,qCAAqC,IAAIC,EAAEH,EAAE,cAAc,cAAD,CAAG,SAAI,YAAYI,GAAGC,MAAMD,GAAGE,KAAKC,iBAAiB,IAAIC,IAAIF,KAAKG,aAAa,IAAI,OAAE,KAAKH,KAAKI,OAAO,KAAKJ,KAAKK,SAAS,KAAKL,KAAKM,gBAAgB,KAAKN,KAAKO,qBAAqB,KAAKP,KAAKQ,IAAI,KAAKR,KAAKS,KAAK,aAAa,UAAUX,EAAEY,GAAGZ,IAAIY,EAAEC,sBAAsB,CAACC,WAAWd,EAAEe,WAAW,WAAW,qBAAqBf,EAAEY,EAAEI,EAAEC,GAAG,MAAMA,GAAGA,EAAEC,QAAQjB,MAAMkB,qBAAqBnB,EAAEY,EAAEI,EAAEC,GAAG,QAAQ,OAAO,IAAIrB,EAAE,CAACU,OAAO,eAAEJ,KAAKI,QAAQE,gBAAgBN,KAAKM,gBAAgBC,qBAAqBP,KAAKO,qBAAqBF,SAAS,eAAEL,KAAKK,UAAUG,IAAI,eAAER,KAAKQ,KAAKU,gBAAgB,eAAElB,KAAKkB,mBAAmB,qBAAqBpB,EAAEY,GAAG,IAAII,EAAEd,KAAKmB,qBAAqBnB,KAAKmB,mBAAmBnB,KAAKoB,eAAeV,IAAI,IAAII,QAAQd,KAAKmB,mBAAmB,MAAMrB,GAAG,GAAG,eAAEA,GAAG,OAAOE,KAAKmB,mBAAmB,KAAK,KAAK,MAAME,EAAE,GAAG,GAAGrB,KAAKK,SAAS,IAAI,MAAMK,KAAKV,KAAKsB,cAAc,CAAC,MAAMR,EAAEd,KAAKK,SAASK,GAAG,GAAGI,GAAG,OAAOhB,EAAEyB,WAAWT,SAAI,IAAShB,EAAEyB,WAAWT,GAAG,CAAC,MAAMC,EAAE,GAAGjB,EAAEyB,WAAWT,GAAGO,EAAEX,GAAGK,OAAOM,EAAEX,GAAG,GAAG,MAAMc,EAAEV,EAAEO,EAAEX,GAAG,IAAIc,GAAG,iBAAiBA,EAAE,OAAO,KAAK,MAAMC,EAAE,eAAED,GAAGE,WAAWC,EAAE3B,KAAKG,aAAayB,IAAIH,GAAG,GAAGE,EAAE,OAAOA,EAAEE,MAAM,KAAM7B,KAAKG,aAAa2B,IAAIL,KAAME,EAAE,MAAMI,EAAEP,EAAEQ,MAAM,KAAKC,EAAE,GAAGC,EAAE,GAAG,IAAI,MAAMpC,KAAKiC,EAAE,GAAGjC,GAAG,IAAIA,EAAEqC,OAAO,IAAI,IAAIrC,EAAEsC,QAAQ,OAAO,IAAI,IAAItC,EAAEsC,QAAQ,KAAK,IAAI,MAAM1B,KAAKZ,EAAEkC,MAAM,KAAKhC,KAAKqC,WAAWC,IAAI5B,IAAIuB,EAAEM,KAAK7B,QAAQV,KAAKqC,WAAWC,IAAIxC,IAAImC,EAAEM,KAAKzC,OAAO,CAAC,MAAMY,EAAEZ,EAAE0C,OAAO,GAAGR,MAAM,KAAK,GAAG,IAAItB,EAAEyB,OAAO,CAAC,MAAMrC,EAAEY,EAAE,GAAGI,EAAEJ,EAAE,GAAG,IAAIK,EAAEL,EAAE,GAAG,GAAG,iBAAiBI,EAAEC,EAAEA,EAAEiB,MAAM,KAAKS,IAAK3C,GAAG4C,OAAO5C,SAAU,GAAG,UAAUgB,EAAE,CAAC,MAAMhB,EAAE,IAAI,OAAEiB,GAAG4B,SAAS5B,EAAE,CAACjB,EAAE,GAAGA,EAAE,GAAGA,EAAE,GAAG,IAAIA,EAAE,SAASiB,EAAE2B,OAAO3B,GAAGmB,EAAEK,KAAK,CAACK,cAAc9C,EAAE+C,aAAa/B,EAAEgC,MAAM/B,KAAK,MAAMgC,EAAE/C,KAAKgD,qBAAqBf,EAAEC,EAAExB,GAAG,OAAOV,KAAKG,aAAa8C,IAAIxB,EAAEsB,EAAE,GAAGA,EAAE,4BAA4BjD,EAAEY,SAASV,KAAKkD,wBAAwBpD,EAAEY,GAAGV,KAAKM,uBAAuB,eAAER,EAAEY,EAAEV,KAAKM,iBAAiB,MAAMQ,EAAEJ,EAAE+B,IAAK3C,GAAGA,EAAEqD,MAAO,IAAI,MAAMzC,KAAKV,KAAKK,SAASS,EAAEsB,QAAQpC,KAAKK,SAASK,IAAI,GAAGZ,EAAEsD,IAAIpD,KAAKK,SAASK,IAAI,qBAAqB,OAAM,EAAG,qBAAqBZ,GAAG,GAAGE,KAAKmB,mBAAmB,OAAOnB,KAAKmB,mBAAmB,IAAInB,KAAKQ,IAAI,YAAYb,EAAE0D,MAAM,iBAAiB,MAAM3C,EAAE,eAAEZ,GAAGA,EAAEwD,aAAa,KAAKvC,EAAE,qBAAEf,KAAKQ,IAAI,yCAAyC,CAAC+C,aAAa,OAAOC,MAAM,CAACC,EAAE,WAAW/C,MAAMgD,KAAKrC,UAAU,eAAE,CAACN,EAAE,mBAAM,IAAIM,EAAE,MAAMrB,KAAKmB,mBAAmB,KAAK,IAAI,OAAE,oCAAoC,wBAAwB,MAAMK,EAAEH,EAAET,WAAWa,EAAEJ,EAAEsC,cAAc3D,KAAK4D,sBAAsB5D,KAAKQ,IAAI,IAAIa,EAAEwC,kBAAkB7D,KAAKqC,WAAW,IAAIyB,IAAIzC,EAAE0C,YAAY/D,KAAKsB,cAAcG,EAAEuC,OAAO,MAAMrC,EAAE,GAAG,GAAG3B,KAAKI,OAAO,CAAC,MAAMN,EAAEE,KAAKI,OAAO,IAAI,MAAMM,KAAKZ,EAAE6B,EAAEjB,GAAGZ,EAAEY,GAAG,IAAI,MAAMZ,KAAK2B,EAAEwC,cAActC,EAAEuC,eAAepE,EAAEqD,QAAQxB,EAAE7B,EAAEqD,MAAMrD,EAAEgD,OAAO,MAAMqB,EAAE,GAAG,GAAG,eAAErE,IAAIA,EAAEsE,QAAQpE,KAAKK,SAAS,IAAI,MAAMK,KAAKV,KAAKsB,cAAc,CAAC,MAAMR,EAAEd,KAAKK,SAASK,GAAGK,EAAEjB,EAAEsE,OAAOC,OAAQvE,GAAGA,EAAEqD,OAAOrC,GAAIC,EAAEoB,OAAO,GAAGgC,EAAE5B,KAAK,IAAIxB,EAAE,GAAGoC,KAAKzC,IAAI,OAAOV,KAAKmB,mBAAmB,eAAEK,EAAE,eAAE1B,GAAGA,EAAEwE,iBAAiB,KAAKH,EAAExC,GAAG4C,KAAMzE,IAAI,MAAMY,EAAE,CAAC8D,MAAM,GAAG,MAAM,CAACzD,EAAEM,KAAK,MAAMG,EAAE1B,EAAE2E,iBAAiB,CAACC,SAAS,KAAKnD,WAAWR,IAAI,OAAOL,EAAE8D,MAAM,eAAEnD,GAAGA,EAAEmD,WAAM,EAAO1E,EAAE6E,SAAS,CAACC,SAASpD,EAAEqD,MAAMnE,OAAQmB,MAAO/B,IAAIH,EAAE0D,MAAM,yCAAyCvD,GAAG,OAAQE,KAAKmB,mBAAmB,YAAY,OAAO,KAAK,aAAa,MAAM,GAAG,mBAAmB,OAAOnB,KAAKkB,iBAAiBlB,KAAKkB,gBAAgB4D,OAAO,CAAEhF,EAAEY,IAAIZ,EAAEY,EAAEqE,mBAAoB,IAAI,cAAc,MAAM,GAAG/E,KAAKQ,OAAOwE,KAAKC,UAAUjF,KAAKK,YAAY,kBAAkB,OAAOL,KAAKsB,cAAc,qBAAqBxB,EAAEY,GAAG,GAAGV,KAAKC,iBAAiBqC,IAAIxC,GAAG,OAAOE,KAAKC,iBAAiB2B,IAAI9B,GAAGyE,KAAMzE,GAAGA,EAAE4D,MAAO,MAAM5C,EAAEd,KAAK4D,sBAAsBsB,QAAQ,iBAAiBpF,GAAGiB,EAAE,qBAAED,EAAE,CAACyC,aAAa,OAAOC,MAAM,CAACC,EAAE,WAAW/C,IAAIV,KAAKC,iBAAiBkF,IAAIrF,EAAEiB,GAAG,IAAI,aAAaA,GAAG2C,KAAK,MAAMhD,GAAG,OAAOV,KAAKC,iBAAiBmF,OAAOtF,GAAG,eAAEY,IAAI,oBAAoBZ,EAAEY,GAAG,IAAIZ,GAAG,IAAIA,EAAEqC,OAAO,OAAO,KAAK,GAAG,IAAIrC,EAAEqC,OAAO,MAAM,CAAC1B,KAAK,qBAAqBuD,OAAOlE,EAAE,GAAGuF,mBAAmB3E,GAAG,MAAMI,EAAE,IAAIhB,EAAE,IAAIgB,EAAEwE,aAAa,GAAG,IAAI,MAAM5E,KAAKZ,EAAE,CAAC,MAAMA,EAAEY,EAAEI,EAAEwE,aAAaC,WAAWzF,EAAEwF,cAAc,MAAM,CAAC7E,KAAK,qBAAqBuD,OAAOlD,EAAEuE,mBAAmB3E,GAAG,2BAA2BZ,EAAEY,EAAEI,GAAG,MAAMC,EAAE,IAAIyE,MAAM1F,EAAEqC,QAAQ,IAAI,IAAIzB,EAAE,EAAEA,EAAEZ,EAAEqC,OAAOzB,IAAIK,EAAEL,GAAGV,KAAKyF,eAAe3F,EAAEY,GAAGI,GAAG,MAAMO,QAAQ,eAAEN,GAAG,OAAO,IAAI,OAAE,CAAC2C,KAAK1D,KAAK0F,oBAAoBrE,EAAEX,OAAO,eAAE,CAAC,eAAE,CAACD,KAAKkF,OAAOC,KAAK,CAACC,KAAK,CAACC,OAAO,iBAAiBC,MAAM,CAACC,OAAO,qBAAqBnG,EAAEoG,UAAU,cAAS,GAAQ,eAAE,CAAC,eAAE,CAACxF,KAAKkF,OAAOC,KAAK,CAACG,OAAM,MAAOlG,EAAEoG,UAAU,gBAAW,GAAQ,eAAE,CAAC,eAAE,CAACxF,KAAKyF,OAAON,KAAK,CAACC,KAAK,CAACC,OAAO,oCAAoCC,OAAM,MAAOlG,EAAEoG,UAAU,uBAAkB,GAAQ,eAAE,CAAC,eAAE,oBAAoBpG,EAAEoG,UAAU,YAAY,MAAM,eAAE,CAAC,eAAE,CAACxF,KAAKyF,OAAON,KAAK,CAACC,KAAK,CAACC,OAAO,+BAA+BC,MAAM,CAACC,OAAO,8BAA8B,eAAelG,GAAG,MAAM,CAACqG,UAAUrG,KAAKE,KAAKM,uBAAuBT,EAAEoG,UAAU,4BAAuB,GAAQ,eAAE,CAAC,eAAE,CAACxF,KAAKyF,OAAON,KAAK,CAACG,OAAM,MAAOlG,EAAEoG,UAAU,WAAM,GAAQ,eAAE,CAAC,eAAE,oBAAoBpG,EAAEoG,UAAU,uBAAuB,MAAMpG,EAAEH,EAAE,eAAE,CAAC,eAAE,sCAAsCG,GAAG,IAAIuG,EAAEvG,EAAiB","file":"js/chunk-2d0b2c8a.7c4b58aa.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../core/has.js\";import{clone as s}from\"../core/lang.js\";import{isSome as t}from\"../core/maybe.js\";import{numericHash as r}from\"../core/string.js\";import i from\"../core/Logger.js\";import\"../core/accessorSupport/ensureType.js\";import{property as o}from\"../core/accessorSupport/decorators/property.js\";import{subclass as n}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as a}from\"../core/accessorSupport/decorators/writer.js\";import l from\"../core/Error.js\";import\"../core/urlUtils.js\";import\"../core/uuid.js\";import\"../portal/support/resourceExtension.js\";import{isAbortError as c,all as p,reject as u}from\"../core/promiseUtils.js\";import{loadArcade as m,createDictionaryExpression as f}from\"../support/arcadeOnDemand.js\";import{collectArcadeFieldNames as h}from\"../layers/support/fieldUtils.js\";import y from\"../Color.js\";import d from\"../symbols/CIMSymbol.js\";import g from\"../request.js\";import b from\"./Renderer.js\";import{VisualVariablesMixin as j}from\"./mixins/VisualVariablesMixin.js\";import _ from\"../core/LRUCache.js\";var w;const x=i.getLogger(\"esri.renderers.DictionaryRenderer\");let v=w=class extends(j(b)){constructor(e){super(e),this._ongoingRequests=new Map,this._symbolCache=new _(100),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type=\"dictionary\"}writeData(e,s){e&&(s.scalingExpressionInfo={expression:e,returnType:\"number\"})}writeVisualVariables(e,s,t,r){null!=r&&r.origin||super.writeVisualVariables(e,s,t,r)}clone(){return new w({config:s(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:s(this.fieldMap),url:s(this.url),visualVariables:s(this.visualVariables)})}async getSymbolAsync(e,s){let t;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(s));try{t=await this._dictionaryPromise}catch(e){if(c(e))return this._dictionaryPromise=null,null}const i={};if(this.fieldMap)for(const s of this._symbolFields){const t=this.fieldMap[s];if(t&&null!==e.attributes[t]&&void 0!==e.attributes[t]){const r=\"\"+e.attributes[t];i[s]=r}else i[s]=\"\"}const o=t(i,s);if(!o||\"string\"!=typeof o)return null;const n=r(o).toString(),a=this._symbolCache.get(n);if(a)return a.catch((()=>{this._symbolCache.pop(n)})),a;const l=o.split(\";\"),p=[],u=[];for(const e of l)if(e&&0!==e.length)if(-1===e.indexOf(\"po:\"))if(-1!==e.indexOf(\"|\"))for(const s of e.split(\"|\"))this._itemNames.has(s)&&p.push(s);else this._itemNames.has(e)&&p.push(e);else{const s=e.substr(3).split(\"|\");if(3===s.length){const e=s[0],t=s[1];let r=s[2];if(\"DashTemplate\"===t)r=r.split(\" \").map((e=>Number(e)));else if(\"Color\"===t){const e=new y(r).toRgba();r=[e[0],e[1],e[2],255*e[3]]}else r=Number(r);u.push({primitiveName:e,propertyName:t,value:r})}}const m=this._cimPartsToCIMSymbol(p,u,s);return this._symbolCache.put(n,m,1),m}async collectRequiredFields(e,s){await this.collectVVRequiredFields(e,s),this.scaleExpression&&await h(e,s,this.scaleExpression);const t=s.map((e=>e.name));for(const s in this.fieldMap)t.indexOf(this.fieldMap[s])<0||e.add(this.fieldMap[s])}get arcadeRequired(){return!0}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void x.error(\"no valid URL!\");const s=t(e)?e.abortOptions:null,r=g(this.url+\"/resources/styles/dictionary-info.json\",{responseType:\"json\",query:{f:\"json\"},...s}),[{data:i}]=await p([r,m()]);if(!i)throw this._dictionaryPromise=null,new l(\"esri.renderers.DictionaryRenderer\",\"Bad dictionary data!\");const o=i.expression,n=i.authoringInfo;this._refSymbolUrlTemplate=this.url+\"/\"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=n.symbol;const a={};if(this.config){const e=this.config;for(const s in e)a[s]=e[s]}for(const e of n.configuration)a.hasOwnProperty(e.name)||(a[e.name]=e.value);const c=[];if(t(e)&&e.fields&&this.fieldMap)for(const s of this._symbolFields){const t=this.fieldMap[s],r=e.fields.filter((e=>e.name===t));r.length>0&&c.push({...r[0],name:s})}return this._dictionaryPromise=f(o,t(e)?e.spatialReference:null,c,a).then((e=>{const s={scale:0};return(r,i)=>{const o=e.repurposeFeature({geometry:null,attributes:r});return s.scale=t(i)?i.scale:void 0,e.evaluate({$feature:o,$view:s})}})).catch((e=>(x.error(\"Creating dictinoary expression failed:\",e),null))),this._dictionaryPromise}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,s)=>e+s.getAttributeHash()),\"\")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._symbolFields}async _getSymbolPart(e,s){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const t=this._refSymbolUrlTemplate.replace(/\\{itemName\\}/gi,e),r=g(t,{responseType:\"json\",query:{f:\"json\"},...s});this._ongoingRequests.set(e,r);try{return(await r).data}catch(s){return this._ongoingRequests.delete(e),u(s)}}_combineSymbolParts(e,s){if(!e||0===e.length)return null;if(1===e.length)return{type:\"CIMSymbolReference\",symbol:e[0],primitiveOverrides:s};const t={...e[0]};t.symbolLayers=[];for(const s of e){const e=s;t.symbolLayers.unshift(...e.symbolLayers)}return{type:\"CIMSymbolReference\",symbol:t,primitiveOverrides:s}}async _cimPartsToCIMSymbol(e,s,t){const r=new Array(e.length);for(let s=0;s<e.length;s++)r[s]=this._getSymbolPart(e[s],t);const i=await p(r);return new d({data:this._combineSymbolParts(i,s)})}};e([o({type:Object,json:{read:{source:\"configuration\"},write:{target:\"configuration\"}}})],v.prototype,\"config\",void 0),e([o({type:Object,json:{write:!0}})],v.prototype,\"fieldMap\",void 0),e([o({type:String,json:{read:{source:\"scalingExpressionInfo.expression\"},write:!0}})],v.prototype,\"scaleExpression\",void 0),e([a(\"scaleExpression\")],v.prototype,\"writeData\",null),e([o({type:String,json:{read:{source:\"scalingExpressionInfo.title\"},write:{target:\"scalingExpressionInfo.title\",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],v.prototype,\"scaleExpressionTitle\",void 0),e([o({type:String,json:{write:!0}})],v.prototype,\"url\",void 0),e([a(\"visualVariables\")],v.prototype,\"writeVisualVariables\",null),v=w=e([n(\"esri.renderers.DictionaryRenderer\")],v);var S=v;export default S;\n"],"sourceRoot":""}