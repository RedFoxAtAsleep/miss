(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b2c8a"],{"261a":function(e,t,s){"use strict";s.r(t);var i,r=s("a4ee"),n=(s("c120"),s("7ffa")),o=s("b2b2"),a=s("b3b6"),l=s("e92d"),c=(s("cea0"),s("59b2")),u=s("d386"),b=s("09db"),h=s("ce50"),p=(s("e041"),s("8eed"),s("f402"),s("f4cc")),f=s("82fa"),d=s("c1da"),y=s("9ef0"),m=s("4cac"),g=s("2eab"),j=s("667b"),O=s("be4d"),w=s("c24e");const _=l["a"].getLogger("esri.renderers.DictionaryRenderer");let v=i=class extends(Object(O["a"])(j["a"])){constructor(e){super(e),this._ongoingRequests=new Map,this._symbolCache=new w["a"](100),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,s,i){null!=i&&i.origin||super.writeVisualVariables(e,t,s,i)}clone(){return new i({config:Object(n["a"])(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:Object(n["a"])(this.fieldMap),url:Object(n["a"])(this.url),visualVariables:Object(n["a"])(this.visualVariables)})}async getSymbolAsync(e,t){let s;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{s=await this._dictionaryPromise}catch(e){if(Object(p["n"])(e))return this._dictionaryPromise=null,null}const i={};if(this.fieldMap)for(const a of this._symbolFields){const t=this.fieldMap[a];if(t&&null!==e.attributes[t]&&void 0!==e.attributes[t]){const s=""+e.attributes[t];i[a]=s}else i[a]=""}const r=s(i,t);if(!r||"string"!=typeof r)return null;const n=Object(a["b"])(r).toString(),o=this._symbolCache.get(n);if(o)return o.catch(()=>{this._symbolCache.pop(n)}),o;const l=r.split(";"),c=[],u=[];for(const a of l)if(a&&0!==a.length)if(-1===a.indexOf("po:"))if(-1!==a.indexOf("|"))for(const e of a.split("|"))this._itemNames.has(e)&&c.push(e);else this._itemNames.has(a)&&c.push(a);else{const e=a.substr(3).split("|");if(3===e.length){const t=e[0],s=e[1];let i=e[2];if("DashTemplate"===s)i=i.split(" ").map(e=>Number(e));else if("Color"===s){const e=new y["a"](i).toRgba();i=[e[0],e[1],e[2],255*e[3]]}else i=Number(i);u.push({primitiveName:t,propertyName:s,value:i})}}const b=this._cimPartsToCIMSymbol(c,u,t);return this._symbolCache.put(n,b,1),b}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Object(d["a"])(e,t,this.scaleExpression);const s=t.map(e=>e.name);for(const i in this.fieldMap)s.indexOf(this.fieldMap[i])<0||e.add(this.fieldMap[i])}get arcadeRequired(){return!0}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void _.error("no valid URL!");const t=Object(o["h"])(e)?e.abortOptions:null,s=Object(g["default"])(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},...t}),[{data:i}]=await Object(p["b"])([s,Object(f["e"])()]);if(!i)throw this._dictionaryPromise=null,new h["a"]("esri.renderers.DictionaryRenderer","Bad dictionary data!");const r=i.expression,n=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=n.symbol;const a={};if(this.config){const e=this.config;for(const t in e)a[t]=e[t]}for(const o of n.configuration)a.hasOwnProperty(o.name)||(a[o.name]=o.value);const l=[];if(Object(o["h"])(e)&&e.fields&&this.fieldMap)for(const o of this._symbolFields){const t=this.fieldMap[o],s=e.fields.filter(e=>e.name===t);s.length>0&&l.push({...s[0],name:o})}return this._dictionaryPromise=Object(f["b"])(r,Object(o["h"])(e)?e.spatialReference:null,l,a).then(e=>{const t={scale:0};return(s,i)=>{const r=e.repurposeFeature({geometry:null,attributes:s});return t.scale=Object(o["h"])(i)?i.scale:void 0,e.evaluate({$feature:r,$view:t})}}).catch(e=>(_.error("Creating dictinoary expression failed:",e),null)),this._dictionaryPromise}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._symbolFields}async _getSymbolPart(e,t){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(e=>e.data);const s=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),i=Object(g["default"])(s,{responseType:"json",query:{f:"json"},...t});this._ongoingRequests.set(e,i);try{return(await i).data}catch(t){return this._ongoingRequests.delete(e),Object(p["t"])(t)}}_combineSymbolParts(e,t){if(!e||0===e.length)return null;if(1===e.length)return{type:"CIMSymbolReference",symbol:e[0],primitiveOverrides:t};const s={...e[0]};s.symbolLayers=[];for(const i of e){const e=i;s.symbolLayers.unshift(...e.symbolLayers)}return{type:"CIMSymbolReference",symbol:s,primitiveOverrides:t}}async _cimPartsToCIMSymbol(e,t,s){const i=new Array(e.length);for(let n=0;n<e.length;n++)i[n]=this._getSymbolPart(e[n],s);const r=await Object(p["b"])(i);return new m["a"]({data:this._combineSymbolParts(r,t)})}};Object(r["a"])([Object(c["b"])({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],v.prototype,"config",void 0),Object(r["a"])([Object(c["b"])({type:Object,json:{write:!0}})],v.prototype,"fieldMap",void 0),Object(r["a"])([Object(c["b"])({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],v.prototype,"scaleExpression",void 0),Object(r["a"])([Object(b["a"])("scaleExpression")],v.prototype,"writeData",null),Object(r["a"])([Object(c["b"])({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],v.prototype,"scaleExpressionTitle",void 0),Object(r["a"])([Object(c["b"])({type:String,json:{write:!0}})],v.prototype,"url",void 0),Object(r["a"])([Object(b["a"])("visualVariables")],v.prototype,"writeVisualVariables",null),v=i=Object(r["a"])([Object(u["a"])("esri.renderers.DictionaryRenderer")],v);var x=v;t["default"]=x}}]);
//# sourceMappingURL=chunk-2d0b2c8a.7c4b58aa.js.map