(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-50b6f093","chunk-2d0d03a7","chunk-2d0d03a7","chunk-2d0d3e74","chunk-2d0d3e74"],{"07c7":function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return S})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return d})),r.d(t,"e",(function(){return f})),r.d(t,"f",(function(){return p})),r.d(t,"g",(function(){return o})),r.d(t,"h",(function(){return y})),r.d(t,"i",(function(){return i})),r.d(t,"j",(function(){return l})),r.d(t,"k",(function(){return h}));var n=r("89da"),a=r("853c"),s=r("66a2");function i(e,t){return c(e.parseTree,t,e.parameters)}function l(e,t,r){return c(e,t,r)}function o(e,t,r,n){return s["WhereClause"].create(c(e.parseTree,a["a"].Standardised,e.parameters,t,r),n)}function u(e,t,r="AND"){return s["WhereClause"].create("(("+i(e,a["a"].Standardised)+")"+r+"("+i(t,a["a"].Standardised)+"))",e.fieldsIndex)}function c(e,t,r,n=null,a=null){let s,i,l,o;switch(e.type){case"interval":return S(c(e.value,t,r,n,a),e.qualifier,e.op);case"case_expression":{let s=" CASE ";"simple"===e.format&&(s+=c(e.operand,t,r,n,a));for(let i=0;i<e.clauses.length;i++)s+=" WHEN "+c(e.clauses[i].operand,t,r,n,a)+" THEN "+c(e.clauses[i].value,t,r,n,a);return null!==e.else&&(s+=" ELSE "+c(e.else,t,r,n,a)),s+=" END ",s}case"param":{const n=r[e.value.toLowerCase()];if("string"==typeof n)return"'"+r[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(n instanceof Date)return d(n,t);if(n instanceof Array){const e=[];for(let r=0;r<n.length;r++)"string"==typeof n[r]?e.push("'"+n[r].toString().replace(/'/g,"''")+"'"):n[r]instanceof Date?e.push(d(n[r],t)):e.push(n[r].toString());return e}return n.toString()}case"expr_list":i=[];for(const s of e.value)i.push(c(s,t,r,n,a));return i;case"unary_expr":return" ( NOT "+c(e.expr,t,r,n,a)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+c(e.left,t,r,n,a)+" AND "+c(e.right,t,r,n,a)+") ";case"OR":return" ("+c(e.left,t,r,n,a)+" OR "+c(e.right,t,r,n,a)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+c(e.left,t,r,n,a)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+c(e.left,t,r,n,a)+" IS NOT NULL )";case"IN":return s=[],"expr_list"===e.right.type?(s=c(e.right,t,r,n,a)," ("+c(e.left,t,r,n,a)+" IN ("+s.join(",")+")) "):(o=c(e.right,t,r,n,a),o instanceof Array?" ("+c(e.left,t,r,n,a)+" IN ("+o.join(",")+")) ":" ("+c(e.left,t,r,n,a)+" IN ("+o+")) ");case"NOT IN":return s=[],"expr_list"===e.right.type?(s=c(e.right,t,r,n,a)," ("+c(e.left,t,r,n,a)+" NOT IN ("+s.join(",")+")) "):(o=c(e.right,t,r,n,a),o instanceof Array?" ("+c(e.left,t,r,n,a)+" NOT IN ("+o.join(",")+")) ":" ("+c(e.left,t,r,n,a)+" NOT IN ("+o+")) ");case"BETWEEN":return l=c(e.right,t,r,n,a)," ("+c(e.left,t,r,n,a)+" BETWEEN "+l[0]+" AND "+l[1]+" ) ";case"NOTBETWEEN":return l=c(e.right,t,r,n,a)," ("+c(e.left,t,r,n,a)+" NOT BETWEEN "+l[0]+" AND "+l[1]+" ) ";case"LIKE":return""!==e.escape?" ("+c(e.left,t,r,n,a)+" LIKE "+c(e.right,t,r,n,a)+" ESCAPE '"+e.escape+"') ":" ("+c(e.left,t,r,n,a)+" LIKE "+c(e.right,t,r,n,a)+") ";case"NOT LIKE":return""!==e.escape?" ("+c(e.left,t,r,n,a)+" NOT LIKE "+c(e.right,t,r,n,a)+" ESCAPE '"+e.escape+"') ":" ("+c(e.left,t,r,n,a)+" NOT LIKE "+c(e.right,t,r,n,a)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+c(e.left,t,r,n,a)+" "+e.operator+" "+c(e.right,t,r,n,a)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return d(e.value,t);case"number":return e.value.toString();case"current_time":return f("date"===e.mode,t);case"column_ref":return n&&n.toLowerCase()===e.column.toLowerCase()?"("+a+")":e.column;case"function":{const s=c(e.args,t,r,n,a);return h(e.name,s,t)}}throw new Error("Unsupported sql syntax "+e.type)}function h(e,t,r){switch(e.toLowerCase().trim()){case"abs":if(1!==t.length)throw new Error("Invalid Parameter for call to ABS");return"abs("+t[0]+")";case"ceiling":case"ceil":if(1!==t.length)throw new Error("Invalid Parameter for call to CEILING");switch(r){case a["a"].Standardised:case a["a"].StandardisedNoInterval:default:return"CEILING("+t[0]+")"}case"floor":if(1!==t.length)throw new Error("Invalid Parameter for call to Floor");return"FLOOR("+t[0]+")";case"log":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG");return"LOG("+t[0]+")";case"log10":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG10");return"LOG10("+t[0]+")";case"power":if(2!==t.length)throw new Error("Invalid Parameter for call to POWER");return"POWER("+t[0]+","+t[1]+")";case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new Error("Invalid Parameter for call to ROUND");case"truncate":if(t.length<1||t.length>2)throw new Error("Invalid Parameter for TRUNCATE function");switch(r){case a["a"].SqlServer:return"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)";default:return"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")")}case"char_length":case"len":if(1!==t.length)throw new Error("Invalid Parameter for CHAR_LENGTH function");switch(r){case a["a"].SqlServer:return"LEN("+t[0]+")";case a["a"].Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"concat":if(t.length<1)throw new Error("Invalid Parameter for CONCAT function");{let e="CONCAT(";for(let r=0;r<t.length;r++)0!==r&&(e+=","),e+=t[r];return e+=")",e}case"lower":case"lcase":if(1!==t.length)throw new Error("Invalid Parameter for Lower function");return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new Error("Invalid Parameter for Upper function");return"UPPER("+t[0]+")";case"substring":{let e="";switch(r){case a["a"].Oracle:return e="SUBSTR("+t[0]+","+t[1],3===t.length&&(e+=","+t[2]),e+=")",e;case a["a"].SqlServer:return e=3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")",e;default:return e="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(e+=" FOR "+t[2]),e+=")",e}}case"extract":return"EXTRACT("+t[0].replace(/\'/g,"")+" FROM "+t[1]+")"}throw new Error("Function Not Recognised")}function d(e,t){const r=n["m"].Moment(e),s=0===r.minute()&&0===r.hour()&&0===r.second()&&0===r.millisecond();switch(t){case a["a"].FILEGDB:case a["a"].Standardised:case a["a"].StandardisedNoInterval:return s?"date '"+r.format("YYYY-MM-DD")+"'":"date '"+r.format("YYYY-MM-DD HH:mm:ss")+"'";case a["a"].Oracle:return s?"TO_DATE('"+r.format("YYYY-MM-DD")+"','YYYY-MM-DD')":"TO_DATE('"+r.format("YYYY-MM-DD HH:mm:ss")+"','YYYY-MM-DD HH24:MI:SS')";case a["a"].SqlServer:return"'"+r.format(s?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";case a["a"].PGDB:return"#"+r.format(s?"MM-DD-YYYY":"MM-DD-YYYY HH:mm:ss")+"#";case a["a"].Postgres:return"TIMESTAMP '"+r.format(s?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";default:return"date '"+r.format("YYYY-MM-DD HH:mm:ss")+"'"}}function f(e,t){switch(t){case a["a"].FILEGDB:case a["a"].Standardised:case a["a"].StandardisedNoInterval:case a["a"].Oracle:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP";case a["a"].SqlServer:return e?"CAST(GETDATE() AS DATE)":"GETDATE()";case a["a"].PGDB:case a["a"].Postgres:default:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP"}}function p(e,t,r={}){const n={},a={},s={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",oid:"integer",long:"integer","small-integer":"integer",integer:"integer",single:"double",double:"double",date:"date",string:"string"};for(const i of t){const e=s[i.type];n[i.name.toLowerCase()]=void 0===e?"":e}for(const i in r){const e=s[r[i]];a[i.toLowerCase()]=void 0===e?"":e}switch(_(n,e.parseTree,e.parameters,a)){case"double":return"double";case"integer":return"integer";case"double":return"double";case"date":return"date";case"string":return"string"}return""}function _(e,t,r,n){let a;switch(t.type){case"interval":return"integer";case"case_expression":{const a=[];if("simple"===t.format){for(let s=0;s<t.clauses.length;s++)a.push(_(e,t.clauses[s].value,r,n));null!==t.else&&a.push(_(e,t.else,r,n))}else{for(let s=0;s<t.clauses.length;s++)a.push(_(e,t.else,r,n));null!==t.else&&a.push(_(e,t.else,r,n))}return m(a)}case"param":{const e=n[t.value.toLowerCase()];if(void 0===e&&r){const e=r[t.value.toLowerCase()];if(void 0===e)return"";if(null===e)return"";if("string"==typeof e||e instanceof String)return"string";if("boolean"==typeof e)return"boolean";if(e instanceof Date)return"date";if("number"==typeof e)return e%1==0?"integer":"double"}return void 0===e?"":e}case"expr_list":{const a=[];for(const s of t.value)a.push(_(e,s,r,n));return a}case"unary_expr":return"boolean";case"binary_expr":switch(t.operator){case"AND":case"OR":return"boolean";case"IS":case"ISNOT":if("null"!==t.right.type)throw new Error("Unsupported RHS for IS");return"boolean";case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":return"boolean";case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"*":case"-":case"+":case"/":return m([_(e,t.left,r,n),_(e,t.right,r,n)]);default:throw new Error("Not Supported Operator "+t.operator)}case"null":return"";case"bool":return"boolean";case"string":return"string";case"number":return null===t.value?"":t.value%1==0?"integer":"double";case"date":case"timestamp":case"current_time":return"date";case"column_ref":{const r=e[t.column.toLowerCase()];return void 0===r?"":r}case"function":switch(t.name.toLowerCase()){case"position":case"extract":case"char_length":return"integer";case"round":return a=_(e,t.args,r,n),a instanceof Array?a.length>0?a[0]:"":a;case"sign":return a=_(e,t.args,r,n),a instanceof Array&&(a=m(a)),"integer"===a||"double"===a?a:"double";case"ceiling":case"floor":case"abs":{const a=_(e,t.args,r,n);return a instanceof Array?m(a):a}case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"round":return a=_(e,t.args,r,n),a instanceof Array?a.length>0?a[0]:"":a}return""}throw new Error("Unsupported sql syntax "+t.type)}const g={boolean:1,string:2,integer:3,double:4,date:5};function m(e){if(e){let t="";for(const r of e)""!==r&&(t=""===t||g[t]<g[r]?r:t);return t}return""}function y(e,t){return w(e.parseTree,t)}function b(e){return"column_ref"===e.parseTree.type}function w(e,t){if(null==e)return!1;switch(e.type){case"when_clause":return w(e.operand,t)||w(e.value,t);case"case_expression":for(const r of e.clauses)if(w(r,t))return!0;return!("simple"!==e.format||!w(e.operand,t))||!(null===e.else||!w(e.else,t));case"param":return!1;case"expr_list":for(const r of e.value)if(w(r,t))return!0;return!1;case"unary_expr":return w(e.expr,t);case"binary_expr":return w(e.left,t)||w(e.right,t);case"null":case"bool":case"date":case"timestamp":case"string":case"number":return!1;case"column_ref":return t.toLowerCase()===e.column.toLowerCase();case"function":return w(e.args,t)}return!1}function v(e){let t="";return t+=e.period.toUpperCase(),t}function S(e,t,r){let n="";return n="interval-period"===t.type?v(t):v(t.start)+" TO "+v(t.end),"INTERVAL "+r+" "+e+" "+n}},"0f1c":function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return p}));var n=r("b2b2"),a=r("4c37"),s=r("fc29"),i=r("2c4f");const l=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function o(e){return e instanceof s["a"]}function u(e){return e instanceof i["a"]?Object.keys(e.items):o(e)?Object(a["a"])(e).keys():e?Object.keys(e):[]}function c(e,t){return e instanceof i["a"]?e.items[t]:e[t]}function h(e){return e?e.declaredClass:null}function d(e,t){const r=e.diff;if(r&&"function"==typeof r)return r(e,t);const a=u(e),s=u(t);if(0===a.length&&0===s.length)return;if(!a.length||!s.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const i=s.filter(e=>-1===a.indexOf(e)),f=a.filter(e=>-1===s.indexOf(e)),p=a.filter(r=>s.indexOf(r)>-1&&c(e,r)!==c(t,r)).concat(i,f).sort(),_=h(e);if(_&&l.indexOf(_)>-1&&p.length)return{type:"complete",oldValue:e,newValue:t};let g;const m=o(e)&&o(t);for(const l of p){const a=c(e,l),s=c(t,l);let i;(m||"function"!=typeof a&&"function"!=typeof s)&&a!==s&&(null==a&&null==s||(i=r&&r[l]&&"function"==typeof r[l]?r[l](a,s):"object"==typeof a&&"object"==typeof s&&h(a)===h(s)?d(a,s):{type:"complete",oldValue:a,newValue:s},Object(n["h"])(i)&&(Object(n["h"])(g)?g.diff[l]=i:g={type:"partial",diff:{[l]:i}})))}return g}function f(e,t){if(Object(n["g"])(e))return!1;const r=t.split(".");let a=e;for(const n of r){if("complete"===a.type)return!0;if("partial"!==a.type)return!1;{const e=a.diff[n];if(!e)return!1;a=e}}return!0}function p(e,t){for(const r of t)if(f(e,r))return!0;return!1}function _(e,t){if("function"!=typeof e&&"function"!=typeof t&&(e||t))return!e||!t||"object"==typeof e&&"object"==typeof t&&h(e)!==h(t)?{type:"complete",oldValue:e,newValue:t}:d(e,t)}},"18df":function(e,t,r){"use strict";var n=r("f4cc"),a=r("853c"),s=r("64fc"),i=r("4f73");t["a"]=class extends i["a"]{constructor(e){super(e),this.declaredClass="esri.layers.featureset.sources.Empty",this._maxProcessing=1e3,this._wset=new s["a"]([],[],!1,null),this._parent=e.parentfeatureset,this._databaseType=a["a"].Standardised}_getSet(){return Object(n["u"])(this._wset)}optimisePagingFeatureQueries(){}_isInFeatureSet(){return a["b"].NotInFeatureSet}_getFeature(){return Object(n["t"])(new Error("No Feature Found in EmptySet"))}queryAttachments(){return Object(n["u"])([])}_getFeatures(){return Object(n["u"])("success")}_featureFromCache(){return null}_fetchAndRefineFeatures(){return Object(n["t"])(new Error("Fetch and Refine should not be called in this featureset"))}_getFilteredSet(){return Object(n["u"])(new s["a"]([],[],!1,null))}_stat(e,t,r,n,a,s,i){return this._manualStat(e,t,s,i)}_canDoAggregates(){return Object(n["u"])(!1)}}},"1fbd":function(e,t,r){"use strict";class n{constructor(){this._databaseTypeMetaData={},this._layerInfo={}}clearDatabaseType(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]}getDatabaseType(e){return"MUSTBESET"===e||void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]}setDatabaseType(e,t){this._databaseTypeMetaData[e]=t}getLayerInfo(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]}setLayerInfo(e,t){this._layerInfo[e]=t}clearLayerInfo(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]}}n.applicationCache=null,t["a"]=n},"2cad":function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return g})),r.d(t,"e",(function(){return _}));var n=r("f4cc"),a=r("5996"),s=r("8d60"),i=r("853c"),l=r("8549"),o=r("64fc"),u=r("66a2"),c=r("07c7"),h=r("4f73");class d{constructor(){this.sqlRewritable=!1}postInitialization(e,t){}}class f extends d{constructor(e){super(),this.field=e,this.sqlRewritable=!0}extractValue(e){return e.attributes[this.field.name]}rewriteSql(e){return{rewritten:this.sqlRewritable,where:e}}}class p extends d{constructor(e,t,r){super(),this.originalField=e,this.sqlRewritable=!0,this.field=Object(i["c"])(e),this.field.name=t,this.field.alias=r}rewriteSql(e,t){return{rewritten:this.sqlRewritable,where:Object(c["g"])(e,this.field.name,this.originalField.name,t.getFieldsIndex())}}extractValue(e){return e.attributes[this.originalField.name]}}class _ extends d{constructor(e,t,r){super(),this.field=e,this.codefield=t,this.lkp=r,this.reverseLkp={};for(const n in r)this.reverseLkp[r[n]]=n;this.sqlRewritable=!0}rewriteSql(e,t){const r=this.evaluateNodeToWhereClause(e.parseTree,i["a"].Standardised,this.field.name,this.codefield instanceof u["WhereClause"]?Object(c["i"])(this.codefield,i["a"].Standardised):this.codefield,e.parameters);return r.indexOf(_.BADNESS)>=0?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:u["WhereClause"].create(r,t._parent.getFieldsIndex())}}evaluateNodeToWhereClause(e,t,r=null,n=null,a){let s,i,l,o;switch(e.type){case"interval":return Object(c["b"])(this.evaluateNodeToWhereClause(e.value,t,r,n,a),e.qualifier,e.op);case"case_expression":{let n=" CASE ";"simple"===e.format&&(n+=this.evaluateNodeToWhereClause(e.operand,t,r,_.BADNESS,a));for(let s=0;s<e.clauses.length;s++)n+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[s].operand,t,r,_.BADNESS,a)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[s].value,t,r,_.BADNESS,a);return null!==e.else&&(n+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,r,_.BADNESS,a)),n+=" END ",n}case"param":{const r=a[e.value.toLowerCase()];if("string"==typeof r)return"'"+a[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(r instanceof Date)return Object(c["d"])(r,t);if(r instanceof Array){const e=[];for(let n=0;n<r.length;n++)"string"==typeof r[n]?e.push("'"+r[n].toString().replace(/'/g,"''")+"'"):r[n]instanceof Date?e.push(Object(c["d"])(r[n],t)):e.push(r[n].toString());return e}return r.toString()}case"expr_list":i=[];for(const s of e.value)i.push(this.evaluateNodeToWhereClause(s,t,r,n,a));return i;case"unary_expr":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,r,_.BADNESS,a)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" AND "+this.evaluateNodeToWhereClause(e.right,t,r,n,a)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" OR "+this.evaluateNodeToWhereClause(e.right,t,r,n,a)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" IS NOT NULL )";case"IN":if(s=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){const s=[];let i=!0;for(const t of e.right.value){if("string"!==t.type){i=!1;break}if(void 0===this.lkp[t.value]){i=!1;break}s.push(this.lkp[t.value].toString())}if(i)return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" IN ("+s.join(",")+")) "}return s=this.evaluateNodeToWhereClause(e.right,t,r,n,a)," ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" IN ("+s.join(",")+")) "}return o=this.evaluateNodeToWhereClause(e.right,t,r,n,a),o instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" IN ("+o.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" IN ("+o+")) ";case"NOT IN":if(s=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){const s=[];let i=!0;for(const t of e.right.value){if("string"!==t.type){i=!1;break}if(void 0===this.lkp[t.value]){i=!1;break}s.push(this.lkp[t.value].toString())}if(i)return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" NOT IN ("+s.join(",")+")) "}return s=this.evaluateNodeToWhereClause(e.right,t,r,n,a)," ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" NOT IN ("+s.join(",")+")) "}return o=this.evaluateNodeToWhereClause(e.right,t,r,n,a),o instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" NOT IN ("+o.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,a)+" NOT IN ("+o+")) ";case"BETWEEN":return l=this.evaluateNodeToWhereClause(e.right,t,r,_.BADNESS,a)," ("+this.evaluateNodeToWhereClause(e.left,t,r,_.BADNESS,a)+" BETWEEN "+l[0]+" AND "+l[1]+" ) ";case"NOTBETWEEN":return l=this.evaluateNodeToWhereClause(e.right,t,r,_.BADNESS,a)," ("+this.evaluateNodeToWhereClause(e.left,t,r,_.BADNESS,a)+" NOT BETWEEN "+l[0]+" AND "+l[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,_.BADNESS,a)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,_.BADNESS,a)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,_.BADNESS,a)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,_.BADNESS,a)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,_.BADNESS,a)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,_.BADNESS,a)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,_.BADNESS,a)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,_.BADNESS,a)+") ";case"<>":case"=":if("column_ref"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+n+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column_ref"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+n+") ";return" ("+this.evaluateNodeToWhereClause(e.left,t,r,_.BADNESS,a)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,_.BADNESS,a)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,_.BADNESS,a)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,_.BADNESS,a)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return Object(c["d"])(e.value,t);case"number":return e.value.toString();case"current_time":return Object(c["e"])("date"===e.mode,t);case"column_ref":return r&&r.toLowerCase()===e.column.toLowerCase()?"("+n+")":e.column;case"function":{const n=this.evaluateNodeToWhereClause(e.args,t,r,_.BADNESS,a);return Object(c["k"])(e.name,n,t)}}throw new Error("Unsupported sql syntax "+e.type)}extractValue(e){return this.codefield instanceof u["WhereClause"]?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]}}_.BADNESS="_!!!_BAD_LKP_!!!!";class g extends d{constructor(e,t){super(),this.field=e,this.sql=t}rewriteSql(e,t){return{rewritten:!0,where:Object(c["g"])(e,this.field.name,Object(c["i"])(this.sql,i["a"].Standardised),t.getFieldsIndex())}}extractValue(e){return this.sql.calculateValueCompiled(e)}}class m extends h["a"]{constructor(e){super(e),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=null,this._extraFilter=null,this._extraFilter=e.extraFilter,this._parent=e.parentfeatureset,this._maxProcessing=30,this.adaptedFields=e.adaptedFields}static findField(e,t){for(const r of e)if(r.name.toLowerCase()===t.toString().toLowerCase())return r;return null}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new a["a"]({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=i["m"].point,this.typeIdField="",this.types=null),this.fields=[];for(const e of this.adaptedFields)e.postInitialization(this,this._parent),this.fields.push(e.field)}_getSet(e){return null===this._wset?this._ensureLoaded().then(()=>this._extraFilter?this._getFilteredSet("",null,null,null,e):this._parent._getSet(e)).then(t=>(this._checkCancelled(e),this._wset=new o["a"](t._candidates.slice(0),t._known.slice(0),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset)):Object(n["u"])(this._wset)}_isInFeatureSet(e){return this._parent._isInFeatureSet(e)}_getFeatures(e,t,r,a){const i=[];-1!==t&&void 0===this._featureCache[t]&&i.push(t);const u=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,u))return this._expandPagedSet(e,u,0,0,a).then(()=>this._getFeatures(e,t,r,a));let c=0;for(let n=e._lastFetchedIndex;n<e._known.length&&(c++,c<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[n]]&&(e._known[n]!==t&&i.push(e._known[n]),i.length>=u-1)));n++);if(0===i.length)return Object(n["u"])("success");e=new o["a"]([],i,e._ordered,null);const h=Math.min(i.length,r);return this._parent._getFeatures(e,-1,h,a).then(()=>{this._checkCancelled(a);const e=[];for(let t=0;t<h;t++){const r=this._parent._featureFromCache(i[t]);void 0!==r&&e.push({geometry:r.geometry,attributes:r.attributes,id:i[t]})}for(const t of e){const e=[];for(const r of this.adaptedFields)e[r.field.name]=r.extractValue(t);this._featureCache[t.id]=new s["a"]({attributes:e,geometry:Object(l["a"])(t.geometry)})}return"success"})}_fetchAndRefineFeatures(){return Object(n["t"])(new Error("Fetch and Refine should not be called in this featureset"))}_getFilteredSet(e,t,r,n,a){let s=!1;const i=this.reformulateWithoutAdaptions(r);s=i.cannot,r=i.where;let l=!1;if(null!==n){l=!0;const e=[];for(const t of this.adaptedFields)if(!(t instanceof f)&&!0===n.scanForField(t.field.name)){if(!(t instanceof p)){n=null,l=!1;break}e.push({field:t.field.name,newfield:t.originalField.name})}n&&e.length>0&&(n=n.replaceFields(e))}return null!==r?null!==this._extraFilter&&(r=Object(c["a"])(this._extraFilter,r)):r=this._extraFilter,this._ensureLoaded().then(()=>this._parent._getFilteredSet(e,t,r,n,a)).then(e=>{let t;return this._checkCancelled(a),t=!0===s?new o["a"](e._candidates.slice(0).concat(e._known.slice(0)),[],!0===l&&e._ordered,this._clonePageDefinition(e.pagesDefinition)):new o["a"](e._candidates.slice(0),e._known.slice(0),!0===l&&e._ordered,this._clonePageDefinition(e.pagesDefinition)),t})}reformulateWithoutAdaptions(e){const t={cannot:!1,where:e};if(null!==e)for(const r of this.adaptedFields)if(!0===Object(c["h"])(e,r.field.name)){const n=r.rewriteSql(e,this);if(!0!==n.rewritten){t.cannot=!0,t.where=null;break}t.where=n.where}return t}_stat(e,t,r,a,s,i,l){let o=!1,u=this.reformulateWithoutAdaptions(t);return o=u.cannot,t=u.where,u=this.reformulateWithoutAdaptions(s),o=o||u.cannot,null!==(s=u.where)?null!==this._extraFilter&&(s=Object(c["a"])(this._extraFilter,s)):s=this._extraFilter,!0===o?null===s&&""===r&&null===a?this._manualStat(e,t,i,l):Object(n["u"])({calculated:!1}):this._parent._stat(e,t,r,a,s,i,l).then(n=>!1===n.calculated?null===s&&""===r&&null===a?this._manualStat(e,t,i,l):{calculated:!1}:n)}_canDoAggregates(e,t,r,a,s){if(null===this._parent)return Object(n["u"])(!1);for(let o=0;o<e.length;o++)for(const t of this.adaptedFields)if(e[o].toLowerCase()===t.field.name.toLowerCase()&&!(t instanceof f))return Object(n["u"])(!1);const i=[];for(let o=0;o<t.length;o++){const e=t[o];if(null!==e.workingexpr){const t=this.reformulateWithoutAdaptions(e.workingexpr);if(t.cannot)return Object(n["u"])(!1);const r=e.clone();r.workingexpr=t.where,i.push(r)}else i.push(e)}const l=this.reformulateWithoutAdaptions(s);return l.cannot?Object(n["u"])(!1):(null!==(s=l.where)?null!==this._extraFilter&&(s=Object(c["a"])(this._extraFilter,s)):s=this._extraFilter,this._parent._canDoAggregates(e,i,r,a,s))}_getAggregatePagesDataSourceDefinition(e,t,r,a,s,i,l){if(null===this._parent)return Object(n["t"])(new Error("Should never be called"));const o=[];for(let c=0;c<t.length;c++){const e=t[c];if(null!==e.workingexpr){const t=this.reformulateWithoutAdaptions(e.workingexpr);if(t.cannot)return Object(n["t"])(new Error("Should never be called"));const r=e.clone();r.workingexpr=t.where,o.push(r)}else o.push(e)}const u=this.reformulateWithoutAdaptions(s);return u.cannot?Object(n["t"])(new Error("Should never be called")):(null!==(s=u.where)?null!==this._extraFilter&&(s=Object(c["a"])(this._extraFilter,s)):s=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,o,r,a,s,i,l))}}},3802:function(e,t,r){"use strict";var n=r("f4cc"),a=r("3760"),s=r("8d60"),i=r("a1f3"),l=r("853c"),o=r("64fc"),u=r("07c7"),c=r("4f73"),h=r("a2b1"),d=r("c64f"),f=r("5bd5");class p extends c["a"]{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,!0===e.isTable&&(this._forceIsTable=!0),void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return l["f"]}end(){return this._layer}optimisePagingFeatureQueries(){}load(){return null===this._loadPromise&&(this._loadPromise=Object(n["c"])((e,t)=>{if(!0===this._layer.loaded)return this._initialiseFeatureSet(),void e(this);this._layer.when().then(()=>{try{this._initialiseFeatureSet(),e(this)}catch(e){t(e)}},t),this._layer.load()})),this._loadPromise}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{const e=[];for(const t of this.fields)if("oid"===t.type)e.push(t);else for(const r of this._layer.outFields)if(r.toLowerCase()===t.name.toLowerCase()){e.push(t);break}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=l["a"].Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}isTable(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return l["b"].InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){return null===this._wset?this._ensureLoaded().then(()=>this._getFilteredSet("",null,null,null,e)).then(e=>(this._wset=e,e)):Object(n["u"])(this._wset)}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new s["a"]({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,t,r,a,s){let i="",c=!1;if(null!==a&&(i=a.constructClause(),c=!0),this.isTable()&&t&&null!==e&&""!==e){const e=new o["a"]([],[],!0,null);return Object(n["u"])(e)}const h=new d["a"];return h.where=null===r?null===t?"1=1":"":Object(u["i"])(r,l["a"].Standardised),h.spatialRelationship=this._makeRelationshipEnum(e),h.outSpatialReference=this.spatialReference,h.orderByFields=""!==i?i.split(","):null,h.geometry=null===t?null:t,h.returnGeometry=!0,h.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(h).then(e=>{if(null===e)return new o["a"]([],[],c,null);this._checkCancelled(s);const t=[];return e.features.forEach(e=>{const r=e.attributes[this._layer.objectIdField];t.push(r),this._featureCache[r]=this._changeFeature(e)}),new o["a"]([],t,c,null)})}_makeRelationshipEnum(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""}_queryAllFeatures(){if(this._wset)return Object(n["u"])(this._wset);const e=new d["a"];return e.where="1=1",this._ensureLoaded().then(()=>{if(this._layer.source&&this._layer.source.items){const e=[];return this._layer.source.items.forEach(t=>{const r=t.attributes[this._layer.objectIdField];e.push(r),this._featureCache[r]=this._changeFeature(t)}),this._wset=new o["a"]([],e,!1,null),this._wset}return this._layer.queryFeatures(e).then(e=>{const t=[];return e.features.forEach(e=>{const r=e.attributes[this._layer.objectIdField];t.push(r),this._featureCache[r]=this._changeFeature(e)}),this._wset=new o["a"]([],t,!1,null),this._wset})})}_getFeatures(e,t,r){const a=[];-1!==t&&void 0===this._featureCache[t]&&a.push(t);for(let n=e._lastFetchedIndex;n<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[n]]&&(e._known[n]!==t&&a.push(e._known[n]),a.length>r)));n++);return 0===a.length?Object(n["u"])("success"):Object(n["t"])(new Error("Unaccounted for Features. Not in Feature Collection"))}_refineSetBlock(e){return Object(n["u"])(e)}_stat(){return Object(n["u"])({calculated:!1})}_canDoAggregates(){return Object(n["u"])(!1)}relationshipMetaData(){return[]}static _cloneAttr(e){const t={};for(const r in e)t[r]=e[r];return t}nativeCapabilities(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(e,t){let r=e.layerDefinition.objectIdField;const n=e.layerDefinition.typeIdField?e.layerDefinition.typeIdField:"",s=[];if(e.layerDefinition.types)for(const a of e.layerDefinition.types)s.push(h["a"].fromJSON(a));let l=e.layerDefinition.geometryType;void 0===l&&(l=e.featureSet.geometryType||"");let o=e.featureSet.features;const u=t.toJSON();if(""===r||void 0===r){let t=!1;for(const n of e.layerDefinition.fields)if("oid"===n.type||"esriFieldTypeOID"===n.type){r=n.name,t=!0;break}if(!1===t){let t="FID",n=!0,a=0;for(;n;){let r=!0;for(const n of e.layerDefinition.fields)if(n.name===t){r=!1;break}!0===r?n=!1:(a++,t="FID"+a.toString())}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:t,alias:t});const s=[];for(let r=0;r<o.length;r++)s.push({geometry:e.featureSet.features[r].geometry,attributes:e.featureSet.features[r].attributes?this._cloneAttr(e.featureSet.features[r].attributes):{}}),s[r].attributes[t]=r;o=s,r=t}}const c=[];for(const a of e.layerDefinition.fields)a instanceof i["a"]?c.push(a):c.push(i["a"].fromJSON(a));let d=l;switch(d){case"esriGeometryPoint":d="point";break;case"esriGeometryPolyline":d="polyline";break;case"esriGeometryPolygon":d="polygon";break;case"esriGeometryExtent":d="extent";break;case"esriGeometryMultipoint":d="multipoint"}for(const i of o)i.geometry&&i.geometry instanceof a["a"]==0&&(i.geometry.type=d,void 0===i.geometry.spatialReference&&(i.geometry.spatialReference=u));const _={outFields:["*"],source:o,fields:c,types:s,typeIdField:n,objectIdField:r,spatialReference:t};_.geometryType=d||"point";const g=new f["default"](_);return new p({layer:g,spatialReference:t,isTable:null===d||""===d})}queryAttachments(){return Object(n["u"])([])}getFeatureByObjectId(e){const t=new d["a"];return t.where=this.objectIdField+"="+e.toString(),this._layer.queryFeatures(t).then(e=>1===e.features.length?e.features[0]:null)}getOwningSystemUrl(){return Object(n["u"])("")}getIdentityUser(){return Object(n["u"])("")}}t["a"]=p},"4f73":function(e,t,r){"use strict";var n=r("f4cc"),a=r("5996"),s=r("853c"),i=r("bb51"),l=class{constructor(e,t){this._lastId=-1,this._progress=t,this._parent=e}reset(){this._lastId=-1}nextBatch(e){if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then(t=>this.nextBatch(e),t=>this.nextBatch(e));const t={returnpromise:null,hasset:!1},r=[];return t.returnpromise=Object(n["c"])((n,a)=>{this._parent._getSet(this._progress).then(s=>{let i=s._known.length-1;if("GETPAGES"===s._known[s._known.length-1]&&(i-=1),this._lastId+e>i&&s._known.length>0&&"GETPAGES"===s._known[s._known.length-1])this._parent._expandPagedSet(s,this._parent._maxQueryRate(),0,0,this._progress).then(r=>{t.hasset=!0,this._parent._mainSetInUse=null,this.nextBatch(e).then(n,a)},e=>{t.hasset=!0,this._parent._mainSetInUse=null,a(e)});else{if(i>=this._lastId+e||0===s._candidates.length){for(let t=0;t<e;t++){const e=t+this._lastId+1;if(e>=s._known.length)break;r[t]=s._known[e]}return this._lastId+=r.length,0===r.length&&(t.hasset=!0,this._parent._mainSetInUse=null,n([])),void this._parent._getFeatureBatch(r,this._progress).then(e=>{t.hasset=!0,this._parent._mainSetInUse=null,n(e)},e=>{t.hasset=!0,this._parent._mainSetInUse=null,a(e)})}this._parent._refineSetBlock(s,this._parent._maxProcessingRate(),this._progress).then(()=>{t.hasset=!0,this._parent._mainSetInUse=null,this.nextBatch(e).then(n,a)},e=>{t.hasset=!0,this._parent._mainSetInUse=null,a(e)})}},e=>{t.hasset=!0,this._parent._mainSetInUse=null,a(e)})}),!1===t.hasset&&(this._parent._mainSetInUse=t.returnpromise,t.hasset=!0),t.returnpromise}next(){if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then(e=>this.next(),e=>this.next());const e={returnpromise:null,hasset:!1};return e.returnpromise=Object(n["c"])((t,r)=>{this._parent._getSet(this._progress).then(n=>{this._lastId<n._known.length-1?"GETPAGES"===n._known[this._lastId+1]?this._parent._expandPagedSet(n,this._parent._maxQueryRate(),0,0,this._progress).then(t=>(e.hasset=!0,this._parent._mainSetInUse=null,this.next())).then(t,r):(this._lastId+=1,this._parent._getFeature(n,n._known[this._lastId],this._progress).then(r=>{e.hasset=!0,this._parent._mainSetInUse=null,t(r)},t=>{e.hasset=!0,this._parent._mainSetInUse=null,r(t)})):n._candidates.length>0?this._parent._refineSetBlock(n,this._parent._maxProcessingRate(),this._progress).then(()=>{e.hasset=!0,this._parent._mainSetInUse=null,this.next().then(t,r)},t=>{e.hasset=!0,this._parent._mainSetInUse=null,r(t)}):(e.hasset=!0,this._parent._mainSetInUse=null,t(null))},t=>{e.hasset=!0,this._parent._mainSetInUse=null,r(t)})}),!1===e.hasset&&(this._parent._mainSetInUse=e.returnpromise,e.hasset=!0),e.returnpromise}count(){return-1!==this._parent._totalCount?Object(n["u"])(this._parent._totalCount):this._parent._getSet(this._progress).then(e=>this._refineAllSets(e)).then(e=>(this._parent._totalCount=e._known.length,Object(n["u"])(this._parent._totalCount)))}_refineAllSets(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,1,this._progress).then(t=>this._refineAllSets(e)).then(e=>Object(n["u"])(e)):e._candidates.length>0?"GETPAGES"===e._known[e._candidates.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,2,this._progress).then(t=>this._refineAllSets(e)).then(e=>Object(n["u"])(e)):this._parent._refineSetBlock(e,this._parent._maxProcessingRate(),this._progress).then(e=>e._candidates.length>0?this._refineAllSets(e):Object(n["u"])(e)):Object(n["u"])(e)}},o=r("64fc"),u=r("1fbd"),c=r("66a2"),h=r("b1dc"),d=r("80b7");class f{constructor(e){this.recentlyUsedQueries=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=s["a"].NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.types=null,this.fields=null,this.geometryType="",this.objectIdField="",this.globalIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,e&&e.lrucache&&(this.recentlyUsedQueries=e.lrucache)}optimisePagingFeatureQueries(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)}_hasMemorySource(){return!0}prop(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)}end(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent}_ensureLoaded(){return this.load()}load(){return null===this._loadPromise&&(this._loadPromise=Object(n["c"])((e,t)=>{if(!0===this._parent.loaded)return this._initialiseFeatureSet(),void e(this);this._parent.load().then(()=>{try{this._initialiseFeatureSet(),e(this)}catch(e){t(e)}},t)})),this._loadPromise}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new a["a"]({wkid:4326}),this.geometryType=s["m"].point)}getField(e,t){let r;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some(t=>(t&&t.name.toLowerCase()===e&&(r=t),!!r))),r}getFieldsIndex(){return null===this._fieldsIndex&&(this._fieldsIndex=new d["a"](this.fields)),this._fieldsIndex}_maxProcessingRate(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())}_maxQueryRate(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery}_checkCancelled(e){if(null!==e&&e.aborted)throw new Error("Operation has been cancelled.")}nativeCapabilities(){return this._parent.nativeCapabilities()}_canDoAggregates(e,t,r,a,s){return null===this._parent?Object(n["u"])(!1):this._parent._canDoAggregates(e,t,r,a,s)}_getAggregatePagesDataSourceDefinition(e,t,r,a,s,i,l){return null===this._parent?Object(n["t"])(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,r,a,s,i,l)}_getAgregagtePhysicalPage(e,t,r){return null===this._parent?Object(n["t"])(new Error("Should never be called")):this._parent._getAgregagtePhysicalPage(e,t,r)}databaseType(){if(this._databaseType===s["a"].NotEvaluated){if(null!==u["a"].applicationCache){const e=u["a"].applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==e)return e}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;const e=[{thetype:s["a"].SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:s["a"].Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:s["a"].StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}];let t=Object(n["c"])((t,r)=>{this._getDatabaseTypeImpl(e,0).then(e=>{this._databaseType=e,t(this._databaseType)},e=>{r(e)})});return null!==u["a"].applicationCache&&(u["a"].applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),t),t=t.catch(e=>{throw u["a"].applicationCache.clearDatabaseType(this._cacheableFeatureSetSourceKey()),e})),this._databaseTypeProbed=t,this._databaseTypeProbed}return Object(n["u"])(this._databaseType)}_cacheableFeatureSetSourceKey(){return"MUSTBESET"}_getDatabaseTypeImpl(e,t){return t>=e.length?Object(n["u"])(s["a"].StandardisedNoInterval):this._runDatabaseProbe(e[t].testwhere).then(r=>!0===r?e[t].thetype:this._getDatabaseTypeImpl(e,t+1))}_runDatabaseProbe(e){return null!==this._parent?this._parent._runDatabaseProbe(e):Object(n["t"])(new Error("Not Implemented"))}isTable(){return this._parent.isTable()}_featureFromCache(e){if(void 0!==this._featureCache[e])return this._featureCache[e]}_isInFeatureSet(e){return s["b"].Unknown}_getSet(e){throw new Error("Not implemented in abstract class")}_getFeature(e,t,r){try{return this._checkCancelled(r),void 0!==this._featureFromCache(t)?Object(n["u"])(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),r).then(()=>(this._checkCancelled(r),void 0!==this._featureFromCache(t)?this._featureFromCache(t):Object(n["t"])(new Error("Feature Not Found"))))}catch(e){return Object(n["t"])(e)}}_getFeatureBatch(e,t){try{this._checkCancelled(t);const r=new o["a"]([],e,!1,null),n=[];return this._getFeatures(r,-1,e.length,t).then(()=>{this._checkCancelled(t);for(const t of e)void 0!==this._featureFromCache(t)&&n.push(this._featureFromCache(t));return n})}catch(e){return Object(n["t"])(e)}}_getFeatures(e,t,r,a){return Object(n["u"])("success")}_getFilteredSet(e,t,r,n,a){throw new Error("Not implemented in abstract class")}_refineSetBlock(e,t,r){try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate()))return this._expandPagedSet(e,this._maxQueryRate(),0,0,r).then(()=>this._refineSetBlock(e,t,r));this._checkCancelled(r);const a=e._candidates.length;this._refineKnowns(e,t);let s=a-e._candidates.length;return 0===e._candidates.length||s>=t?Object(n["u"])(e):this._refineIfParentKnown(e,t-s,r).then(()=>{if(this._checkCancelled(r),this._refineKnowns(e,t-s),s=a-e._candidates.length,s<t&&e._candidates.length>0){const n=t-s,a=this._prepareFetchAndRefineSet(e._candidates);return this._fetchAndRefineFeatures(a,a.length>n?n:e._candidates.length,r).then(()=>(this._checkCancelled(r),this._refineKnowns(e,t-s),e))}return e})}catch(e){return Object(n["t"])(e)}}_fetchAndRefineFeatures(e,t,r){return null}_prepareFetchAndRefineSet(e){const t=[];for(let r=0;r<e.length;r++)this._isPhysicalFeature(e[r])&&t.push(e[r]);return t}_isPhysicalFeature(e){return null===this._parent||this._parent._isPhysicalFeature(e)}_refineKnowns(e,t){let r=0,n=null;const a=[];t=this._maxQueryRate();for(let i=0;i<e._candidates.length&&"GETPAGES"!==e._candidates[i];i++){let l=!1;const o=this._candidateIdTransform(e._candidates[i]);o!==e._candidates[i]&&(l=!0);const u=this._isInFeatureSet(o);if(u===s["b"].InFeatureSet)!0===l?e._known.indexOf(o)<0&&(e._known.push(o),r+=1):(e._known.push(e._candidates[i]),r+=1),null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i});else if(u===s["b"].NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),r+=1;else if(u===s["b"].Unknown&&(r+=1,!0===e._ordered))break;if(r>=t)break}null!==n&&a.push(n);for(let s=a.length-1;s>=0;s--)e._candidates.splice(a[s].start,a[s].end-a[s].start+1)}_refineIfParentKnown(e,t,r){const n=new o["a"]([],[],e._ordered,null);return n._candidates=e._candidates.slice(0),this._parent._refineSetBlock(n,t,r)}_candidateIdTransform(e){return this._parent._candidateIdTransform(e)}_checkIfNeedToExpandKnownPage(e,t){if(null===e.pagesDefinition)return!1;let r=0;for(let n=e._lastFetchedIndex;n<e._known.length;n++){if("GETPAGES"===e._known[n])return!0;if(void 0===this._featureCache[e._known[n]]&&(r+=1,r>=t))break}return!1}_checkIfNeedToExpandCandidatePage(e,t){if(null===e.pagesDefinition)return!1;let r=0;for(let n=0;n<e._candidates.length;n++){if("GETPAGES"===e._candidates[n])return!0;if(r+=1,r>=t)break}return!1}_expandPagedSet(e,t,r,a,s){return null===this._parent?Object(n["t"])(new Error("Parent Paging not implemented")):this._parent._expandPagedSet(e,t,r,a,s)}_expandPagedSetFeatureSet(e,t,r,a,s){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]&&(a=1),0===a&&e._candidates.length>0&&"GETPAGES"===e._candidates[e._candidates.length-1]&&(a=2),0===a?Object(n["u"])("finished"):this._getPage(e,a,s).then(n=>r+n<t?this._expandPagedSet(e,t,r+n,0,s):"success")}_getPage(e,t,r){const a=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){a.length=a.length-1;let t=0;for(let n=0;n<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+n>=e.pagesDefinition.internal.set.length);n++)a[a.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+n],t++;e.pagesDefinition.resultOffset+=t;let r=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(r=!0),!1===r&&a.push("GETPAGES"),Object(n["u"])(t)}return this._getPhysicalPage(e,t,r).then(()=>this._getPage(e,t,r))}_getPhysicalPage(e,t,r){return null}_clonePageDefinition(e){return null===this._parent?null:this._parent._clonePageDefinition(e)}_first(e){return this.iterator(e).next()}first(e){return this._first(e)}calculateStatistic(e,t,r,n){return this._ensureLoaded().then(()=>this._stat(e,t,"",null,null,r,n).then(a=>!1===a.calculated?this._manualStat(e,t,r,n).then(e=>e.result):a.result))}_manualStat(e,t,r,a){switch(e.toLowerCase()){case"count":return Object(h["b"])(this,a).then(e=>({calculated:!0,result:e}));case"distinct":return Object(h["d"])(this,t,r).then(e=>({calculated:!0,result:e}));case"avg":case"mean":return Object(h["f"])(this,t,a).then(e=>({calculated:!0,result:e}));case"stdev":return Object(h["h"])(this,t,a).then(e=>({calculated:!0,result:e}));case"variance":return Object(h["j"])(this,t,a).then(e=>({calculated:!0,result:e}));case"sum":return Object(h["i"])(this,t,a).then(e=>({calculated:!0,result:e}));case"min":return Object(h["g"])(this,t,a).then(e=>({calculated:!0,result:e}));case"max":return Object(h["e"])(this,t,a).then(e=>({calculated:!0,result:e}));default:return Object(n["u"])({calculated:!0,result:0})}}_stat(e,t,r,n,a,s,i){return this._parent._stat(e,t,r,n,a,s,i).then(l=>!1===l.calculated?null===a&&""===r&&null===n?this._manualStat(e,t,s,i):{calculated:!1}:l)}_unionAllGeomSelf(e){const t=this.iterator(this._defaultTracker(e)),r=[];return Object(n["c"])((e,n)=>{this._unionShapeInBatches(r,t,e,n)})}_unionAllGeom(e){return Object(n["c"])((t,r)=>{const n=this.iterator(this._defaultTracker(e));this._unionShapeInBatches([],n,t,r)})}_unionShapeInBatches(e,t,r,n){t.next().then(a=>{try{null!==a&&null!==a.geometry&&e.push(a.geometry),e.length>30||null===a&&e.length>1?Object(i["B"])(e).then(s=>{try{null===a?r(s):(e=[s],this._unionShapeInBatches(e,t,r,n))}catch(e){n(e)}},n):null===a?1===e.length?r(e[0]):r(null):this._unionShapeInBatches(e,t,r,n)}catch(e){n(e)}},n)}iterator(e){return new l(this,e)}intersection(e,t=!1){return f._featuresetFunctions.intersection.bind(this)(e,t)}difference(e,t=!1,r=!0){return f._featuresetFunctions.difference.bind(this)(e,t,r)}symmetricDifference(e,t=!1,r=!0){return f._featuresetFunctions.symmetricDifference.bind(this)(e,t,r)}morphShape(e,t,r="unknown",n=null){return f._featuresetFunctions.morphShape.bind(this)(e,t,r,n)}morphShapeAndAttributes(e,t,r="unknown"){return f._featuresetFunctions.morphShapeAndAttributes.bind(this)(e,t,r)}union(e,t=!1){return f._featuresetFunctions.union.bind(this)(e,t)}intersects(e){return f._featuresetFunctions.intersects.bind(this)(e)}envelopeIntersects(e){return f._featuresetFunctions.envelopeIntersects.bind(this)(e)}contains(e){return f._featuresetFunctions.contains.bind(this)(e)}overlaps(e){return f._featuresetFunctions.overlaps.bind(this)(e)}relate(e,t){return f._featuresetFunctions.relate.bind(this)(e,t)}within(e){return f._featuresetFunctions.within.bind(this)(e)}touches(e){return f._featuresetFunctions.touches.bind(this)(e)}top(e){return f._featuresetFunctions.top.bind(this)(e)}crosses(e){return f._featuresetFunctions.crosses.bind(this)(e)}buffer(e,t,r,n=!0){return f._featuresetFunctions.buffer.bind(this)(e,t,r,n)}filter(e,t=null){return f._featuresetFunctions.filter.bind(this)(e,t)}orderBy(e){return f._featuresetFunctions.orderBy.bind(this)(e)}dissolve(e,t){return f._featuresetFunctions.dissolve.bind(this)(e,t)}groupby(e,t){return f._featuresetFunctions.groupby.bind(this)(e,t)}reduce(e,t=null,r){return Object(n["c"])((n,a)=>{this._reduceImpl(this.iterator(this._defaultTracker(r)),e,t,0,n,a,0)})}_reduceImpl(e,t,r,a,s,i,l){try{if(++l>1e3)return void setTimeout(()=>{l=0,this._reduceImpl(e,t,r,a,s,i,l)});e.next().then(o=>{try{if(null===o)s(r);else{const u=t(r,o,a,this);Object(n["p"])(u)?u.then(r=>{this._reduceImpl(e,t,r,a+1,s,i,l)},i):this._reduceImpl(e,t,u,a+1,s,i,l)}}catch(e){i(e)}},i)}catch(e){i(e)}}removeField(e){return f._featuresetFunctions.removeField.bind(this)(e)}addField(e,t,r=null){return f._featuresetFunctions.addField.bind(this)(e,t,r)}sumArea(e,t=!1,r){const n=Object(s["e"])(e);return this.reduce((e,r)=>null===r.geometry?0:t?Object(i["l"])(r.geometry,n).then(t=>e+t):Object(i["u"])(r.geometry,n).then(t=>e+t),0,r)}sumLength(e,t=!1,r){const n=Object(s["d"])(e);return this.reduce((e,r)=>null===r.geometry?0:t?Object(i["o"])(r.geometry,n).then(t=>e+t):Object(i["v"])(r.geometry,n).then(t=>e+t),0,r)}_substituteVars(e,t){if(null!==t){const r={};for(const e in t)r[e.toLowerCase()]=t[e];e.parameters=r}}distinct(e,t=1e3,r=null,n){return this.load().then(()=>{const a=c["WhereClause"].create(e,this.getFieldsIndex());return this._substituteVars(a,r),this.calculateStatistic("distinct",a,t,this._defaultTracker(n))})}min(e,t=null,r){return this.load().then(()=>{const n=c["WhereClause"].create(e,this.getFieldsIndex());return this._substituteVars(n,t),this.calculateStatistic("min",n,-1,this._defaultTracker(r))})}max(e,t=null,r){return this.load().then(()=>{const n=c["WhereClause"].create(e,this.getFieldsIndex());return this._substituteVars(n,t),this.calculateStatistic("max",n,-1,this._defaultTracker(r))})}avg(e,t=null,r){return this.load().then(()=>{const n=c["WhereClause"].create(e,this.getFieldsIndex());return this._substituteVars(n,t),this.calculateStatistic("avg",n,-1,this._defaultTracker(r))})}sum(e,t=null,r){return this.load().then(()=>{const n=c["WhereClause"].create(e,this.getFieldsIndex());return this._substituteVars(n,t),this.calculateStatistic("sum",n,-1,this._defaultTracker(r))})}stdev(e,t=null,r){return this.load().then(()=>{const n=c["WhereClause"].create(e,this.getFieldsIndex());return this._substituteVars(n,t),this.calculateStatistic("stdev",n,-1,this._defaultTracker(r))})}variance(e,t=null,r){return this.load().then(()=>{const n=c["WhereClause"].create(e,this.getFieldsIndex());return this._substituteVars(n,t),this.calculateStatistic("variance",n,-1,this._defaultTracker(r))})}count(e){return this.load().then(()=>this.calculateStatistic("count",c["WhereClause"].create("1",this.getFieldsIndex()),-1,this._defaultTracker(e)))}_defaultTracker(e){return e||{aborted:!1}}forEach(e,t){return Object(n["c"])((r,n)=>{this._forEachImpl(this.iterator(this._defaultTracker(t)),e,this,r,n,0)})}_forEachImpl(e,t,r,a,s,i){try{if(++i>1e3)return void setTimeout(()=>{i=0,this._forEachImpl(e,t,r,a,s,i)},0);e.next().then(l=>{try{if(null===l)a(r);else{const o=t(l);null==o?this._forEachImpl(e,t,r,a,s,i):Object(n["p"])(o)?o.then(()=>{try{this._forEachImpl(e,t,r,a,s,i)}catch(e){s(e)}},s):this._forEachImpl(e,t,r,a,s,i)}}catch(e){s(e)}},s)}catch(e){s(e)}}convertToJSON(e){const t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}};for(let r=0;r<this.fields.length;r++)t.layerDefinition.fields.push(Object(s["h"])(this.fields[r]));return this.reduce((e,r)=>{const n={geometry:r.geometry&&r.geometry.toJSON(),attributes:{}};for(const t in r.attributes)n.attributes[t]=r.attributes[t];return t.featureSet.features.push(n),1},0,e).then(()=>t)}castToText(){return"object, FeatureSet"}queryAttachments(e,t,r,n){return this._parent.queryAttachments(e,t,r,n)}serviceUrl(){return this._parent.serviceUrl()}subtypes(){return this.typeIdField?{subtypeField:this.typeIdField,subtypes:this.types?this.types.map(e=>({name:e.name,code:e.id})):[]}:null}relationshipMetaData(){return this._parent.relationshipMetaData()}get gdbVersion(){return this._parent?this._parent.gdbVersion:""}schema(){const e=[];for(const t of this.fields)e.push(Object(s["h"])(t));return{objectIdField:this.objectIdField,globalIdField:this.globalIdField,geometryType:void 0===s["n"][this.geometryType]?"":s["n"][this.geometryType],fields:e}}convertToText(e,t){return"schema"===e?this._ensureLoaded().then(()=>JSON.stringify(this.schema())):"featureset"===e?this._ensureLoaded().then(()=>{const e=[];return this.reduce((t,r)=>{const n={geometry:r.geometry?r.geometry.toJSON():null,attributes:r.attributes};return null!==n.geometry&&n.geometry.spatialReference&&delete n.geometry.spatialReference,e.push(n),1},0,t).then(()=>{const t=this.schema();return t.features=e,t.spatialReference=this.spatialReference.toJSON(),JSON.stringify(t)})}):Object(n["u"])(this.castToText())}getFeatureByObjectId(e,t){return this._parent.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._parent.getOwningSystemUrl()}getIdentityUser(){return this._parent.getIdentityUser()}}f._featuresetFunctions={};t["a"]=f},"5db9":function(e,t,r){"use strict";var n=r("f4cc"),a=r("89da"),s=r("64fc"),i=r("4f73"),l=r("96af");class o extends i["a"]{constructor(e){super(e),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=e.orderbyclause,this._parent=e.parentfeatureset}_getSet(e){return null===this._wset?this._ensureLoaded().then(()=>this._getFilteredSet("",null,null,this._orderbyclause,e)).then(t=>(this._checkCancelled(e),this._wset=t,this._wset)):Object(n["u"])(this._wset)}manualOrderSet(e,t){return this.getIdColumnDictionary(e,[],-1,t).then(e=>{this._orderbyclause.order(e);const t=new s["a"]([],[],!0,null);for(let r=0;r<e.length;r++)t._known.push(e[r].id);return t})}getIdColumnDictionary(e,t,r,s){if(r<e._known.length-1){const n=this._maxQueryRate();if("GETPAGES"===e._known[r+1])return Object(a["q"])(this._parent._expandPagedSet(e,n,0,0,s)).then(()=>this.getIdColumnDictionary(e,t,r,s));let i=r+1;const l=[];for(;i<e._known.length&&"GETPAGES"!==e._known[i];)l.push(e._known[i]),i++;return r+=l.length,Object(a["q"])(this._parent._getFeatureBatch(l,s)).then(n=>{this._checkCancelled(s);for(const e of n)t.push({id:e.attributes[this.objectIdField],feature:e});return this.getIdColumnDictionary(e,t,r,s)})}return e._candidates.length>0?Object(a["q"])(this._refineSetBlock(e,this._maxProcessingRate(),s)).then(()=>(this._checkCancelled(s),this.getIdColumnDictionary(e,t,r,s))):Object(n["u"])(t)}_isInFeatureSet(e){return this._parent._isInFeatureSet(e)}_getFeatures(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}_featureFromCache(e){if(void 0===this._featureCache[e]){const t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}_fetchAndRefineFeatures(){return Object(n["t"])(new Error("Fetch and Refine should not be called in this featureset"))}_getFilteredSet(e,t,r,n,a){return this._ensureLoaded().then(()=>this._parent._getFilteredSet(e,t,r,null===n?this._orderbyclause:n,a)).then(e=>{let n;this._checkCancelled(a),n=new s["a"](e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition));let i=!0;return e._candidates.length>0&&(i=!1),!1===n._ordered?this.manualOrderSet(n,a).then(e=>(!1===i&&(null===t&&null===r||(e=new s["a"](e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)))),e)):n})}static registerAction(){i["a"]._featuresetFunctions.orderBy=function(e){return""===e?this:new o({parentfeatureset:this,orderbyclause:new l["a"](e)})}}}t["a"]=o},"5f6c":function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return n}));"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof e||"undefined"!=typeof self&&self;function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function a(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return s(null==t&&r.path)}},r.exports),r.exports}function s(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}}).call(this,r("c8ba"))},"60fd":function(e,t,r){"use strict";var n=r("f4cc"),a=r("853c"),s=r("64fc"),i=r("4f73");class l extends i["a"]{constructor(e){super(e),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=e.topnum,this._parent=e.parentfeatureset}_getSet(e){return null===this._wset?this._ensureLoaded().then(()=>this._parent._getSet(e)).then(e=>(this._wset=new s["a"](e._candidates.slice(0),e._known.slice(0),!1,this._clonePageDefinition(e.pagesDefinition)),this._setKnownLength(this._wset)>this._topnum&&(this._wset._known=this._wset._known.slice(0,this._topnum)),this._setKnownLength(this._wset)>=this._topnum&&(this._wset._candidates=[]),this._wset)):Object(n["u"])(this._wset)}_setKnownLength(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length}_isInFeatureSet(e){const t=this._parent._isInFeatureSet(e);if(t===a["b"].NotInFeatureSet)return t;const r=this._idstates[e];return r===a["b"].InFeatureSet||r===a["b"].NotInFeatureSet?r:t===a["b"].InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=a["b"].InFeatureSet,this._countedin++,a["b"].InFeatureSet):(this._idstates[e]=a["b"].NotInFeatureSet,a["b"].NotInFeatureSet):a["b"].Unknown}_expandPagedSet(e,t,r,a,s){if(null===this._parent)return Object(n["t"])(new Error("Parent Paging not implemented"));if(t>this._topnum&&(t=this._topnum),this._countedin>=this._topnum&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset){let t=e._known.length;return t>0&&"GETPAGES"===e._known[t-1]&&(e._known.length=t-1),t=e._candidates.length,t>0&&"GETPAGES"===e._candidates[t-1]&&(e._candidates.length=t-1),Object(n["u"])("success")}return this._parent._expandPagedSet(e,t,r,a,s).then(t=>(this._setKnownLength(e)>this._topnum&&(e._known.length=this._topnum),this._setKnownLength(e)>=this._topnum&&(e._candidates.length=0),t))}_getFeatures(e,t,r,a){const i=[],l=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,l))return this._expandPagedSet(e,l,0,0,a).then(()=>this._getFeatures(e,t,r,a));-1!==t&&void 0===this._featureCache[t]&&i.push(t);let o=0;for(let n=e._lastFetchedIndex;n<e._known.length&&(o++,o<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[n]]&&(e._known[n]!==t&&i.push(e._known[n]),i.length>l-1)));n++);if(0===i.length)return Object(n["u"])("success");const u=new s["a"]([],i,!1,null),c=Math.min(i.length,r);return this._parent._getFeatures(u,-1,c,a).then(()=>{for(let e=0;e<c;e++){const t=this._parent._featureFromCache(i[e]);void 0!==t&&(this._featureCache[i[e]]=t)}return"success"})}_getFilteredSet(e,t,r,n,a){return this._ensureLoaded().then(()=>this._getSet(a)).then(e=>new s["a"](e._candidates.slice(0).concat(e._known.slice(0)),[],!1,this._clonePageDefinition(e.pagesDefinition)))}_refineKnowns(e,t){let r=0,n=null;const s=[];for(let i=0;i<e._candidates.length;i++){const l=this._isInFeatureSet(e._candidates[i]);if(l===a["b"].InFeatureSet){if(e._known.push(e._candidates[i]),r+=1,null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(s.push(n),n={start:i,end:i}),e._known.length>=this._topnum)break}else if(l===a["b"].NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(s.push(n),n={start:i,end:i}),r+=1;else if(l===a["b"].Unknown)break;if(r>=t)break}null!==n&&s.push(n);for(let a=s.length-1;a>=0;a--)e._candidates.splice(s[a].start,s[a].end-s[a].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])}_stat(){return Object(n["u"])({calculated:!1})}_canDoAggregates(){return Object(n["u"])(!1)}static registerAction(){i["a"]._featuresetFunctions.top=function(e){return new l({parentfeatureset:this,topnum:e})}}}t["a"]=l},"64fc":function(e,t,r){"use strict";t["a"]=class{constructor(e,t,r,n){this._candidates=null,this._known=null,this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=e,this._known=t,this._ordered=r,this.pagesDefinition=n}}},"66a2":function(e,t,r){"use strict";r.r(t),r.d(t,"WhereClause",(function(){return O})),r.d(t,"defaultAttributeAdapter",(function(){return U}));var n=r("c120");function a(e,t){const r=i[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)}function s(e,t){const r=i[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}const i={min:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.min.apply(Math,e[0])},max:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.max.apply(Math,e[0])},avg:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:l(e[0])},sum:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t}(e[0])},stddev:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sqrt(o(e[0]))},count:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].length},var:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:o(e[0])}};function l(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/e.length}function o(e){const t=l(e),r=e.length;let n=0;for(const a of e)n+=Math.pow(a-t,2);return r>1?n/(r-1):0}var u=r("b3b6");class c{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}static fixDefaults(e){if(null!==e.precision||null!==e.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static createFromMilliseconds(e){const t=new c;return t.second=e/1e3,t}static createFromValueAndQualifer(e,t,r){let n=null;const a=new c;if(a.op="-"===r?"-":"+","interval-period"===t.type){c.fixDefaults(t);const r=new RegExp("^[0-9]{1,}$");if("year"===t.period||"month"===t.period)throw new Error("Year-Month Intervals not supported");if(!r.test(e))throw new Error("Illegal Interval");a[t.period]=parseFloat(e)}else{if(c.fixDefaults(t.start),c.fixDefaults(t.end),"year"===t.start.period||"month"===t.start.period)throw new Error("Year-Month Intervals not supported");if("year"===t.end.period||"month"===t.end.period)throw new Error("Year-Month Intervals not supported");switch(t.start.period){case"day":switch(t.end.period){case"hour":if(n=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!n.test(e))throw new Error("Illegal Interval");a[t.start.period]=parseFloat(e.split(" ")[0]),a[t.end.period]=parseFloat(e.split(" ")[1]);break;case"minute":if(n=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!n.test(e))throw new Error("Illegal Interval");{a[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");a.hour=parseFloat(r[0]),a.minute=parseFloat(r[1])}break;case"second":if(n=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new Error("Illegal Interval");{a[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");a.hour=parseFloat(r[0]),a.minute=parseFloat(r[1]),a.second=parseFloat(r[2])}break;default:throw"Invalid Interval."}break;case"hour":switch(t.end.period){case"minute":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!n.test(e))throw new Error("Illegal Interval");a.hour=parseFloat(e.split(":")[0]),a.minute=parseFloat(e.split(":")[1]);break;case"second":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new Error("Illegal Interval");{const t=e.split(":");a.hour=parseFloat(t[0]),a.minute=parseFloat(t[1]),a.second=parseFloat(t[2])}break;default:throw"Invalid Interval."}break;case"minute":switch(t.end.period){case"second":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new Error("Illegal Interval");{const t=e.split(":");a.minute=parseFloat(t[0]),a.second=parseFloat(t[1])}break;default:throw"Invalid Interval."}break;default:throw"Invalid Interval."}}return a}valueInMilliseconds(){return("-"===this.op?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}function h(e,t){const r=f[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)}function d(e,t){const r=f[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}const f={extract:{minParams:2,maxParams:2,evaluate:([e,t])=>{if(null==t)return null;if(t instanceof Date)switch(e.toUpperCase()){case"SECOND":return t.getSeconds();case"MINUTE":return t.getMinutes();case"HOUR":return t.getHours();case"DAY":return t.getDate();case"MONTH":return t.getMonth()+1;case"YEAR":return t.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(2===e.length){const[t,r]=e;return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){const[t,r,n]=e;return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:([e,t])=>null==e||null==t?null:t.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{const t=3===e.length,r=t?e[1]:" ",n=t?e[2]:e[1];if(null==r||null==n)return null;const a=`(${Object(u["a"])(r)})`;switch(e[0]){case"BOTH":return n.replace(new RegExp(`^${a}*|${a}*$`,"g"),"");case"LEADING":return n.replace(new RegExp(`^${a}*`,"g"),"");case"TRAILING":return n.replace(new RegExp(a+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0]>0?1:e[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])},mod:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{const t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:e=>null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>"string"==typeof e[0]||e[0]instanceof String?e[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:e=>{let t="";for(let r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toUpperCase()}};var p=r("5f6c"),_=Object(p["b"])((function(e){e.exports&&(e.exports=function(){function e(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function t(e,r,n,a){this.message=e,this.expected=r,this.found=n,this.location=a,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}function r(e,r){r=void 0!==r?r:{};var n,a={},s={start:kn},i=kn,l=function(e){return e},o=function(e,t){var r={type:"expr_list"},n=ks(e,t);return r.value=n,r},u=function(e,t){return Ls(e,t)},c="!",h=jn("!",!1),d="=",f=jn("=",!1),p=function(e){return Rs("NOT",e)},_=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?Ls(e,t.tail):As(t.op,e,t.right,t.escape)},g=function(e){return{type:"arithmetic",tail:e}},m=">=",y=jn(">=",!1),b=">",w=jn(">",!1),v="<=",S=jn("<=",!1),F="<>",I=jn("<>",!1),O="<",T=jn("<",!1),x="!=",C=jn("!=",!1),j=function(e,t){return{op:e+"NOT",right:t}},E=function(e,t){return{op:e,right:t}},N=function(e,t,r){return{op:"NOT"+e,right:{type:"expr_list",value:[t,r]}}},D=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}},R=function(e){return e[0]+" "+e[2]},A=function(e,t,r){return{op:e,right:t,escape:r.value}},P=function(e,t){return{op:e,right:t,escape:""}},k=function(e,t){return{op:e,right:t}},L=function(e){return{op:e,right:{type:"expr_list",value:[]}}},M=function(e,t){return{op:e,right:t}},G="+",U=jn("+",!1),q="-",B=jn("-",!1),V=function(e,t){return Ls(e,t)},W="*",z=jn("*",!1),J="/",Y=jn("/",!1),Q=function(e){return e.paren=!0,e},H=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:e}},K=function(e){return e},$=function(e,t){return e+t.join("")},Z=/^[A-Za-z_\x80-\uFFFF]/,X=En([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),ee=/^[A-Za-z0-9_]/,te=En([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),re=/^[A-Za-z0-9_.\x80-\uFFFF]/,ne=En([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),ae="@",se=jn("@",!1),ie=function(e){return{type:"param",value:e[1]}},le=function(e,t){return{type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:e},t]}}},oe=function(e,t,r){return{type:"function",name:"substring",args:{type:"expr_list",value:r?[e,t,r[2]]:[e,t]}}},ue=function(e,t,r){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t,r]}}},ce=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}},he=function(e,t){return{type:"function",name:"position",args:{type:"expr_list",value:[e,t]}}},de=function(e,t){return{type:"function",name:e,args:t||{type:"expr_list",value:[]}}},fe=function(e){return{type:"timestamp",value:e.value}},pe=function(e,t,r){return{type:"interval",value:t,qualifier:r,op:e}},_e=function(e,t){return{type:"interval",value:e,qualifier:t,op:""}},ge=function(e,t){return{type:"interval-qualifier",start:e,end:t}},me=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}},ye=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},be=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},we=function(e,t){return{type:"interval-period",period:"second",precision:e,secondary:t}},ve=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}},Se=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},Fe=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}},Ie=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}},Oe=function(){return{type:"interval-period",period:"second",precision:null,secondary:null}},Te=function(){return{type:"string",value:"day"}},xe=function(){return{type:"string",value:"hour"}},Ce=function(){return{type:"string",value:"minute"}},je=function(){return{type:"string",value:"month"}},Ee=function(){return{type:"string",value:"year"}},Ne=function(e){return parseFloat(e)},De=function(e){return{type:"date",value:e.value}},Re=function(){return{type:"null",value:null}},Ae=function(){return{type:"bool",value:!0}},Pe=function(){return{type:"bool",value:!1}},ke="'",Le=jn("'",!1),Me="N'",Ge=jn("N'",!1),Ue="''",qe=jn("''",!1),Be=function(){return"'"},Ve=/^[^']/,We=En(["'"],!0,!1),ze=function(e){return{type:"string",value:e.join("")}},Je=function(e,t){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:null}},Ye=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}},Qe=function(e){return{type:"case_expression",format:"searched",clauses:e,else:null}},He=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}},Ke=function(e,t){return{type:"when_clause",operand:e,value:t}},$e=function(e){return{type:"else_clause",value:e}},Ze=function(e){return{type:"number",value:e}},Xe=function(e,t,r){return parseFloat(e+t+r)},et=function(e,t){return parseFloat(e+t)},tt=function(e,t){return parseFloat(e+t)},rt=function(e){return parseFloat(e)},nt=function(e,t){return e[0]+t},at=".",st=jn(".",!1),it=function(e){return"."+(null!=e?e:"")},lt=function(e,t){return e+t},ot=function(e){return e.join("")},ut=/^[0-9]/,ct=En([["0","9"]],!1,!1),ht=/^[eE]/,dt=En(["e","E"],!1,!1),ft=/^[+\-]/,pt=En(["+","-"],!1,!1),_t=function(e,t){return"e"+(null===t?"":t)},gt="null",mt=jn("NULL",!0),yt="true",bt=jn("TRUE",!0),wt="false",vt=jn("FALSE",!0),St="in",Ft=jn("IN",!0),It=function(){return"IN"},Ot="is",Tt=jn("IS",!0),xt=function(){return"IS"},Ct="like",jt=jn("LIKE",!0),Et=function(){return"LIKE"},Nt="escape",Dt=jn("ESCAPE",!0),Rt=function(){return"ESCAPE"},At="not",Pt=jn("NOT",!0),kt=function(){return"NOT"},Lt="and",Mt=jn("AND",!0),Gt=function(){return"AND"},Ut="or",qt=jn("OR",!0),Bt=function(){return"OR"},Vt="between",Wt=jn("BETWEEN",!0),zt=function(){return"BETWEEN"},Jt="from",Yt=jn("FROM",!0),Qt=function(){return"FROM"},Ht="for",Kt=jn("FOR",!0),$t=function(){return"FOR"},Zt="substring",Xt=jn("SUBSTRING",!0),er=function(){return"SUBSTRING"},tr="extract",rr=jn("EXTRACT",!0),nr=function(){return"EXTRACT"},ar="trim",sr=jn("TRIM",!0),ir=function(){return"TRIM"},lr="position",or=jn("POSITION",!0),ur=function(){return"POSITION"},cr="timestamp",hr=jn("TIMESTAMP",!0),dr=function(){return"TIMESTAMP"},fr="date",pr=jn("DATE",!0),_r=function(){return"DATE"},gr="leading",mr=jn("LEADING",!0),yr=function(){return"LEADING"},br="trailing",wr=jn("TRAILING",!0),vr=function(){return"TRAILING"},Sr="both",Fr=jn("BOTH",!0),Ir=function(){return"BOTH"},Or="to",Tr=jn("TO",!0),xr=function(){return"TO"},Cr="interval",jr=jn("INTERVAL",!0),Er=function(){return"INTERVAL"},Nr="year",Dr=jn("YEAR",!0),Rr=function(){return"YEAR"},Ar="month",Pr=jn("MONTH",!0),kr=function(){return"MONTH"},Lr="day",Mr=jn("DAY",!0),Gr=function(){return"DAY"},Ur="hour",qr=jn("HOUR",!0),Br=function(){return"HOUR"},Vr="minute",Wr=jn("MINUTE",!0),zr=function(){return"MINUTE"},Jr="second",Yr=jn("SECOND",!0),Qr=function(){return"SECOND"},Hr="case",Kr=jn("CASE",!0),$r=function(){return"CASE"},Zr="end",Xr=jn("END",!0),en=function(){return"END"},tn="when",rn=jn("WHEN",!0),nn=function(){return"WHEN"},an="then",sn=jn("THEN",!0),ln=function(){return"THEN"},on="else",un=jn("ELSE",!0),cn=function(){return"ELSE"},hn=",",dn=jn(",",!1),fn="(",pn=jn("(",!1),_n=")",gn=jn(")",!1),mn=/^[ \t\n\r]/,yn=En([" ","\t","\n","\r"],!1,!1),bn="`",wn=jn("`",!1),vn=/^[^`]/,Sn=En(["`"],!0,!1),Fn=function(e){return e.join("")},In=0,On=[{line:1,column:1}],Tn=0,xn=[],Cn=0;if("startRule"in r){if(!(r.startRule in s))throw new Error("Can't start parsing from rule \""+r.startRule+'".');i=s[r.startRule]}function jn(e,t){return{type:"literal",text:e,ignoreCase:t}}function En(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Nn(){return{type:"end"}}function Dn(t){var r,n=On[t];if(n)return n;for(r=t-1;!On[r];)r--;for(n={line:(n=On[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return On[t]=n,n}function Rn(e,t){var r=Dn(e),n=Dn(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function An(e){In<Tn||(In>Tn&&(Tn=In,xn=[]),xn.push(e))}function Pn(e,r,n){return new t(t.buildMessage(e,r),e,r,n)}function kn(){var e,t;return e=In,Es()!==a&&(t=Mn())!==a&&Es()!==a?e=l(t):(In=e,e=a),e}function Ln(){var e,t,r,n,s,i,l,u;if(e=In,(t=Mn())!==a){for(r=[],n=In,(s=Es())!==a&&(i=xs())!==a&&(l=Es())!==a&&(u=Mn())!==a?n=s=[s,i,l,u]:(In=n,n=a);n!==a;)r.push(n),n=In,(s=Es())!==a&&(i=xs())!==a&&(l=Es())!==a&&(u=Mn())!==a?n=s=[s,i,l,u]:(In=n,n=a);r!==a?e=t=o(t,r):(In=e,e=a)}else In=e,e=a;return e}function Mn(){var e,t,r,n,s,i,l,o;if(e=In,(t=Gn())!==a){for(r=[],n=In,(s=Es())!==a&&(i=ts())!==a&&(l=Es())!==a&&(o=Gn())!==a?n=s=[s,i,l,o]:(In=n,n=a);n!==a;)r.push(n),n=In,(s=Es())!==a&&(i=ts())!==a&&(l=Es())!==a&&(o=Gn())!==a?n=s=[s,i,l,o]:(In=n,n=a);r!==a?e=t=u(t,r):(In=e,e=a)}else In=e,e=a;return e}function Gn(){var e,t,r,n,s,i,l,o;if(e=In,(t=Un())!==a){for(r=[],n=In,(s=Es())!==a&&(i=es())!==a&&(l=Es())!==a&&(o=Un())!==a?n=s=[s,i,l,o]:(In=n,n=a);n!==a;)r.push(n),n=In,(s=Es())!==a&&(i=es())!==a&&(l=Es())!==a&&(o=Un())!==a?n=s=[s,i,l,o]:(In=n,n=a);r!==a?e=t=u(t,r):(In=e,e=a)}else In=e,e=a;return e}function Un(){var t,r,n,s,i;return t=In,(r=Xa())===a&&(r=In,33===e.charCodeAt(In)?(n=c,In++):(n=a,0===Cn&&An(h)),n!==a?(s=In,Cn++,61===e.charCodeAt(In)?(i=d,In++):(i=a,0===Cn&&An(f)),Cn--,i===a?s=void 0:(In=s,s=a),s!==a?r=n=[n,s]:(In=r,r=a)):(In=r,r=a)),r!==a&&(n=Es())!==a&&(s=Un())!==a?t=r=p(s):(In=t,t=a),t===a&&(t=qn()),t}function qn(){var e,t,r;return e=In,(t=$n())!==a&&Es()!==a?((r=Bn())===a&&(r=null),r!==a?e=t=_(t,r):(In=e,e=a)):(In=e,e=a),e}function Bn(){var e;return(e=Vn())===a&&(e=Kn())===a&&(e=Jn())===a&&(e=zn())===a&&(e=Hn()),e}function Vn(){var e,t,r,n,s,i;if(e=[],t=In,(r=Es())!==a&&(n=Wn())!==a&&(s=Es())!==a&&(i=$n())!==a?t=r=[r,n,s,i]:(In=t,t=a),t!==a)for(;t!==a;)e.push(t),t=In,(r=Es())!==a&&(n=Wn())!==a&&(s=Es())!==a&&(i=$n())!==a?t=r=[r,n,s,i]:(In=t,t=a);else e=a;return e!==a&&(e=g(e)),e}function Wn(){var t;return e.substr(In,2)===m?(t=m,In+=2):(t=a,0===Cn&&An(y)),t===a&&(62===e.charCodeAt(In)?(t=b,In++):(t=a,0===Cn&&An(w)),t===a&&(e.substr(In,2)===v?(t=v,In+=2):(t=a,0===Cn&&An(S)),t===a&&(e.substr(In,2)===F?(t=F,In+=2):(t=a,0===Cn&&An(I)),t===a&&(60===e.charCodeAt(In)?(t=O,In++):(t=a,0===Cn&&An(T)),t===a&&(61===e.charCodeAt(In)?(t=d,In++):(t=a,0===Cn&&An(f)),t===a&&(e.substr(In,2)===x?(t=x,In+=2):(t=a,0===Cn&&An(C)))))))),t}function zn(){var e,t,r,n;return e=In,(t=Ka())!==a&&Es()!==a&&(r=Xa())!==a&&Es()!==a&&(n=$n())!==a?e=t=j(t,n):(In=e,e=a),e===a&&(e=In,(t=Ka())!==a&&Es()!==a&&(r=$n())!==a?e=t=E(t,r):(In=e,e=a)),e}function Jn(){var e,t,r,n,s,i;return e=In,(t=Xa())!==a&&Es()!==a&&(r=rs())!==a&&Es()!==a&&(n=$n())!==a&&Es()!==a&&(s=es())!==a&&Es()!==a&&(i=$n())!==a?e=t=N(r,n,i):(In=e,e=a),e===a&&(e=In,(t=rs())!==a&&Es()!==a&&(r=$n())!==a&&Es()!==a&&(n=es())!==a&&Es()!==a&&(s=$n())!==a?e=t=D(t,r,s):(In=e,e=a)),e}function Yn(){var e,t,r,n,s;return e=In,t=In,(r=Xa())!==a&&(n=Es())!==a&&(s=$a())!==a?t=r=[r,n,s]:(In=t,t=a),t!==a&&(t=R(t)),(e=t)===a&&(e=$a()),e}function Qn(){var e,t,r,n,s;return e=In,t=In,(r=Xa())!==a&&(n=Es())!==a&&(s=Ha())!==a?t=r=[r,n,s]:(In=t,t=a),t!==a&&(t=R(t)),(e=t)===a&&(e=Ha()),e}function Hn(){var e,t,r,n;return e=In,(t=Yn())!==a&&Es()!==a&&(r=Ea())!==a&&Es()!==a&&Za()!==a&&Es()!==a&&(n=Na())!==a?e=t=A(t,r,n):(In=e,e=a),e===a&&(e=In,(t=Yn())!==a&&Es()!==a&&(r=Ea())!==a?e=t=P(t,r):(In=e,e=a)),e}function Kn(){var e,t,r,n;return e=In,(t=Qn())!==a&&Es()!==a&&(r=Cs())!==a&&Es()!==a&&(n=Ln())!==a&&Es()!==a&&js()!==a?e=t=k(t,n):(In=e,e=a),e===a&&(e=In,(t=Qn())!==a&&Es()!==a&&(r=Cs())!==a&&Es()!==a&&(n=js())!==a?e=t=L(t):(In=e,e=a),e===a&&(e=In,(t=Qn())!==a&&Es()!==a&&(r=ua())!==a?e=t=M(t,r):(In=e,e=a))),e}function $n(){var e,t,r,n,s,i,l,o;if(e=In,(t=Xn())!==a){for(r=[],n=In,(s=Es())!==a&&(i=Zn())!==a&&(l=Es())!==a&&(o=Xn())!==a?n=s=[s,i,l,o]:(In=n,n=a);n!==a;)r.push(n),n=In,(s=Es())!==a&&(i=Zn())!==a&&(l=Es())!==a&&(o=Xn())!==a?n=s=[s,i,l,o]:(In=n,n=a);r!==a?e=t=u(t,r):(In=e,e=a)}else In=e,e=a;return e}function Zn(){var t;return 43===e.charCodeAt(In)?(t=G,In++):(t=a,0===Cn&&An(U)),t===a&&(45===e.charCodeAt(In)?(t=q,In++):(t=a,0===Cn&&An(B))),t}function Xn(){var e,t,r,n,s,i,l,o;if(e=In,(t=ta())!==a){for(r=[],n=In,(s=Es())!==a&&(i=ea())!==a&&(l=Es())!==a&&(o=ta())!==a?n=s=[s,i,l,o]:(In=n,n=a);n!==a;)r.push(n),n=In,(s=Es())!==a&&(i=ea())!==a&&(l=Es())!==a&&(o=ta())!==a?n=s=[s,i,l,o]:(In=n,n=a);r!==a?e=t=V(t,r):(In=e,e=a)}else In=e,e=a;return e}function ea(){var t;return 42===e.charCodeAt(In)?(t=W,In++):(t=a,0===Cn&&An(z)),t===a&&(47===e.charCodeAt(In)?(t=J,In++):(t=a,0===Cn&&An(Y))),t}function ta(){var e,t;return(e=ma())===a&&(e=ca())===a&&(e=ha())===a&&(e=da())===a&&(e=pa())===a&&(e=_a())===a&&(e=Da())===a&&(e=ra())===a&&(e=ua())===a&&(e=In,Cs()!==a&&Es()!==a&&(t=Mn())!==a&&Es()!==a&&js()!==a?e=Q(t):(In=e,e=a)),e}function ra(){var e;return(e=na())!==a&&(e=H(e)),e}function na(){var e;return(e=aa())!==a&&(e=K(e)),e}function aa(){var e,t,r,n;if(e=In,(t=ia())!==a){for(r=[],n=oa();n!==a;)r.push(n),n=oa();r!==a?e=t=$(t,r):(In=e,e=a)}else In=e,e=a;return e}function sa(){var e,t,r,n;if(e=In,(t=ia())!==a){for(r=[],n=la();n!==a;)r.push(n),n=la();r!==a?e=t=$(t,r):(In=e,e=a)}else In=e,e=a;return e}function ia(){var t;return Z.test(e.charAt(In))?(t=e.charAt(In),In++):(t=a,0===Cn&&An(X)),t}function la(){var t;return ee.test(e.charAt(In))?(t=e.charAt(In),In++):(t=a,0===Cn&&An(te)),t}function oa(){var t;return re.test(e.charAt(In))?(t=e.charAt(In),In++):(t=a,0===Cn&&An(ne)),t}function ua(){var t,r,n;return t=In,64===e.charCodeAt(In)?(r=ae,In++):(r=a,0===Cn&&An(se)),r!==a&&(n=sa())!==a?t=r=[r,n]:(In=t,t=a),t!==a&&(t=ie(t)),t}function ca(){var e,t,r;return e=In,is()!==a&&Es()!==a&&Cs()!==a&&Es()!==a&&(t=ga())!==a&&Es()!==a&&ns()!==a&&Es()!==a&&(r=Mn())!==a&&Es()!==a&&js()!==a?e=le(t,r):(In=e,e=a),e}function ha(){var e,t,r,n,s,i,l,o;return e=In,ss()!==a&&Es()!==a&&Cs()!==a&&Es()!==a&&(t=Mn())!==a&&Es()!==a&&ns()!==a&&Es()!==a&&(r=Mn())!==a&&Es()!==a?(n=In,(s=as())!==a&&(i=Es())!==a&&(l=Mn())!==a&&(o=Es())!==a?n=s=[s,i,l,o]:(In=n,n=a),n===a&&(n=null),n!==a&&(s=js())!==a?e=oe(t,r,n):(In=e,e=a)):(In=e,e=a),e}function da(){var e,t,r,n;return e=In,ls()!==a&&Es()!==a&&Cs()!==a&&Es()!==a?((t=fa())===a&&(t=null),t!==a&&Es()!==a&&(r=Mn())!==a&&Es()!==a&&ns()!==a&&Es()!==a&&(n=Mn())!==a&&Es()!==a&&js()!==a?e=ue(t,r,n):(In=e,e=a)):(In=e,e=a),e===a&&(e=In,ls()!==a&&Es()!==a&&Cs()!==a&&Es()!==a?((t=fa())===a&&(t=null),t!==a&&Es()!==a&&(r=Mn())!==a&&Es()!==a&&js()!==a?e=ce(t,r):(In=e,e=a)):(In=e,e=a)),e}function fa(){var e;return(e=hs())===a&&(e=ds())===a&&(e=fs()),e}function pa(){var e,t,r;return e=In,os()!==a&&Es()!==a&&Cs()!==a&&Es()!==a&&(t=Mn())!==a&&Es()!==a&&Ha()!==a&&Es()!==a&&(r=Mn())!==a&&Es()!==a&&js()!==a?e=he(t,r):(In=e,e=a),e}function _a(){var e,t,r;return e=In,(t=Ds())!==a&&Es()!==a&&Cs()!==a&&Es()!==a?((r=Ln())===a&&(r=null),r!==a&&Es()!==a&&js()!==a?e=t=de(t,r):(In=e,e=a)):(In=e,e=a),e}function ga(){var e;return(e=gs())===a&&(e=ms())===a&&(e=ys())===a&&(e=bs())===a&&(e=ws())===a&&(e=vs()),e}function ma(){var e;return(e=Na())===a&&(e=Ma())===a&&(e=ja())===a&&(e=Ca())===a&&(e=xa())===a&&(e=ya())===a&&(e=ba()),e}function ya(){var e,t;return e=In,us()!==a&&Es()!==a&&(t=Ea())!==a?e=fe(t):(In=e,e=a),e}function ba(){var t,r,n,s;return t=In,_s()!==a&&Es()!==a?(45===e.charCodeAt(In)?(r=q,In++):(r=a,0===Cn&&An(B)),r===a&&(43===e.charCodeAt(In)?(r=G,In++):(r=a,0===Cn&&An(U))),r!==a&&Es()!==a&&(n=Ea())!==a&&Es()!==a&&(s=wa())!==a?t=pe(r,n,s):(In=t,t=a)):(In=t,t=a),t===a&&(t=In,_s()!==a&&Es()!==a&&(r=Ea())!==a&&Es()!==a&&(n=wa())!==a?t=_e(r,n):(In=t,t=a)),t}function wa(){var e,t,r;return e=In,(t=va())!==a&&Es()!==a&&ps()!==a&&Es()!==a&&(r=Sa())!==a?e=t=ge(t,r):(In=e,e=a),e===a&&(e=Fa()),e}function va(){var e,t,r;return e=In,(t=Ia())!==a&&Es()!==a&&Cs()!==a&&Es()!==a&&(r=Ta())!==a&&Es()!==a&&js()!==a?e=t=me(t,r):(In=e,e=a),e===a&&(e=In,(t=Ia())!==a&&(t=ye(t)),e=t),e}function Sa(){var e,t,r,n;return e=In,(t=Ia())!==a&&(t=be(t)),(e=t)===a&&(e=In,(t=vs())!==a&&Es()!==a&&Cs()!==a&&Es()!==a&&(r=Ta())!==a&&Es()!==a&&xs()!==a&&Es()!==a&&(n=Oa())!==a&&Es()!==a&&js()!==a?e=t=we(r,n):(In=e,e=a),e===a&&(e=In,(t=vs())!==a&&Es()!==a&&Cs()!==a&&Es()!==a&&(r=Ta())!==a&&Es()!==a&&js()!==a?e=t=ve(r):(In=e,e=a),e===a&&(e=In,(t=vs())!==a&&(t=Se()),e=t))),e}function Fa(){var e,t,r,n;return e=In,(t=Ia())!==a&&Es()!==a&&Cs()!==a&&Es()!==a&&(r=Oa())!==a&&Es()!==a&&js()!==a?e=t=Fe(t,r):(In=e,e=a),e===a&&(e=In,(t=Ia())!==a&&(t=ye(t)),(e=t)===a&&(e=In,(t=vs())!==a&&Es()!==a&&Cs()!==a&&Es()!==a&&(r=Ta())!==a&&Es()!==a&&xs()!==a&&Es()!==a&&(n=Oa())!==a&&Es()!==a&&js()!==a?e=t=we(r,n):(In=e,e=a),e===a&&(e=In,(t=vs())!==a&&Es()!==a&&Cs()!==a&&Es()!==a&&(r=Oa())!==a&&Es()!==a&&js()!==a?e=t=Ie(r):(In=e,e=a),e===a&&(e=In,(t=vs())!==a&&(t=Oe()),e=t)))),e}function Ia(){var e,t;return e=In,(t=ys())!==a&&(t=Te()),(e=t)===a&&(e=In,(t=bs())!==a&&(t=xe()),(e=t)===a&&(e=In,(t=ws())!==a&&(t=Ce()),(e=t)===a&&(e=In,(t=ms())!==a&&(t=je()),(e=t)===a&&(e=In,(t=gs())!==a&&(t=Ee()),e=t)))),e}function Oa(){var e;return(e=Va())!==a&&(e=Ne(e)),e}function Ta(){var e;return(e=Va())!==a&&(e=Ne(e)),e}function xa(){var e,t;return e=In,cs()!==a&&Es()!==a&&(t=Ea())!==a?e=De(t):(In=e,e=a),e}function Ca(){var e;return(e=Ja())!==a&&(e=Re()),e}function ja(){var e,t;return e=In,(t=Ya())!==a&&(t=Ae()),(e=t)===a&&(e=In,(t=Qa())!==a&&(t=Pe()),e=t),e}function Ea(){var e;return(e=Na())===a&&(e=ua()),e}function Na(){var t,r,n,s,i;if(t=In,39===e.charCodeAt(In)?(r=ke,In++):(r=a,0===Cn&&An(Le)),r===a&&(e.substr(In,2)===Me?(r=Me,In+=2):(r=a,0===Cn&&An(Ge))),r!==a){for(n=[],s=In,e.substr(In,2)===Ue?(i=Ue,In+=2):(i=a,0===Cn&&An(qe)),i!==a&&(i=Be()),(s=i)===a&&(Ve.test(e.charAt(In))?(s=e.charAt(In),In++):(s=a,0===Cn&&An(We)));s!==a;)n.push(s),s=In,e.substr(In,2)===Ue?(i=Ue,In+=2):(i=a,0===Cn&&An(qe)),i!==a&&(i=Be()),(s=i)===a&&(Ve.test(e.charAt(In))?(s=e.charAt(In),In++):(s=a,0===Cn&&An(We)));n!==a?(39===e.charCodeAt(In)?(s=ke,In++):(s=a,0===Cn&&An(Le)),s!==a?t=r=ze(n):(In=t,t=a)):(In=t,t=a)}else In=t,t=a;return t}function Da(){var e;return(e=Ra())===a&&(e=Aa()),e}function Ra(){var e,t,r,n,s;if(e=In,Ss()!==a)if(Es()!==a)if((t=Mn())!==a)if(Es()!==a){for(r=[],n=ka();n!==a;)r.push(n),n=ka();r!==a&&(n=Es())!==a&&(s=Fs())!==a?e=Je(t,r):(In=e,e=a)}else In=e,e=a;else In=e,e=a;else In=e,e=a;else In=e,e=a;if(e===a)if(e=In,Ss()!==a)if(Es()!==a)if((t=Mn())!==a)if(Es()!==a){for(r=[],n=ka();n!==a;)r.push(n),n=ka();r!==a&&(n=Es())!==a&&(s=La())!==a&&Es()!==a&&Fs()!==a?e=Ye(t,r,s):(In=e,e=a)}else In=e,e=a;else In=e,e=a;else In=e,e=a;else In=e,e=a;return e}function Aa(){var e,t,r,n;if(e=In,Ss()!==a)if(Es()!==a){for(t=[],r=Pa();r!==a;)t.push(r),r=Pa();t!==a&&(r=Es())!==a&&(n=Fs())!==a?e=Qe(t):(In=e,e=a)}else In=e,e=a;else In=e,e=a;if(e===a)if(e=In,Ss()!==a)if(Es()!==a){for(t=[],r=Pa();r!==a;)t.push(r),r=Pa();t!==a&&(r=Es())!==a&&(n=La())!==a&&Es()!==a&&Fs()!==a?e=He(t,n):(In=e,e=a)}else In=e,e=a;else In=e,e=a;return e}function Pa(){var e,t,r;return e=In,Is()!==a&&Es()!==a&&(t=Mn())!==a&&Es()!==a&&Os()!==a&&Es()!==a&&(r=Mn())!==a?e=Ke(t,r):(In=e,e=a),e}function ka(){var e,t,r;return e=In,Is()!==a&&Es()!==a&&(t=Mn())!==a&&Es()!==a&&Os()!==a&&Es()!==a&&(r=Mn())!==a?e=Ke(t,r):(In=e,e=a),e}function La(){var e,t;return e=In,Ts()!==a&&Es()!==a&&(t=Mn())!==a?e=$e(t):(In=e,e=a),e}function Ma(){var e,t,r,n;return e=In,(t=Ga())!==a?(r=In,Cn++,n=ia(),Cn--,n===a?r=void 0:(In=r,r=a),r!==a?e=t=Ze(t):(In=e,e=a)):(In=e,e=a),e}function Ga(){var e,t,r,n;return e=In,(t=Ua())!==a&&(r=qa())!==a&&(n=Ba())!==a?e=t=Xe(t,r,n):(In=e,e=a),e===a&&(e=In,(t=Ua())!==a&&(r=qa())!==a?e=t=et(t,r):(In=e,e=a),e===a&&(e=In,(t=Ua())!==a&&(r=Ba())!==a?e=t=tt(t,r):(In=e,e=a),e===a&&(e=In,(t=Ua())!==a&&(t=rt(t)),e=t))),e}function Ua(){var t,r,n;return(t=Va())===a&&(t=In,45===e.charCodeAt(In)?(r=q,In++):(r=a,0===Cn&&An(B)),r===a&&(43===e.charCodeAt(In)?(r=G,In++):(r=a,0===Cn&&An(U))),r!==a&&(n=Va())!==a?t=r=nt(r,n):(In=t,t=a)),t}function qa(){var t,r,n;return t=In,46===e.charCodeAt(In)?(r=at,In++):(r=a,0===Cn&&An(st)),r!==a?((n=Va())===a&&(n=null),n!==a?t=r=it(n):(In=t,t=a)):(In=t,t=a),t}function Ba(){var e,t,r;return e=In,(t=za())!==a&&(r=Va())!==a?e=t=lt(t,r):(In=e,e=a),e}function Va(){var e,t;if(e=[],(t=Wa())!==a)for(;t!==a;)e.push(t),t=Wa();else e=a;return e!==a&&(e=ot(e)),e}function Wa(){var t;return ut.test(e.charAt(In))?(t=e.charAt(In),In++):(t=a,0===Cn&&An(ct)),t}function za(){var t,r,n;return t=In,ht.test(e.charAt(In))?(r=e.charAt(In),In++):(r=a,0===Cn&&An(dt)),r!==a?(ft.test(e.charAt(In))?(n=e.charAt(In),In++):(n=a,0===Cn&&An(pt)),n===a&&(n=null),n!==a?t=r=_t(r,n):(In=t,t=a)):(In=t,t=a),t}function Ja(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===gt?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(mt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=[r,n]:(In=t,t=a)):(In=t,t=a),t}function Ya(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===yt?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(bt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=[r,n]:(In=t,t=a)):(In=t,t=a),t}function Qa(){var t,r,n,s;return t=In,e.substr(In,5).toLowerCase()===wt?(r=e.substr(In,5),In+=5):(r=a,0===Cn&&An(vt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=[r,n]:(In=t,t=a)):(In=t,t=a),t}function Ha(){var t,r,n,s;return t=In,e.substr(In,2).toLowerCase()===St?(r=e.substr(In,2),In+=2):(r=a,0===Cn&&An(Ft)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=It():(In=t,t=a)):(In=t,t=a),t}function Ka(){var t,r,n,s;return t=In,e.substr(In,2).toLowerCase()===Ot?(r=e.substr(In,2),In+=2):(r=a,0===Cn&&An(Tt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=xt():(In=t,t=a)):(In=t,t=a),t}function $a(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===Ct?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(jt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=Et():(In=t,t=a)):(In=t,t=a),t}function Za(){var t,r,n,s;return t=In,e.substr(In,6).toLowerCase()===Nt?(r=e.substr(In,6),In+=6):(r=a,0===Cn&&An(Dt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=Rt():(In=t,t=a)):(In=t,t=a),t}function Xa(){var t,r,n,s;return t=In,e.substr(In,3).toLowerCase()===At?(r=e.substr(In,3),In+=3):(r=a,0===Cn&&An(Pt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=kt():(In=t,t=a)):(In=t,t=a),t}function es(){var t,r,n,s;return t=In,e.substr(In,3).toLowerCase()===Lt?(r=e.substr(In,3),In+=3):(r=a,0===Cn&&An(Mt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=Gt():(In=t,t=a)):(In=t,t=a),t}function ts(){var t,r,n,s;return t=In,e.substr(In,2).toLowerCase()===Ut?(r=e.substr(In,2),In+=2):(r=a,0===Cn&&An(qt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=Bt():(In=t,t=a)):(In=t,t=a),t}function rs(){var t,r,n,s;return t=In,e.substr(In,7).toLowerCase()===Vt?(r=e.substr(In,7),In+=7):(r=a,0===Cn&&An(Wt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=zt():(In=t,t=a)):(In=t,t=a),t}function ns(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===Jt?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(Yt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=Qt():(In=t,t=a)):(In=t,t=a),t}function as(){var t,r,n,s;return t=In,e.substr(In,3).toLowerCase()===Ht?(r=e.substr(In,3),In+=3):(r=a,0===Cn&&An(Kt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=$t():(In=t,t=a)):(In=t,t=a),t}function ss(){var t,r,n,s;return t=In,e.substr(In,9).toLowerCase()===Zt?(r=e.substr(In,9),In+=9):(r=a,0===Cn&&An(Xt)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=er():(In=t,t=a)):(In=t,t=a),t}function is(){var t,r,n,s;return t=In,e.substr(In,7).toLowerCase()===tr?(r=e.substr(In,7),In+=7):(r=a,0===Cn&&An(rr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=nr():(In=t,t=a)):(In=t,t=a),t}function ls(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===ar?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(sr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=ir():(In=t,t=a)):(In=t,t=a),t}function os(){var t,r,n,s;return t=In,e.substr(In,8).toLowerCase()===lr?(r=e.substr(In,8),In+=8):(r=a,0===Cn&&An(or)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=ur():(In=t,t=a)):(In=t,t=a),t}function us(){var t,r,n,s;return t=In,e.substr(In,9).toLowerCase()===cr?(r=e.substr(In,9),In+=9):(r=a,0===Cn&&An(hr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=dr():(In=t,t=a)):(In=t,t=a),t}function cs(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===fr?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(pr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=_r():(In=t,t=a)):(In=t,t=a),t}function hs(){var t,r,n,s;return t=In,e.substr(In,7).toLowerCase()===gr?(r=e.substr(In,7),In+=7):(r=a,0===Cn&&An(mr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=yr():(In=t,t=a)):(In=t,t=a),t}function ds(){var t,r,n,s;return t=In,e.substr(In,8).toLowerCase()===br?(r=e.substr(In,8),In+=8):(r=a,0===Cn&&An(wr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=vr():(In=t,t=a)):(In=t,t=a),t}function fs(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===Sr?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(Fr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=Ir():(In=t,t=a)):(In=t,t=a),t}function ps(){var t,r,n,s;return t=In,e.substr(In,2).toLowerCase()===Or?(r=e.substr(In,2),In+=2):(r=a,0===Cn&&An(Tr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=xr():(In=t,t=a)):(In=t,t=a),t}function _s(){var t,r,n,s;return t=In,e.substr(In,8).toLowerCase()===Cr?(r=e.substr(In,8),In+=8):(r=a,0===Cn&&An(jr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=Er():(In=t,t=a)):(In=t,t=a),t}function gs(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===Nr?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(Dr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=Rr():(In=t,t=a)):(In=t,t=a),t}function ms(){var t,r,n,s;return t=In,e.substr(In,5).toLowerCase()===Ar?(r=e.substr(In,5),In+=5):(r=a,0===Cn&&An(Pr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=kr():(In=t,t=a)):(In=t,t=a),t}function ys(){var t,r,n,s;return t=In,e.substr(In,3).toLowerCase()===Lr?(r=e.substr(In,3),In+=3):(r=a,0===Cn&&An(Mr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=Gr():(In=t,t=a)):(In=t,t=a),t}function bs(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===Ur?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(qr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=Br():(In=t,t=a)):(In=t,t=a),t}function ws(){var t,r,n,s;return t=In,e.substr(In,6).toLowerCase()===Vr?(r=e.substr(In,6),In+=6):(r=a,0===Cn&&An(Wr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=zr():(In=t,t=a)):(In=t,t=a),t}function vs(){var t,r,n,s;return t=In,e.substr(In,6).toLowerCase()===Jr?(r=e.substr(In,6),In+=6):(r=a,0===Cn&&An(Yr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=Qr():(In=t,t=a)):(In=t,t=a),t}function Ss(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===Hr?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(Kr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=$r():(In=t,t=a)):(In=t,t=a),t}function Fs(){var t,r,n,s;return t=In,e.substr(In,3).toLowerCase()===Zr?(r=e.substr(In,3),In+=3):(r=a,0===Cn&&An(Xr)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=en():(In=t,t=a)):(In=t,t=a),t}function Is(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===tn?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(rn)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=nn():(In=t,t=a)):(In=t,t=a),t}function Os(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===an?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(sn)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=ln():(In=t,t=a)):(In=t,t=a),t}function Ts(){var t,r,n,s;return t=In,e.substr(In,4).toLowerCase()===on?(r=e.substr(In,4),In+=4):(r=a,0===Cn&&An(un)),r!==a?(n=In,Cn++,s=la(),Cn--,s===a?n=void 0:(In=n,n=a),n!==a?t=r=cn():(In=t,t=a)):(In=t,t=a),t}function xs(){var t;return 44===e.charCodeAt(In)?(t=hn,In++):(t=a,0===Cn&&An(dn)),t}function Cs(){var t;return 40===e.charCodeAt(In)?(t=fn,In++):(t=a,0===Cn&&An(pn)),t}function js(){var t;return 41===e.charCodeAt(In)?(t=_n,In++):(t=a,0===Cn&&An(gn)),t}function Es(){var e,t;for(e=[],t=Ns();t!==a;)e.push(t),t=Ns();return e}function Ns(){var t;return mn.test(e.charAt(In))?(t=e.charAt(In),In++):(t=a,0===Cn&&An(yn)),t}function Ds(){var t,r,n,s;if(t=In,(r=sa())!==a&&(r=K(r)),(t=r)===a)if(t=In,96===e.charCodeAt(In)?(r=bn,In++):(r=a,0===Cn&&An(wn)),r!==a){if(n=[],vn.test(e.charAt(In))?(s=e.charAt(In),In++):(s=a,0===Cn&&An(Sn)),s!==a)for(;s!==a;)n.push(s),vn.test(e.charAt(In))?(s=e.charAt(In),In++):(s=a,0===Cn&&An(Sn));else n=a;n!==a?(96===e.charCodeAt(In)?(s=bn,In++):(s=a,0===Cn&&An(wn)),s!==a?t=r=Fn(n):(In=t,t=a)):(In=t,t=a)}else In=t,t=a;return t}function Rs(e,t){return{type:"unary_expr",operator:e,expr:t}}function As(e,t,r,n){var a={type:"binary_expr",operator:e,left:t,right:r};return void 0!==n&&(a.escape=n),a}function Ps(e,t){for(var r=[e],n=0;n<t.length;n++)r.push(t[n][3]);return r}function ks(e,t,r){return Ps(e,t)}function Ls(e,t){for(var r=e,n=0;n<t.length;n++)r=As(t[n][1],r,t[n][3]);return r}if((n=i())!==a&&In===e.length)return n;throw n!==a&&In<e.length&&An(Nn()),Pn(xn,Tn<e.length?e.charAt(Tn):null,Tn<e.length?Rn(Tn,Tn+1):Rn(Tn,Tn))}return e(t,Error),t.buildMessage=function(e,t){var r={literal:function(e){return'"'+a(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?s(e.parts[t][0])+"-"+s(e.parts[t][1]):s(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function i(e){return r[e.type](e)}function l(e){var t,r,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=i(e[t]);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}function o(e){return e?'"'+a(e)+'"':"end of input"}return"Expected "+l(e)+" but "+o(t)+" found."},{SyntaxError:t,parse:r}}())}));class g{static parse(e){return _.parse(e)}}const m=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,y=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,b=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,w=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,v=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function S(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function F(e,t,r="0",n="0",a="0",s="0",i="",l="0",o="0"){if("+"===i||"-"===i){const u=`${S(parseInt(e,10),4)}-${S(parseInt(t,10),2)}-${S(parseInt(r,10),2)}`;let c="";parseFloat(s)<10&&(c="0");const h=`${S(parseInt(n,10),2)}:${S(parseInt(a,10),2)}:${c+parseFloat(s).toString()}`,d=`${i}${S(parseInt(l,10),2)}:${S(parseInt(o,10),2)}`;return new Date(u+"T"+h+d)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(r,10),parseInt(n,10),parseInt(a,10),parseFloat(s))}class I{static makeBool(e){return C(e)}static featureValue(e,t,r,n){return G(e,t,r,n)}static equalsNull(e){return null===e}static applyLike(e,t,r){return A(e,t,r)}static ensureArray(e){return j(e)}static applyIn(e,t){return R(e,t)}static currentDate(){const e=new Date;return e.setHours(0,0,0,0),e}static makeSqlInterval(e,t,r){return c.createFromValueAndQualifer(e,t,r)}static convertInterval(e){return e instanceof c?e.valueInMilliseconds():e}static currentTimestamp(){return new Date}static compare(e,t,r){return k(e,t,r)}static calculate(e,t,r){return M(e,t,r)}static makeComparable(e){return P(e)}static evaluateFunction(e,t){return h(e,t)}static lookup(e,t){const r=t[e];return void 0===r?null:r}static between(e,t){return null==e||null==t[0]||null==t[1]?null:e>=t[0]&&e<=t[1]}static notbetween(e,t){return null==e||null==t[0]||null==t[1]?null:e<t[0]||e>t[1]}static ternaryNot(e){return E(e)}static ternaryAnd(e,t){return N(e,t)}static ternaryOr(e,t){return D(e,t)}}class O{constructor(e,t){this.fieldsIndex=t,this.datefields={},this.parameters={},this.parseTree=g.parse(e);const{isStandardized:r,isAggregate:n,referencedFieldNames:a}=this.extractExpressionInfo(t);this.referencedFieldNames=a,this.isStandardized=r,this.isAggregate=n}static create(e,t){return new O(e,t)}get fieldNames(){return this.referencedFieldNames}testSet(e,t=U){const r={};for(const n of this.fieldNames)r[n]=e.map(e=>t.getAttribute(e,n));return!!this.evaluateNode(this.parseTree,{attributes:r},U)}calculateValue(e,t=U){const r=this.evaluateNode(this.parseTree,e,t);return r instanceof c?r.valueInMilliseconds()/864e5:r}calculateValueCompiled(e,t=U){return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(n["a"])("csp-restrictions")?this.calculateValue(e,t):(this.compileMe(),this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}testFeature(e,t=U){return!!this.evaluateNode(this.parseTree,e,t)}testFeatureCompiled(e,t=U){return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(n["a"])("csp-restrictions")?this.testFeature(e,t):(this.compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}getFunctions(){const e=[];return this.visitAll(this.parseTree,t=>{"function"===t.type&&e.push(t.name.toLowerCase())}),L(e)}getExpressions(){const e=new Map;return this.visitAll(this.parseTree,t=>{if("function"===t.type){const r=t.name.toLowerCase(),n=t.args.value[0];if("column_ref"===n.type){const t=n.column,a=`${r}-${t}`;e.has(a)||e.set(a,{aggregateType:r,field:t})}}}),[...e.values()]}getVariables(){const e=[];return this.visitAll(this.parseTree,t=>{"param"===t.type&&e.push(t.value.toLowerCase())}),L(e)}compileMe(){const e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",e).bind(I)}extractExpressionInfo(e){const t=[];let r=!0,n=!0;return this.visitAll(this.parseTree,a=>{switch(a.type){case"column_ref":{const r=e.get(a.column),n=r&&r.name;!r||"date"!==r.type&&"esriFieldTypeDate"!==r.type||(this.datefields[r.name]=1),void 0!==n?(t.push(n),a.column=n):t.push(a.column);break}case"function":{const{name:e,args:t}=a,i=t.value.length;r&&(r=d(e,i)),n&&(n=s(e,i));break}}}),{referencedFieldNames:L(t),isStandardized:r,isAggregate:n}}visitAll(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(const r of e.clauses)this.visitAll(r,t);"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(const r of e.value)this.visitAll(r,t);break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}}evaluateNodeToJavaScript(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case_expression":{let t="";if("simple"===e.format){const r="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";t="( ";for(let n=0;n<e.clauses.length;n++)t+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[n].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(let r=0;r<e.clauses.length;r++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[r].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[r].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t}case"param":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expr_list":{let t="[";for(const r of e.value)"["!==t&&(t+=","),t+=this.evaluateNodeToJavaScript(r);return t+="]",t}case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary_expr":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+x(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+T(e.value).getTime().toString()+"))";case"current_time":return"date"===e.mode?"this.currentDate()":"this.currentTimestamp()";case"column_ref":return"this.featureValue(feature,"+JSON.stringify(e.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)}evaluateNode(e,t,r){switch(e.type){case"interval":{const n=this.evaluateNode(e.value,t,r);return c.createFromValueAndQualifer(n,e.qualifier,e.op)}case"case_expression":if("simple"===e.format){const n=P(this.evaluateNode(e.operand,t,r));for(let a=0;a<e.clauses.length;a++)if(n===P(this.evaluateNode(e.clauses[a].operand,t,r)))return this.evaluateNode(e.clauses[a].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}else{for(let n=0;n<e.clauses.length;n++)if(C(this.evaluateNode(e.clauses[n].operand,t,r)))return this.evaluateNode(e.clauses[n].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":{const n=[];for(const a of e.value)n.push(this.evaluateNode(a,t,r));return n}case"unary_expr":return E(this.evaluateNode(e.expr,t,r));case"binary_expr":switch(e.operator){case"AND":return N(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"OR":return D(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t,r);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t,r);case"IN":{const n=j(this.evaluateNode(e.right,t,r));return R(this.evaluateNode(e.left,t,r),n)}case"NOT IN":{const n=j(this.evaluateNode(e.right,t,r));return E(R(this.evaluateNode(e.left,t,r),n))}case"BETWEEN":{const n=this.evaluateNode(e.left,t,r),a=this.evaluateNode(e.right,t,r);return null==n||null==a[0]||null==a[1]?null:n>=P(a[0])&&n<=P(a[1])}case"NOTBETWEEN":{const n=this.evaluateNode(e.left,t,r),a=this.evaluateNode(e.right,t,r);return null==n||null==a[0]||null==a[1]?null:n<P(a[0])||n>P(a[1])}case"LIKE":return A(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape);case"NOT LIKE":return E(A(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return k(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"-":case"+":case"*":case"/":return M(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r))}case"null":case"bool":case"string":case"number":return e.value;case"date":return x(e.value);case"timestamp":return T(e.value);case"current_time":{const t=new Date;return"date"===e.mode&&t.setHours(0,0,0,0),t}case"column_ref":return G(t,e.column,this.datefields,r);case"function":{const n=this.evaluateNode(e.args,t,r);return this.isAggregate?a(e.name,n):h(e.name,n)}}throw new Error("Unsupported sql syntax "+e.type)}}function T(e){let t=y.exec(e);if(null!==t){const[,e,r,n,a,s,i]=t;return F(e,r,n,a,s,i)}if(t=b.exec(e),null!==t){const[,e,r,n,a,s,i,l,o,u]=t;return F(e,r,n,a,s,i,l,o,u)}if(t=w.exec(e),null!==t){const[,e,r,n,a,s,i,l,o]=t;return F(e,r,n,a,s,"0",i,l,o)}if(t=v.exec(e),null!==t){const[,e,r,n,a,s]=t;return F(e,r,n,a,s)}if(t=m.exec(e),null!==t){const[,e,r,n]=t;return F(e,r,n)}throw new Error("SQL Invalid Timestamp")}function x(e){const t=m.exec(e);if(null===t)throw new Error("SQL Invalid Date");const[,r,n,a]=t;return new Date(parseInt(r,10),parseInt(n,10)-1,parseInt(a,10))}function C(e){return!0===e}function j(e){return Array.isArray(e)?e:[e]}function E(e){return null!==e?!0!==e:null}function N(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function D(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function R(e,t){if(null==e)return null;let r=!1;for(const n of t)if(null==n)r=null;else if(e===n){r=!0;break}return r}function A(e,t,r){if(null==e)return null;const n=t,a=r;let s="";const i="-[]/{}()*+?.\\^$|";let l=0;for(let o=0;o<n.length;o++){const e=n.charAt(o);switch(l){case 0:e===a?l=1:i.indexOf(e)>=0?s+="\\"+e:s+="%"===e?".*":"_"===e?".":e;break;case 1:i.indexOf(e)>=0?s+="\\"+e:s+=e,l=0}}return new RegExp("^"+s+"$").test(e)}function P(e){return e instanceof Date?e.valueOf():e}function k(e,t,r){if(null==t||null==r)return null;const n=P(t),a=P(r);switch(e){case"<>":return n!==a;case"=":return n===a;case">":return n>a;case"<":return n<a;case">=":return n>=a;case"<=":return n<=a}}function L(e){const t=[],r={};for(const n of e){const e=n.toLowerCase();void 0===r[e]&&(t.push(n),r[e]=1)}return t}function M(e,t,r){if(t instanceof c)if(r instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+r.getTime());case"-":return t.valueInMilliseconds()-r.getTime();case"*":return t.valueInMilliseconds()*r.getTime();case"/":return t.valueInMilliseconds()/r.getTime()}else if(r instanceof c)switch(e){case"+":return c.createFromMilliseconds(t.valueInMilliseconds()+r.valueInMilliseconds());case"-":return c.createFromMilliseconds(t.valueInMilliseconds()-r.valueInMilliseconds());case"*":return t.valueInMilliseconds()*r.valueInMilliseconds();case"/":return t.valueInMilliseconds()/r.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(r instanceof c)if(t instanceof Date)switch(e){case"+":return new Date(r.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-r.valueInMilliseconds());case"*":return t.getTime()*r.valueInMilliseconds();case"/":return t.getTime()/r.valueInMilliseconds()}else r=r.valueInMilliseconds();else if(t instanceof Date&&"number"==typeof r)switch(r=24*r*60*60*1e3,t=t.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}else if(r instanceof Date&&"number"==typeof t)switch(t=24*t*60*60*1e3,r=r.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r}}function G(e,t,r,n){const a=n.getAttribute(e,t);return null!=a&&1===r[t]?new Date(a):a}const U={getAttribute(e,t){var r;return((r=e)&&"object"==typeof r.attributes?e.attributes:e)[t]}}},"7efa":function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return n}));const n={Base64:0,Hex:1,String:2,Raw:3};function a(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function s(e,t,r,n,s,i){return a((l=a(a(t,e),a(n,i)))<<(o=s)|l>>>32-o,r);var l,o}function i(e,t,r,n,a,i,l){return s(t&r|~t&n,e,t,a,i,l)}function l(e,t,r,n,a,i,l){return s(t&n|r&~n,e,t,a,i,l)}function o(e,t,r,n,a,i,l){return s(t^r^n,e,t,a,i,l)}function u(e,t,r,n,a,i,l){return s(r^(t|~n),e,t,a,i,l)}function c(e,t=n.Hex){const r=t||n.Base64,s=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let r=1732584193,n=-271733879,s=-1732584194,c=271733878;for(let h=0;h<e.length;h+=16){const t=r,d=n,f=s,p=c;r=i(r,n,s,c,e[h+0],7,-680876936),c=i(c,r,n,s,e[h+1],12,-389564586),s=i(s,c,r,n,e[h+2],17,606105819),n=i(n,s,c,r,e[h+3],22,-1044525330),r=i(r,n,s,c,e[h+4],7,-176418897),c=i(c,r,n,s,e[h+5],12,1200080426),s=i(s,c,r,n,e[h+6],17,-1473231341),n=i(n,s,c,r,e[h+7],22,-45705983),r=i(r,n,s,c,e[h+8],7,1770035416),c=i(c,r,n,s,e[h+9],12,-1958414417),s=i(s,c,r,n,e[h+10],17,-42063),n=i(n,s,c,r,e[h+11],22,-1990404162),r=i(r,n,s,c,e[h+12],7,1804603682),c=i(c,r,n,s,e[h+13],12,-40341101),s=i(s,c,r,n,e[h+14],17,-1502002290),n=i(n,s,c,r,e[h+15],22,1236535329),r=l(r,n,s,c,e[h+1],5,-165796510),c=l(c,r,n,s,e[h+6],9,-1069501632),s=l(s,c,r,n,e[h+11],14,643717713),n=l(n,s,c,r,e[h+0],20,-373897302),r=l(r,n,s,c,e[h+5],5,-701558691),c=l(c,r,n,s,e[h+10],9,38016083),s=l(s,c,r,n,e[h+15],14,-660478335),n=l(n,s,c,r,e[h+4],20,-405537848),r=l(r,n,s,c,e[h+9],5,568446438),c=l(c,r,n,s,e[h+14],9,-1019803690),s=l(s,c,r,n,e[h+3],14,-187363961),n=l(n,s,c,r,e[h+8],20,1163531501),r=l(r,n,s,c,e[h+13],5,-1444681467),c=l(c,r,n,s,e[h+2],9,-51403784),s=l(s,c,r,n,e[h+7],14,1735328473),n=l(n,s,c,r,e[h+12],20,-1926607734),r=o(r,n,s,c,e[h+5],4,-378558),c=o(c,r,n,s,e[h+8],11,-2022574463),s=o(s,c,r,n,e[h+11],16,1839030562),n=o(n,s,c,r,e[h+14],23,-35309556),r=o(r,n,s,c,e[h+1],4,-1530992060),c=o(c,r,n,s,e[h+4],11,1272893353),s=o(s,c,r,n,e[h+7],16,-155497632),n=o(n,s,c,r,e[h+10],23,-1094730640),r=o(r,n,s,c,e[h+13],4,681279174),c=o(c,r,n,s,e[h+0],11,-358537222),s=o(s,c,r,n,e[h+3],16,-722521979),n=o(n,s,c,r,e[h+6],23,76029189),r=o(r,n,s,c,e[h+9],4,-640364487),c=o(c,r,n,s,e[h+12],11,-421815835),s=o(s,c,r,n,e[h+15],16,530742520),n=o(n,s,c,r,e[h+2],23,-995338651),r=u(r,n,s,c,e[h+0],6,-198630844),c=u(c,r,n,s,e[h+7],10,1126891415),s=u(s,c,r,n,e[h+14],15,-1416354905),n=u(n,s,c,r,e[h+5],21,-57434055),r=u(r,n,s,c,e[h+12],6,1700485571),c=u(c,r,n,s,e[h+3],10,-1894986606),s=u(s,c,r,n,e[h+10],15,-1051523),n=u(n,s,c,r,e[h+1],21,-2054922799),r=u(r,n,s,c,e[h+8],6,1873313359),c=u(c,r,n,s,e[h+15],10,-30611744),s=u(s,c,r,n,e[h+6],15,-1560198380),n=u(n,s,c,r,e[h+13],21,1309151649),r=u(r,n,s,c,e[h+4],6,-145523070),c=u(c,r,n,s,e[h+11],10,-1120210379),s=u(s,c,r,n,e[h+2],15,718787259),n=u(n,s,c,r,e[h+9],21,-343485551),r=a(r,t),n=a(n,d),s=a(s,f),c=a(c,p)}return[r,n,s,c]}(function(e){const t=[];for(let r=0,n=8*e.length;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}(e),8*e.length);switch(r){case n.Raw:return s;case n.Hex:return function(e){const t="0123456789abcdef",r=[];for(let n=0,a=4*e.length;n<a;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}(s);case n.String:return function(e){const t=[];for(let r=0,n=32*e.length;r<n;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}(s);case n.Base64:return function(e){const t=[];for(let r=0,n=4*e.length;r<n;r+=3){const n=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255;for(let a=0;a<4;a++)8*r+6*a>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>6*(3-a)&63))}return t.join("")}(s)}}},8016:function(e,t,r){"use strict";var n=r("f4cc"),a=r("853c"),s=r("bb51"),i=r("64fc"),l=r("4f73"),o=r("18df");class u extends l["a"]{constructor(e){super(e),this._relation="",this._relationGeom=null,this._relationString="",this.declaredClass="esri.arcade.featureset.actions.SpatialFilter",this._relationString=e.relationString,this._parent=e.parentfeatureset,this._maxProcessing=40,this._relation=e.relation,this._relationGeom=e.relationGeom}_getSet(e){return null===this._wset?this._ensureLoaded().then(()=>this._parent._getFilteredSet("esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,null,null,e)).then(t=>(this._checkCancelled(e),this._wset=new i["a"](t._candidates.slice(0),t._known.slice(0),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset)):Object(n["u"])(this._wset)}_isInFeatureSet(e){let t=this._parent._isInFeatureSet(e);return t===a["b"].NotInFeatureSet?t:(t=this._idstates[e],void 0===t?a["b"].Unknown:t)}_getFeature(e,t,r){return this._parent._getFeature(e,t,r)}_getFeatures(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}_featureFromCache(e){return this._parent._featureFromCache(e)}executeSpatialRelationTest(e){if(null===e.geometry)return Object(n["u"])(!1);switch(this._relation){case"esriSpatialRelEnvelopeIntersects":{const t=Object(a["p"])(this._relationGeom),r=Object(a["p"])(e.geometry);return Object(s["q"])(t,r)}case"esriSpatialRelIntersects":return Object(s["q"])(this._relationGeom,e.geometry);case"esriSpatialRelContains":return Object(s["c"])(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return Object(s["t"])(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return Object(s["C"])(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return Object(s["A"])(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return Object(s["d"])(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return Object(s["w"])(this._relationGeom,e.geometry,this._relationString)}}_fetchAndRefineFeatures(e,t,r){const s=new i["a"]([],e,!1,null),l=Math.min(t,e.length);return this._parent._getFeatures(s,-1,l,r).then(()=>{this._checkCancelled(r);const t=[];for(let r=0;r<l;r++){const n=this._parent._featureFromCache(e[r]);t.push(this.executeSpatialRelationTest(n))}return Object(n["b"])(t)}).then(r=>{for(let n=0;n<t;n++)!0===r[n]?this._idstates[e[n]]=a["b"].InFeatureSet:this._idstates[e[n]]=a["b"].NotInFeatureSet;return"success"})}_getFilteredSet(e,t,r,n,a){return this._ensureLoaded().then(()=>this._parent._getFilteredSet("esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,r,n,a)).then(e=>{let r;return this._checkCancelled(a),r=null!==t?new i["a"](e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)):new i["a"](e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition)),r})}_stat(e,t,r,a,s,i,l){return""!==r?Object(n["u"])({calculated:!1}):this._parent._stat(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,s,i,l).then(n=>!1===n.calculated?null===s&&""===r&&null===a?this._manualStat(e,t,i,l):{calculated:!1}:n)}_canDoAggregates(e,t,r,a,s){return""!==r||null!==a||null===this._parent?Object(n["u"])(!1):this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,s)}_getAggregatePagesDataSourceDefinition(e,t,r,a,s,i,l){return null===this._parent?Object(n["t"])(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,s,i,l)}static registerAction(){l["a"]._featuresetFunctions.intersects=function(e){return null==e?new o["a"]({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},l["a"]._featuresetFunctions.envelopeIntersects=function(e){return null==e?new o["a"]({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},l["a"]._featuresetFunctions.contains=function(e){return null==e?new o["a"]({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},l["a"]._featuresetFunctions.overlaps=function(e){return null==e?new o["a"]({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},l["a"]._featuresetFunctions.within=function(e){return null==e?new o["a"]({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},l["a"]._featuresetFunctions.touches=function(e){return null==e?new o["a"]({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},l["a"]._featuresetFunctions.crosses=function(e){return null==e?new o["a"]({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},l["a"]._featuresetFunctions.relate=function(e,t){return null==e?new o["a"]({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})}}}t["a"]=u},"80b7":function(e,t,r){"use strict";function n(e){return"date"===e.type||"esriFieldTypeDate"===e.type}function a(e){return e.toLowerCase().trim()}t["a"]=class{constructor(e){if(this.fields=e,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this.dateFields=[],!e)return;const t=[];for(const r of e){const e=r&&r.name;if(e){const s=a(e);this._fieldsMap.set(e,r),this._fieldsMap.set(s,r),t.push(s),n(r)&&(this.dateFields.push(r),this._dateFieldsSet.add(r))}}t.sort(),this.uid=t.join(",")}destroy(){this._fieldsMap.clear()}has(e){return null!=this.get(e)}get(e){return null!=e?this._fieldsMap.get(e)||this._fieldsMap.get(a(e)):void 0}isDateField(e){return this._dateFieldsSet.has(this.get(e))}normalizeFieldName(e){const t=this.get(e);if(t)return t.name}}},8246:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return o})),r.d(t,"f",(function(){return c})),r.d(t,"g",(function(){return u}));const n=[252,146,31,255],a={type:"esriSMS",style:"esriSMSCircle",size:6,color:n,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},s={type:"esriSLS",style:"esriSLSSolid",width:.75,color:n},i={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},o={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},u={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},c={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},"8b28":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r("a4ee"),a=(r("c120"),r("e92d"),r("cea0"),r("59b2")),s=r("d386");r("e041"),r("8eed"),r("f402");const i=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return Object(n["a"])([Object(a["b"])({json:{write:!0,origins:{"web-scene":{write:!1}}}})],t.prototype,"customParameters",void 0),t=Object(n["a"])([Object(s["a"])("esri.layers.mixins.CustomParametersMixin")],t),t}},"94dc":function(e,t,r){"use strict";var n=r("f4cc");t["a"]=class{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(e,t,r){this._layerById[t]=r,this._layerByName[e]=r}featureSetByName(e,t=!0,r=["*"]){return void 0===this._layerByName[e]?this.resolvePromise(null):this.resolvePromise(this._layerByName[e])}featureSetById(e,t=!0,r=["*"]){return void 0===this._layerById[e]?this.resolvePromise(null):this.resolvePromise(this._layerById[e])}castToText(){return"object, FeatureSetCollection"}resolvePromise(e){return Object(n["u"])(e)}}},"96af":function(e,t,r){"use strict";function n(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}class a{constructor(e){const t=e.split(",");this._fields=[],this._directions=[];for(let r=0;r<t.length;r++){const e=t[r].match(/\S+/g);this._fields.push(e[0]),2===e.length?"asc"===e[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let e="";for(let t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e}order(e){e.sort((e,t)=>{for(let r=0;r<this._fields.length;r++){const a=this.featureValue(e.feature,this._fields[r],r),s=this.featureValue(t.feature,this._fields[r],r);let i=0;if(i=1===this._directions[r]?n(a,s):-1*n(a,s),0!==i)return i}return 0})}scanForField(e){for(let t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1}replaceFields(e){let t="";for(let r=0;r<this._fields.length;r++){0!==r&&(t+=",");let n=this._fields[r];for(const t of e)if(n.toLowerCase()===t.field.toLowerCase()){n=t.newfield;break}t+=n,1===this._directions[r]?t+=" ASC":t+=" DESC"}return new a(t)}featureValue(e,t,r){const n=e.attributes[t];if(void 0!==n)return n;for(const a in e.attributes)if(t.toLowerCase()===a.toLowerCase())return this._fields[r]=a,e.attributes[a];return null}}t["a"]=a},"9b40":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r("2255"),a=r("8048");const s={inches:Object(a["a"])(1,"meters","inches"),feet:Object(a["a"])(1,"meters","feet"),"us-feet":Object(a["a"])(1,"meters","us-feet"),yards:Object(a["a"])(1,"meters","yards"),miles:Object(a["a"])(1,"meters","miles"),"nautical-miles":Object(a["a"])(1,"meters","nautical-miles"),millimeters:Object(a["a"])(1,"meters","millimeters"),centimeters:Object(a["a"])(1,"meters","centimeters"),decimeters:Object(a["a"])(1,"meters","decimeters"),meters:Object(a["a"])(1,"meters","meters"),kilometers:Object(a["a"])(1,"meters","kilometers"),"decimal-degrees":1/Object(a["h"])(1,"meters",n["a"].radius)}},"9c2d":function(e,t,r){"use strict";var n=r("f4cc"),a=r("5996"),s=r("853c"),i=r("64fc"),l=r("66a2"),o=r("07c7"),u=r("4f73");class c extends u["a"]{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=e.parentfeatureset,e.whereclause instanceof l["WhereClause"]?(this._whereclause=e.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=e.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new a["a"]({wkid:4326}),this.geometryType=s["m"].point)}_getSet(e){return null===this._wset?this._ensureLoaded().then(()=>this._parent._getFilteredSet("",null,this._whereclause,null,e)).then(t=>(this._checkCancelled(e),null!==this._whereClauseFunction?this._wset=new i["a"](t._candidates.slice(0).concat(t._known.slice(0)),[],t._ordered,this._clonePageDefinition(t.pagesDefinition)):this._wset=new i["a"](t._candidates.slice(0),t._known.slice(0),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset)):Object(n["u"])(this._wset)}_isInFeatureSet(e){let t=this._parent._isInFeatureSet(e);return t===s["b"].NotInFeatureSet?t:(t=this._idstates[e],void 0===t?s["b"].Unknown:t)}_getFeature(e,t,r){return this._parent._getFeature(e,t,r)}_getFeatures(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}_featureFromCache(e){return this._parent._featureFromCache(e)}executeWhereClause(e){return this._whereclause.testFeature(e)}executeWhereClauseDeferred(e){if(null!==this._whereClauseFunction)try{const t=this._whereClauseFunction(e);return Object(n["p"])(t)?t:Object(n["u"])(t)}catch(t){return Object(n["t"])(t)}return Object(n["u"])(this.executeWhereClause(e))}_fetchAndRefineFeatures(e,t,r){const a=new i["a"]([],e,!1,null),l=Math.min(t,e.length);return this._parent._getFeatures(a,-1,l,r).then(()=>{if(this._checkCancelled(r),null==this._whereClauseFunction){for(let t=0;t<l;t++){const r=this._parent._featureFromCache(e[t]);!0===this.executeWhereClause(r)?this._idstates[e[t]]=s["b"].InFeatureSet:this._idstates[e[t]]=s["b"].NotInFeatureSet}return"success"}const a=[];for(let t=0;t<l;t++){const r=this._parent._featureFromCache(e[t]);a.push(this.executeWhereClauseDeferred(r))}return Object(n["b"])(a).then(r=>{for(let n=0;n<t;n++)!0===r[n]?this._idstates[e[n]]=s["b"].InFeatureSet:this._idstates[e[n]]=s["b"].NotInFeatureSet;return"success"})})}_getFilteredSet(e,t,r,n,a){return null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=Object(o["a"])(this._whereclause,r)):r=this._whereclause),this._ensureLoaded().then(()=>this._parent._getFilteredSet(e,t,r,n,a)).then(e=>{let t;return this._checkCancelled(a),t=null!==this._whereClauseFunction?new i["a"](e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)):new i["a"](e._candidates.slice(0),e._known.slice(0),e._ordered,this._clonePageDefinition(e.pagesDefinition)),t})}_stat(e,t,r,a,s,i,l){if(null!==this._whereClauseFunction)return null===s&&""===r&&null===a?this._manualStat(e,t,i,l):Object(n["u"])({calculated:!1});let u=this._whereclause;return null!==s&&null!==this._whereclause&&(u=Object(o["a"])(this._whereclause,s)),this._parent._stat(e,t,r,a,u,i,l).then(n=>!1===n.calculated?null===s&&""===r&&null===a?this._manualStat(e,t,i,l):{calculated:!1}:n)}_canDoAggregates(e,t,r,a,s){return null!==this._whereClauseFunction?Object(n["u"])(!1):(null!==s?null!==this._whereclause&&(s=Object(o["a"])(this._whereclause,s)):s=this._whereclause,null===this._parent?Object(n["u"])(!1):this._parent._canDoAggregates(e,t,r,a,s))}_getAggregatePagesDataSourceDefinition(e,t,r,a,s,i,l){return null===this._parent?Object(n["t"])(new Error("Should never be called")):(null!==s?null!==this._whereclause&&(s=Object(o["a"])(this._whereclause,s)):s=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,r,a,s,i,l))}static registerAction(){u["a"]._featuresetFunctions.filter=function(e){if("function"==typeof e)return new c({parentfeatureset:this,whereclause:e});let t=null;return e instanceof l["WhereClause"]&&(t=e),new c({parentfeatureset:this,whereclause:t})}}}t["a"]=c},a2b1:function(e,t,r){"use strict";var n=r("a4ee"),a=(r("c120"),r("7ffa")),s=(r("e92d"),r("cea0"),r("59b2")),i=r("afcf"),l=r("d386"),o=r("09db"),u=(r("e041"),r("8eed"),r("f402"),r("6a0e")),c=r("4106"),h=r("b5a9"),d=r("df3d"),f=(r("5970"),r("ace4"));let p=class extends u["a"]{constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const r in e)if(e.hasOwnProperty(r)){const n=e[r];switch(n.type){case"range":t[r]=d["a"].fromJSON(n);break;case"codedValue":t[r]=c["a"].fromJSON(n);break;case"inherited":t[r]=h["a"].fromJSON(n)}}return t}writeDomains(e,t){const r={};for(const n in e)e.hasOwnProperty(n)&&(r[n]=e[n]&&e[n].toJSON());Object(a["c"])(r),t.domains=r}readTemplates(e){return e&&e.map(e=>new f["a"](e))}writeTemplates(e,t){t.templates=e&&e.map(e=>e.toJSON())}};Object(n["a"])([Object(s["b"])({json:{write:!0}})],p.prototype,"id",void 0),Object(n["a"])([Object(s["b"])({json:{write:!0}})],p.prototype,"name",void 0),Object(n["a"])([Object(s["b"])({json:{write:!0}})],p.prototype,"domains",void 0),Object(n["a"])([Object(i["a"])("domains")],p.prototype,"readDomains",null),Object(n["a"])([Object(o["a"])("domains")],p.prototype,"writeDomains",null),Object(n["a"])([Object(s["b"])({json:{write:!0}})],p.prototype,"templates",void 0),Object(n["a"])([Object(i["a"])("templates")],p.prototype,"readTemplates",null),Object(n["a"])([Object(o["a"])("templates")],p.prototype,"writeTemplates",null),p=Object(n["a"])([Object(l["a"])("esri.layers.support.FeatureType")],p);var _=p;t["a"]=_},ace4:function(e,t,r){"use strict";var n=r("a4ee"),a=(r("c120"),r("7ffa")),s=(r("e92d"),r("cea0"),r("59b2")),i=r("fa8a"),l=r("d386"),o=r("09db"),u=(r("e041"),r("8eed"),r("f402"),r("6a0e"));const c=new i["a"]({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let h=class extends u["a"]{constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}writeDrawingTool(e,t){t.drawingTool=c.toJSON(e)}writePrototype(e,t){t.prototype=Object(a["c"])(Object(a["a"])(e),!0)}writeThumbnail(e,t){t.thumbnail=Object(a["c"])(Object(a["a"])(e))}};Object(n["a"])([Object(s["b"])({json:{write:!0}})],h.prototype,"name",void 0),Object(n["a"])([Object(s["b"])({json:{write:!0}})],h.prototype,"description",void 0),Object(n["a"])([Object(s["b"])({json:{read:c.read,write:c.write}})],h.prototype,"drawingTool",void 0),Object(n["a"])([Object(o["a"])("drawingTool")],h.prototype,"writeDrawingTool",null),Object(n["a"])([Object(s["b"])({json:{write:!0}})],h.prototype,"prototype",void 0),Object(n["a"])([Object(o["a"])("prototype")],h.prototype,"writePrototype",null),Object(n["a"])([Object(s["b"])({json:{write:!0}})],h.prototype,"thumbnail",void 0),Object(n["a"])([Object(o["a"])("thumbnail")],h.prototype,"writeThumbnail",null),h=Object(n["a"])([Object(l["a"])("esri.layers.support.FeatureTemplate")],h);var d=h;t["a"]=d},aefa:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return i}));var n=r("8a44");const a=-3;class s{constructor(e,t,r){this._namespace=e,this._storage=t,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this)}put(e,t,r,n=0){this._storage.put(this._namespace+e,t,r,n)}get(e){const t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}pop(e){const t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}updateSize(e,t,r){this._storage.updateSize(this._namespace+e,t,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class i{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=[],this._users=new n["a"]}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs=this._removeFuncs.filter(t=>t[0]!==e)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,t,r,n){const a=this._db.get(e);if(a&&(this._size-=a.size,this._db.delete(e),a.entry!==t&&this._notifyRemoved(e,a.entry)),r>this._maxSize)return void this._notifyRemoved(e,t);if(void 0===t)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const s=1+Math.max(n,-3)- -3;this._db.set(e,{entry:t,size:r,lifetime:s,lives:s}),this._size+=r,this._checkSizeLimit()}updateSize(e,t,r){const n=this._db.get(e);n&&n.entry===t&&(this._size-=n.size,r>this._maxSize?this._notifyRemoved(e,t):(n.size=r,this._size+=r,this._checkSizeLimit()))}pop(e){const t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}get(e){const t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach((e,n)=>{const a=e.lifetime;r[a]=(r[a]||0)+e.size,this._users.forAll(r=>{const a=r.namespace;if(n.startsWith(a)){const r=t[a]||0;t[a]=r+e.size}})});const n={};this._users.forAll(e=>{const r=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){const a=t[r]||0;t[r]=a,n[r]=Math.round(100*e.hitRate)+"%"}else n[r]="0%"});const a=Object.keys(t);a.forEach(e=>t[e]=t[e]/this._size*100),a.sort((e,r)=>t[r]-t[e]),a.forEach(r=>e[r]=Math.round(t[r])+"% / "+n[r]);for(let s=r.length-1;s>=0;--s){const t=r[s];t&&(e["Priority "+(s+-3-1)]=Math.round(t/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){this._db.forEach((t,r)=>{r.startsWith(e)&&(this._size-=t.size,this._db.delete(r),this._notifyRemoved(r,t.entry))})}clearAll(){this._db.forEach((e,t)=>this._notifyRemoved(t,e.entry)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemoved(e,t){this._removeFuncs.forEach(r=>{e.startsWith(r[0])&&r[1](t)})}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,t]of this._db)if(this._db.delete(e),t.lives<=1?(this._size-=t.size,this._notifyRemoved(e,t.entry)):(--t.lives,this._db.set(e,t)),this._size<=.9*this.maxSize)return}}},b1dc:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return S})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return f})),r.d(t,"h",(function(){return m})),r.d(t,"i",(function(){return y})),r.d(t,"j",(function(){return g}));var n=r("f4cc"),a=r("89da"),s=r("853c"),i=r("07c7");function l(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/e.length}function o(e){const t=l(e);let r=0;for(let n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/e.length}function u(e){const t=l(e);let r=0;for(let n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/(e.length-1)}function c(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t}function h(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""}function d(e,t,r=1e3){switch(e.toLowerCase()){case"distinct":return function(e,t){const r=[],n={},a=[];for(let i=0;i<e.length;i++){if(void 0!==e[i]&&null!==e[i]){const t=e[i];if(Object(s["j"])(t)||Object(s["k"])(t))void 0===n[t]&&(r.push(t),n[t]=1);else{let e=!1;for(let r=0;r<a.length;r++)!0===Object(s["g"])(a[r],t)&&(e=!0);!1===e&&(a.push(t),r.push(t))}}if(r.length>=t&&-1!==t)return r}return r}(t,r);case"avg":case"mean":return l(t);case"min":return Math.min.apply(Math,t);case"sum":return c(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(o(t));case"var":case"variance":return o(t);case"count":return t.length}return 0}function f(e,t,r){return w(e,t,r,!0).then(e=>0===e.length?null:Math.min.apply(Math,e))}function p(e,t,r){return w(e,t,r,!0).then(e=>0===e.length?null:Math.max.apply(Math,e))}function _(e,t,r){let n="";return!1===Object(i["c"])(t)&&(n=Object(i["f"])(t,e.fields,null)),w(e,t,r,!0).then(e=>{if(0===e.length)return null;const t=l(e);return null===t?t:"integer"===n?(r=+(r=t),isFinite(r)?r-r%1||(r<0?-0:0===r?r:0):r):t;var r})}function g(e,t,r){return w(e,t,r,!0).then(e=>0===e.length?null:u(e))}function m(e,t,r){return w(e,t,r,!0).then(e=>0===e.length?null:Math.sqrt(u(e)))}function y(e,t,r){return w(e,t,r,!0).then(e=>0===e.length?null:c(e))}function b(e,t){try{return e.iterator(t).count()}catch(e){return Object(n["t"])(e)}}function w(e,t,r,a=!1){try{const s=e.iterator(r);return Object(n["c"])((e,r)=>{v(s,[],t,a,e,r)})}catch(s){return Object(n["t"])(s)}}function v(e,t,r,n,s,i){Object(a["q"])(e.next().then(a=>{try{if(null!==a){const l=r.calculateValue(a);return null===l?!1===n&&(t[t.length]=l):t[t.length]=l,v(e,t,r,n,s,i)}s(t)}catch(e){i(e)}},i))}function S(e,t,r=1e3,a=null){return function(e,t,r,a){try{return F(e.iterator(a),{},[],t,r)}catch(e){return Object(n["t"])(e)}}(e,t,r,a)}function F(e,t,r,n,a){return e.next().then(s=>{if(null!==s){const i=n.calculateValue(s);return null!=i&&void 0===t[i]&&(r.push(i),t[i]=1),r.length>=a&&-1!==a?r:F(e,t,r,n,a)}return r})}},bb51:function(e,t,r){"use strict";r.d(t,"a",(function(){return j})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return A})),r.d(t,"g",(function(){return I})),r.d(t,"h",(function(){return b})),r.d(t,"i",(function(){return p})),r.d(t,"j",(function(){return _})),r.d(t,"k",(function(){return R})),r.d(t,"l",(function(){return M})),r.d(t,"m",(function(){return E})),r.d(t,"n",(function(){return P})),r.d(t,"o",(function(){return G})),r.d(t,"p",(function(){return T})),r.d(t,"q",(function(){return g})),r.d(t,"r",(function(){return S})),r.d(t,"s",(function(){return C})),r.d(t,"t",(function(){return w})),r.d(t,"u",(function(){return k})),r.d(t,"v",(function(){return L})),r.d(t,"w",(function(){return v})),r.d(t,"x",(function(){return D})),r.d(t,"y",(function(){return F})),r.d(t,"z",(function(){return O})),r.d(t,"A",(function(){return m})),r.d(t,"B",(function(){return x})),r.d(t,"C",(function(){return y}));r("4ae5");var n=r("a9ab"),a=(r("e06a"),r("dfa0"));function s(e){var t;return Array.isArray(e)?null==(t=e[0])?void 0:t.spatialReference:null==e?void 0:e.spatialReference}function i(e){return e?Array.isArray(e)?e.map(i):e.toJSON?e.toJSON():e:e}function l(e){return Array.isArray(e)?e.map(e=>Object(n["a"])(e)):Object(n["a"])(e)}let o;async function u(e,t){return(await async function(){return o||(o=Object(a["b"])("geometryEngineWorker",{strategy:"distributed"})),o}()).invoke("executeGEOperation",{operation:e,parameters:i(t)})}async function c(e,t){return l(await u("clip",[s(e),e,t]))}async function h(e,t){return l(await u("cut",[s(e),e,t]))}function d(e,t){return u("contains",[s(e),e,t])}function f(e,t){return u("crosses",[s(e),e,t])}function p(e,t,r){return u("distance",[s(e),e,t,r])}function _(e,t){return u("equals",[s(e),e,t])}function g(e,t){return u("intersects",[s(e),e,t])}function m(e,t){return u("touches",[s(e),e,t])}function y(e,t){return u("within",[s(e),e,t])}function b(e,t){return u("disjoint",[s(e),e,t])}function w(e,t){return u("overlaps",[s(e),e,t])}function v(e,t,r){return u("relate",[s(e),e,t,r])}function S(e){return u("isSimple",[s(e),e])}async function F(e){return l(await u("simplify",[s(e),e]))}async function I(e,t){return l(await u("difference",[s(e),e,t]))}async function O(e,t){return l(await u("symmetricDifference",[s(e),e,t]))}async function T(e,t){return l(await u("intersect",[s(e),e,t]))}async function x(e,t=null){const r=function(e,t){let r;return Array.isArray(e)?r=e:(r=[],r.push(e),null!=t&&r.push(t)),r}(e,t);return l(await u("union",[s(r),r]))}async function C(e,t,r,n,a,i){return l(await u("offset",[s(e),e,t,r,n,a,i]))}async function j(e,t,r,n=!1){const a=[s(e),e,t,r,n];return l(await u("buffer",a))}async function E(e,t,r,n,a,i){const o=[s(e),e,t,r,n,a,i];return l(await u("geodesicBuffer",o))}function N(e){return"xmin"in e?e.center:"x"in e?e:e.extent.center}async function D(e,t,r){var n;if(null==e)throw new Error("Illegal Argument Exception");const a=e.spatialReference;r=null!=(n=r)?n:N(e);const s=e.constructor.fromJSON(await u("rotate",[a,e,t,r]));return s.spatialReference=a,s}async function R(e,t,r,n){return l(await u("generalize",[s(e),e,t,r,n]))}async function A(e,t,r){return l(await u("densify",[s(e),e,t,r]))}async function P(e,t,r,n=0){return l(await u("geodesicDensify",[s(e),e,t,r,n]))}function k(e,t){return u("planarArea",[s(e),e,t])}function L(e,t){return u("planarLength",[s(e),e,t])}function M(e,t,r){return u("geodesicArea",[s(e),e,t,r])}function G(e,t,r){return u("geodesicLength",[s(e),e,t,r])}},d297:function(e,t,r){"use strict";r.d(t,"a",(function(){return F})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return _})),r.d(t,"d",(function(){return g})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return v})),r.d(t,"g",(function(){return f}));var n=r("6c97"),a=r("b2b2"),s=r("e92d"),i=r("9ef0"),l=r("8d60"),o=r("9b40"),u=r("86f2");const c=s["a"].getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),h=new l["a"],d=Math.PI,f=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function p(e,t,r){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"color"===e.type)[0]:e;if(!n)return;if("esri.renderers.visualVariables.ColorVariable"!==n.declaredClass)return void c.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s="number"==typeof t,l=s?null:t,o=l&&l.attributes;let u=s?t:null;const h=n.field,{ipData:d,hasExpression:f}=n.cache;let p=n.cache.compiledFunc;if(!h&&!f){const e=n.stops;return e&&e[0]&&e[0].color}if("number"!=typeof u)if(f){if(!Object(a["h"])(r)||!Object(a["h"])(r.arcade))return void c.error("Use of arcade expressions requires an arcade context");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,s=t.getViewInfo(e),i=t.createExecContext(l,s);if(!p){const e=t.createSyntaxTree(n.valueExpression);p=t.createFunction(e),n.cache.compiledFunc=p}u=t.executeFunction(p,i)}else o&&(u=o[h]);const _=n.normalizationField,g=o?parseFloat(o[_]):void 0;if(null!=u&&(!_||s||!isNaN(g)&&0!==g)){isNaN(g)||s||(u/=g);const e=S(u,d);if(e){const t=e[0],s=e[1],l=t===s?n.stops[t].color:i["a"].blendColors(n.stops[t].color,n.stops[s].color,e[2],Object(a["h"])(r)?r.color:void 0);return new i["a"](l)}}}function _(e,t,r){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"opacity"===e.type)[0]:e;if(!n)return;if("esri.renderers.visualVariables.OpacityVariable"!==n.declaredClass)return void c.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s="number"==typeof t,i=s?null:t,l=i&&i.attributes;let o=s?t:null;const u=n.field,{ipData:h,hasExpression:d}=n.cache;let f=n.cache.compiledFunc;if(!u&&!d){const e=n.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof o)if(d){if(Object(a["g"])(r)||Object(a["g"])(r.arcade))return void c.error("Use of arcade expressions requires an arcade context");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,s=t.getViewInfo(e),l=t.createExecContext(i,s);if(!f){const e=t.createSyntaxTree(n.valueExpression);f=t.createFunction(e),n.cache.compiledFunc=f}o=t.executeFunction(f,l)}else l&&(o=l[u]);const p=n.normalizationField,_=l?parseFloat(l[p]):void 0;if(null!=o&&(!p||s||!isNaN(_)&&0!==_)){isNaN(_)||s||(o/=_);const e=S(o,h);if(e){const t=e[0],r=e[1];if(t===r)return n.stops[t].opacity;{const a=n.stops[t].opacity;return a+(n.stops[r].opacity-a)*e[2]}}}}function g(e,t,r){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"rotation"===e.type)[0]:e;if(!n)return;if("esri.renderers.visualVariables.RotationVariable"!==n.declaredClass)return void c.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=n.axis||"heading",i="heading"===s&&"arithmetic"===n.rotationType?90:0,l="heading"===s&&"arithmetic"===n.rotationType?-1:1,o="number"==typeof t?null:t,u=o&&o.attributes,h=n.field,{hasExpression:d}=n.cache;let f=n.cache.compiledFunc,p=0;if(!h&&!d)return p;if(d){if(Object(a["g"])(r)||Object(a["g"])(r.arcade))return void c.error("Use of arcade expressions requires an arcade context");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,s=t.getViewInfo(e),i=t.createExecContext(o,s);if(!f){const e=t.createSyntaxTree(n.valueExpression);f=t.createFunction(e),n.cache.compiledFunc=f}p=t.executeFunction(f,i)}else u&&(p=u[h]||0);return p="number"!=typeof p||isNaN(p)?null:i+l*p,p}function m(e,t,r){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(e=>"size"===e.type)[0]:e;if(!n)return;if("esri.renderers.visualVariables.SizeVariable"!==n.declaredClass)return void c.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=w(function(e,t,r){const n="number"==typeof t,s=n?null:t,i=s&&s.attributes;let l=n?t:null;const{isScaleDriven:o}=e.cache;let h=e.cache.compiledFunc;if(o){const t=Object(a["h"])(r)?r.scale:void 0,n=Object(a["h"])(r)?r.view:void 0;l=null==t||"3d"===n?function(e){let t=null,r=null;const n=e.stops;return n?(t=n[0].value,r=n[n.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):t}else if(!n)switch(e.inputValueType){case"expression":{if(Object(a["g"])(r)||Object(a["g"])(r.arcade))return void c.error("Use of arcade expressions requires an arcade context");const t={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},n=r.arcade.arcadeUtils,i=n.getViewInfo(t),o=n.createExecContext(s,i);if(!h){const t=n.createSyntaxTree(e.valueExpression);h=n.createFunction(t),e.cache.compiledFunc=h}l=n.executeFunction(h,o);break}case"field":i&&(l=i[e.field]);break;case"unknown":l=null}if(!Object(u["d"])(l))return null;if(n||!e.normalizationField)return l;const d=i?parseFloat(i[e.normalizationField]):null;return Object(u["d"])(d)&&0!==d?l/d:null}(n,t,r),n,t,r,n.cache.ipData);return null==s||isNaN(s)?0:s}function y(e,t,r){return null==e?null:Object(u["c"])(e)?m(e,t,r):Object(u["d"])(e)?e:null}function b(e,t,r){return Object(u["d"])(r)&&e>r?r:Object(u["d"])(t)&&e<t?t:e}function w(e,t,r,n,s){switch(t.transformationType){case"additive":return function(e,t,r,n){return e+(y(t.minSize,r,n)||t.minDataValue)}(e,t,r,n);case"constant":return function(e,t,r){const n=e.stops;let a=n&&n.length&&n[0].size;return null==a&&(a=e.minSize),y(a,t,r)}(t,r,n);case"clamped-linear":return function(e,t,r,n){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),i=y(t.minSize,r,n),l=y(t.maxSize,r,n),o=Object(a["h"])(n)?n.shape:void 0;if(e<=t.minDataValue)return i;if(e>=t.maxDataValue)return l;if("area"===t.scaleBy&&o){const e="circle"===o,t=e?d*Math.pow(i/2,2):i*i,r=t+s*((e?d*Math.pow(l/2,2):l*l)-t);return e?2*Math.sqrt(r/d):Math.sqrt(r)}return i+s*(l-i)}(e,t,r,n);case"proportional":return function(e,t,r,n){const s=Object(a["h"])(n)?n.shape:void 0,i=e/t.minDataValue,l=y(t.minSize,r,n),o=y(t.maxSize,r,n);let u=null;return u="circle"===s?2*Math.sqrt(i*Math.pow(l/2,2)):"square"===s||"diamond"===s||"image"===s?Math.sqrt(i*Math.pow(l,2)):i*l,b(u,l,o)}(e,t,r,n);case"stops":return function(e,t,r,n,a){const[s,i,l]=S(e,a);if(s===i)return y(t.stops[s].size,r,n);{const e=y(t.stops[s].size,r,n);return e+(y(t.stops[i].size,r,n)-e)*l}}(e,t,r,n,s);case"real-world-size":return function(e,t,r,n){const s=(Object(a["h"])(n)&&n.resolution?n.resolution:1)*o["a"][t.valueUnit],i=y(t.minSize,r,n),l=y(t.maxSize,r,n),{valueRepresentation:u}=t;let c=null;return c="area"===u?2*Math.sqrt(e/d)/s:"radius"===u||"distance"===u?2*e/s:e/s,b(c,i,l)}(e,t,r,n);case"identity":return e;case"unknown":return null}}function v(e,t,r){const{isScaleDriven:n}=e.cache;if(!(n&&"3d"===r||t))return null;const a={scale:t,view:r};let s=y(e.minSize,h,a),i=y(e.maxSize,h,a);if(null!=s||null!=i){if(s>i){const e=i;i=s,s=e}return{minSize:s,maxSize:i}}}function S(e,t){if(!t)return;let r=0,n=t.length-1;return t.some((t,a)=>e<t?(n=a,!0):(r=a,!1)),[r,n,(e-t[r])/(t[n]-t[r])]}function F(e,t,r){const a=["proportional","proportional","proportional"];for(const s of e){const e=s.useSymbolValue?"symbol-value":m(s,t,r);switch(s.axis){case"width":a[0]=e;break;case"depth":a[1]=e;break;case"height":a[2]=e;break;case"width-and-depth":a[0]=e,a[1]=e;break;case"all":case void 0:case null:a[0]=e,a[1]=e,a[2]=e;break;default:Object(n["a"])(s.axis)}}return a}},e335:function(e,t,r){"use strict";r.r(t),r.d(t,"constructAssociationMetaDataFeatureSetFromUrl",(function(){return X})),r.d(t,"constructFeatureSet",(function(){return $})),r.d(t,"constructFeatureSetFromPortalItem",(function(){return le})),r.d(t,"constructFeatureSetFromRelationship",(function(){return ee})),r.d(t,"constructFeatureSetFromUrl",(function(){return K})),r.d(t,"createFeatureSetCollectionFromMap",(function(){return ne})),r.d(t,"createFeatureSetCollectionFromService",(function(){return ae})),r.d(t,"getPortal",(function(){return se})),r.d(t,"initialiseMetaDataCache",(function(){return Q})),r.d(t,"lookupUser",(function(){return ie}));var n=r("f4cc"),a=r("f7be"),s=r("2eab"),i=r("0224"),l=r("a7e1"),o=r("853c"),u=r("94dc"),c=r("1fbd"),h=r("66a2"),d=r("9c2d"),f=r("5db9"),p=r("5996"),_=r("8d60"),g=r("89da"),m=r("a1f3"),y=r("64fc"),b=r("07c7"),w=r("b1dc"),v=r("80b7"),S=r("4f73"),F=r("2cad"),I=r("96af");class O{clone(){const e=new O;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e}static parseStatField(e,t,r){const n=new O;n.field=e;const a=h["WhereClause"].create(t,r),s=function(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");const t=h["WhereClause"].create(Object(b["j"])(e.parseTree.args.value[0],o["a"].Standardised,e.parameters),e.fieldsIndex);return{name:e.parseTree.name,expr:t}}return null}(a);if(null===s)throw new Error("Invalid Statistic Function");const i=s.name.toUpperCase().trim();if("MIN"===i){if(n.typeofstat="MIN",n.workingexpr=s.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===i){if(n.typeofstat="MAX",n.workingexpr=s.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===i)n.typeofstat="COUNT",n.workingexpr=s.expr;else if("STDEV"===i){if(n.typeofstat="STDDEV",n.workingexpr=s.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===i){if(n.typeofstat="SUM",n.workingexpr=s.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===i){if(n.typeofstat="AVG",n.workingexpr=s.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}else if("AVG"===i){if(n.typeofstat="AVG",n.workingexpr=s.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}else{if("VAR"!==i)throw new Error("Invalid Statistic Function");if(n.typeofstat="VAR",n.workingexpr=s.expr,null===a)throw new Error("Invalid Statistic Function Parameters")}return n}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg";default:return"count"}}}var T=O,x=r("7efa");function C(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class j extends S["a"]{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}_getSet(e){return null===this._wset?this._getFilteredSet("",null,null,null,e).then(e=>(this._wset=e,this._wset)):Object(n["u"])(this._wset)}_isInFeatureSet(){return o["b"].InFeatureSet}nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t}convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,r=1;const n=this._parent?this._parent.getFieldsIndex():new v["a"]([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let e=!1;for(let t=0;t<this._config.groupbyfields.length;t++)if(this._config.groupbyfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}if(!1===e)for(let t=0;t<this._config.statsfields.length;t++)if(this._config.statsfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}!1===e?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}for(const s of this._config.statsfields){const e=new T;e.field=s.name,e.tofieldname=s.name,e.workingexpr=s.expression instanceof h["WhereClause"]?s.expression:h["WhereClause"].create(s.expression,n),e.typeofstat=C(s.statistic),this._decodedStatsfield.push(e)}this._decodedGroupbyfield=[];for(const s of this._config.groupbyfields){const e={name:s.name,singlefield:null,tofieldname:s.name,expression:s.expression instanceof h["WhereClause"]?s.expression:h["WhereClause"].create(s.expression,n)};this._decodedGroupbyfield.push(e)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const t of this._parent.fields)e[t.name.toUpperCase()]=1;this.types=null}else this.geometryType=o["m"].point,this.typeIdField="",this.types=null,this.spatialReference=new p["a"]({wkid:4326});this.fields=[];const a=new T;a.field=this.nextUniqueName(e),a.tofieldname=this.objectIdField,a.workingexpr=h["WhereClause"].create(this._parent.objectIdField,this._parent.getFieldsIndex()),a.typeofstat="MIN",this._decodedStatsfield.push(a);for(const s of this._decodedGroupbyfield){const t=new m["a"];if(s.name=this.nextUniqueName(e),t.name=s.tofieldname,t.alias=t.name,Object(b["c"])(s.expression)){const e=this._parent.getField(Object(b["i"])(s.expression,o["a"].Standardised));if(!e)throw new Error("Field is not present for Aggregation");s.name=e.name,s.singlefield=e.name,this.phsyicalgroupbyfields.push(e.name),t.type=e.type}else{t.type=this.convertToEsriFieldType(Object(b["f"])(s.expression,this._parent.fields));const e=new m["a"];e.name=s.name,e.alias=e.name,this.phsyicalgroupbyfields.push(s.name),this._adaptedFields.push(new F["d"](e,s.expression)),this._candosimplegroupby=!1}this.fields.push(t)}if(this._adaptedFields.length>0)for(const s of this._parent.fields)this._adaptedFields.push(new F["c"](s));for(let s=0;s<this._decodedStatsfield.length;s++){const t=new m["a"];let r=null;const n=this._decodedStatsfield[s];n.field=this.nextUniqueName(e),n.tofieldname===this.objectIdField&&(this._internalObjectIdField=n.field),t.name=n.tofieldname,t.alias=t.name;const a=null!==n.workingexpr&&Object(b["c"])(n.workingexpr)?Object(b["i"])(n.workingexpr,o["a"].Standardised):"";switch(this._decodedStatsfield[s].typeofstat){case"SUM":if(""!==a){if(r=this._parent.getField(a),!r)throw new Error("Field is not present for Aggregation");t.type=r.type}else t.type="double";break;case"MIN":case"MAX":if(""!==a){if(r=this._parent.getField(a),!r)throw new Error("Field is not present for Aggregation");t.type=r.type}else t.type="double";break;case"COUNT":t.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==a&&(r=this._parent.getField(a),!r))throw new Error("Field is not present for Aggregation");t.type="double"}this.fields.push(t)}}_canDoAggregates(){return Object(n["u"])(!1)}_getFeatures(e,t,r,a){-1!==t&&this._featureCache[t];const s=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(e,s)?this._expandPagedSet(e,s,0,0,a).then(()=>this._getFeatures(e,t,r,a)):Object(n["u"])("success")}_getFilteredSet(e,t,r,a,s){if(""!==e)return Object(n["u"])(new y["a"]([],[],!0,null));let i=null;const l={ordered:!1,nowhereclause:!1};return this._ensureLoaded().then(()=>{if(null!==r)for(let e=0;e<this._decodedStatsfield.length;e++)if(!0===Object(b["h"])(r,this._decodedStatsfield[e].tofieldname)){l.nowhereclause=!0,r=null;break}if(null!==a){l.ordered=!0;for(let e=0;e<this._decodedStatsfield.length;e++)if(!0===a.scanForField(this._decodedStatsfield[e].tofieldname)){a=null,l.ordered=!1;break}if(null!==a)for(const e of this._decodedGroupbyfield)if(null===e.singlefield&&!0===a.scanForField(e.tofieldname)){a=null,l.ordered=!1;break}}return!1===this._candosimplegroupby?Object(n["u"])(!1):this._parent._canDoAggregates(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,null)}).then(e=>{if(e){let e=null;r&&(e=this._reformulateWhereClauseWithoutGroupByFields(r));let t=null;return a&&(t=this._reformulateOrderClauseWithoutGroupByFields(a)),this._parent._getAggregatePagesDataSourceDefinition(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,e,t,this._internalObjectIdField).then(e=>(this._checkCancelled(s),i=!0===l.nowhereclause?new y["a"](e._candidates.slice(0).concat(e._known.slice(0)),[],!0===l.ordered&&e._ordered,this._clonePageDefinition(e.pagesDefinition)):new y["a"](e._candidates.slice(0),e._known.slice(0),!0===l.ordered&&e._ordered,this._clonePageDefinition(e.pagesDefinition)),i))}let t=this._parent;if(this._adaptedFields.length>0&&(t=new F["a"]({parentfeatureset:this._parent,adaptedFields:this._adaptedFields,extraFilter:null})),!0===l.nowhereclause)i=new y["a"](["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new f["a"]({parentfeatureset:t,orderbyclause:new I["a"](this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}});else{let e=t;if(null!==r){let t=null;r&&(t=this._reformulateWhereClauseWithoutGroupByFields(r)),e=new d["a"]({parentfeatureset:e,whereclause:t})}i=new y["a"](["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new f["a"]({parentfeatureset:e,orderbyclause:new I["a"](this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}})}return i})}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=Object(b["g"])(e,t.tofieldname,Object(b["i"])(t.workingexpr,o["a"].Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=Object(b["g"])(e,t.tofieldname,Object(b["i"])(t.expression,o["a"].Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const r of this._decodedGroupbyfield)r.tofieldname!==r.name&&t.push({field:r.tofieldname,newfield:r.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}_refineSetBlock(e,t,r){try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQuery))return this._expandPagedSet(e,this._maxQuery,0,0,r).then(()=>this._refineSetBlock(e,t,r));this._checkCancelled(r);e._candidates.length;return this._refineKnowns(e,t),e._candidates.length,e._candidates.length,Object(n["u"])(e)}catch(a){return Object(n["t"])(a)}}_expandPagedSet(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}_getPhysicalPage(e,t,r){return!0===e.pagesDefinition.aggregatefeaturesetpagedefinition?Object(n["c"])((t,n)=>{this._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]).then(e=>{t(e)},n)}):this._getAgregagtePhysicalPage(e,t,r).then(e=>{for(const t of e){const e={geometry:t.geometry,attributes:{}};for(const r of this._decodedGroupbyfield)e.attributes[r.tofieldname]=t.attributes[r.name];for(const r of this._decodedStatsfield)e.attributes[r.tofieldname]=t.attributes[r.field];this._featureCache[e.attributes[this.objectIdField]]=new _["a"](e)}return e.length})}_sequentialGetPhysicalItem(e,t,r,a){return Object(n["c"])((n,s)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?n(a.length):this._nextAggregateItem(e,t,r,a,s=>{null===s?n(a.length):(t-=1,n(this._sequentialGetPhysicalItem(e,t,r,a)))},s)})}_nextAggregateItem(e,t,r,n,a,s){try{Object(g["q"])(e.pagesDefinition.internal.iterator.next()).then(i=>{if(null===i)if(null!==e.pagesDefinition.internal.workingItem){const t=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(t),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(t.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,a(null)}else e.pagesDefinition.internal.fullyResolved=!0,a(null);else{const l=this._generateAggregateHash(i);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[i],id:l};else{if(l!==e.pagesDefinition.internal.workingItem.id){const r=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(r),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(r.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[i],id:l},void a(r)}e.pagesDefinition.internal.workingItem.features.push(i)}this._nextAggregateItem(e,t,r,n,a,s)}},s)}catch(e){s(e)}}_calculateFieldStat(e,t,r){const n=[];for(let a=0;a<e.features.length;a++)if(null!==t.workingexpr){const r=t.workingexpr.calculateValue(e.features[a]);null!==r&&n.push(r)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=Object(w["a"])("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=Object(w["a"])("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=Object(w["a"])("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=Object(w["a"])("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=Object(w["a"])("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=Object(w["a"])("avg",n,-1)}return!0}_calculateAndAppendAggregateItem(e){const t={attributes:{},geometry:null};for(const n of this._decodedGroupbyfield){const r=n.singlefield?e.features[0].attributes[n.singlefield]:n.expression.calculateValue(e.features[0]);t.attributes[n.tofieldname]=r}for(const n of this._decodedStatsfield)this._calculateFieldStat(e,n,t);const r=[];for(let n=0;n<this._decodedStatsfield.length;n++)r.push(this._calculateFieldStat(e,this._decodedStatsfield[n],t));return this._featureCache[t.attributes[this.objectIdField]]=new _["a"]({attributes:t.attributes,geometry:t.geometry}),t}_generateAggregateHash(e){let t="";for(const r of this._decodedGroupbyfield){const n=r.singlefield?e.attributes[r.singlefield]:r.expression.calculateValue(e);t+=null==n?":":":"+n.toString()}return Object(x["a"])(t,x["b"].String)}_stat(){return Object(n["u"])({calculated:!1})}getFeatureByObjectId(){return Object(n["u"])(null)}static registerAction(){S["a"]._featuresetFunctions.groupby=function(e,t){return new j({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}var E=j,N=r("8016"),D=r("60fd"),R=r("5bd5"),A=r("a9ab"),P=r("75bf"),k=r("6655"),L=r("f29a"),M=r("f3be"),G=r("c64f"),U=r("dd5c"),q=r("3341"),B=r("feec");class V extends S["a"]{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return o["f"]}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}convertQueryToLruCacheKey(e){const t=Object(o["q"])(e.toJSON());return Object(x["a"])(t,x["b"].String)}load(){return null===this._loadPromise&&(this._loadPromise=Object(n["c"])((e,t)=>{try{if(!0===this._layer.loaded)return this._initialiseFeatureSet(),void e(this);this._layer.when().then(()=>{try{this._initialiseFeatureSet(),e(this)}catch(e){t(e)}},t),this._layer.load()}catch(e){t(e)}})),this._loadPromise}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{const e=[];for(const t of this.fields)if("oid"===t.type)e.push(t);else for(const r of this._layer.outFields)if(r.toLowerCase()===t.name.toLowerCase()){e.push(t);break}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=o["a"].StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=o["a"].Standardised)):null!=e&&(e>=10.5&&(this._databaseType=o["a"].StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=o["a"].Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}_isInFeatureSet(){return o["b"].InFeatureSet}_refineSetBlock(e){return Object(n["u"])(e)}_candidateIdTransform(e){return e}_getSet(e){return null===this._wset?this._ensureLoaded().then(()=>this._getFilteredSet("",null,null,null,e)).then(e=>(this._wset=e,e)):Object(n["u"])(this._wset)}_runDatabaseProbe(e){return Object(n["c"])((t,r)=>{try{this._ensureLoaded().then(()=>{try{const n=new G["a"];n.where=e.replace("OBJECTID",this._layer.objectIdField),this._layer.queryObjectIds(n).then(()=>{t(!0)},()=>{try{t(!1)}catch(t){r(t)}})}catch(t){r(t)}})}catch(t){r(t)}})}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode}queryPBF(e){return e.quantizationParameters={mode:"edit"},Object(q["executeQueryPBF"])(this._layer.parsedUrl,e,new U["b"]({})).then(e=>L["default"].fromJSON(Object(k["j"])(e.data)).unquantize())}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion?this._layer.gdbVersion:"SDE.DEFAULT":""}nativeCapabilities(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(e,t){const r=new B["a"]({url:this._layer.parsedUrl.path}),n="execute"===t&&this.pbfSupportedForQuery(e);let a=null;if(this.recentlyUsedQueries){const s=this.convertQueryToLruCacheKey(e);a=this.recentlyUsedQueries.getFromCache(s),null===a&&(a=!0!==n?r[t](e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(s,a),a=a.catch(e=>{throw this.recentlyUsedQueries.removeFromCache(s),e}))}return null===a&&(a=!0!==n?r[t](e):this.queryPBF(e)),a}_getFilteredSet(e,t,r,n,a){return this.databaseType().then(s=>{if(this.isTable()&&t&&null!==e&&""!==e)return new y["a"]([],[],!0,null);if(this._canUsePagination())return this._getFilteredSetUsingPaging(e,t,r,n,a);let i="",l=!1;null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(i=n.constructClause(),l=!0);const o=new G["a"];return o.where=null===r?null===t?"1=1":"":Object(b["i"])(r,s),this._requestStandardised&&(o.sqlFormat="standard"),o.spatialRelationship=this._makeRelationshipEnum(e),o.outSpatialReference=this.spatialReference,o.orderByFields=""!==i?i.split(","):null,o.geometry=null===t?null:t,o.relationParameter=this._makeRelationshipParam(e),this.executeQuery(o,"executeForIds").then(e=>(null===e&&(e=[]),this._checkCancelled(a),new y["a"]([],e,l,null)))})}_expandPagedSet(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}_getFilteredSetUsingPaging(e,t,r,a,s){try{let n="",i=!1;return null!==a&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(n=a.constructClause(),i=!0),this.databaseType().then(a=>{let l=null===r?null===t?"1=1":"":Object(b["i"])(r,a);this._layer.definitionExpression&&(l=""!==l?"(("+this._layer.definitionExpression+") AND ("+l+"))":this._layer.definitionExpression);let o=this._maxQueryRate();const u=this._layer.capabilities.query.maxRecordCount;void 0!==u&&u<o&&(o=u);let c=null;if(!0===this._pageJustIds)c=new y["a"]([],["GETPAGES"],i,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:this._layer.objectIdField,resultRecordCount:o,resultOffset:0,geometry:null===t?null:t,where:l,orderByFields:n,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let r=!0;!0===this._removeGeometry&&(r=!1);const a=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]);c=new y["a"]([],["GETPAGES"],i,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:a.join(","),resultRecordCount:o,resultOffset:0,geometry:null===t?null:t,where:l,orderByFields:n,returnGeometry:r,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return this._expandPagedSet(c,o,0,1,s).then(()=>c)})}catch(e){return Object(n["t"])(e)}}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){try{const t=e.pagesDefinition.internal.lastRetrieved,n=t,a=e.pagesDefinition.internal.lastPage,s=new G["a"];return this._requestStandardised&&(s.sqlFormat="standard"),s.spatialRelationship=e.pagesDefinition.spatialRel,s.relationParameter=e.pagesDefinition.relationParam,s.outFields=e.pagesDefinition.outFields.split(","),s.num=e.pagesDefinition.resultRecordCount,s.start=e.pagesDefinition.internal.lastPage,s.geometry=e.pagesDefinition.geometry,s.where=e.pagesDefinition.where,s.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,s.returnGeometry=e.pagesDefinition.returnGeometry,s.outSpatialReference=this.spatialReference,this.executeQuery(s,"execute").then(s=>{if(this._checkCancelled(r),e.pagesDefinition.internal.lastPage!==a)return"done";for(let t=0;t<s.features.length;t++)e.pagesDefinition.internal.set[n+t]=s.features[t].attributes[this._layer.objectIdField];if(!1===this._pageJustIds)for(let e=0;e<s.features.length;e++)this._featureCache[s.features[e].attributes[this._layer.objectIdField]]=s.features[e];return(void 0===s.exceededTransferLimit&&s.features.length!==e.pagesDefinition.resultRecordCount||!1===s.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=t+s.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"})}catch(e){return Object(n["t"])(e)}}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.indexOf("*")>-1)return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFeatures(e,t,r,a){const s=[];try{if(-1!==t&&void 0===this._featureCache[t]&&s.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate()))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,a).then(()=>this._getFeatures(e,t,r,a));let i=0;for(let n=e._lastFetchedIndex;n<e._known.length;n++){if(e._lastFetchedIndex+=1,i++,void 0===this._featureCache[e._known[n]]){let r=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){const t=this._layer._mode;if(void 0!==t._featureMap[e._known[n]]){const a=t._featureMap[e._known[n]];null!==a&&(r=!0,this._featureCache[e._known[n]]=a)}}if(!1===r&&(e._known[n]!==t&&s.push(e._known[n]),s.length>=this._maxProcessingRate()-1))break}if(i>=r&&0===s.length)break}if(0===s.length)return Object(n["u"])("success");try{const e=new G["a"];return this._requestStandardised&&(e.sqlFormat="standard"),e.objectIds=s,e.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),e.returnGeometry=!0,!0===this._removeGeometry&&(e.returnGeometry=!1),e.outSpatialReference=this.spatialReference,this.executeQuery(e,"execute").then(e=>{if(this._checkCancelled(a),void 0!==e.error)return Object(n["t"])(new Error(e.error));for(let t=0;t<e.features.length;t++)this._featureCache[e.features[t].attributes[this._layer.objectIdField]]=e.features[t];return"success"})}catch(e){return Object(n["t"])(e)}}catch(e){return Object(n["t"])(e)}}_getDistinctPages(e,t,r,a,s,i,l,o,u){return this._ensureLoaded().then(()=>this.databaseType()).then(c=>{let h=r.parseTree.column;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name.toLowerCase()===h.toLowerCase()){h=this._layer.fields[e].name;break}const d=new G["a"];this._requestStandardised&&(d.sqlFormat="standard");let f=null===i?null===s?"1=1":"":Object(b["i"])(i,c);return this._layer.definitionExpression&&(f=""!==f?"(("+this._layer.definitionExpression+") AND ("+f+"))":this._layer.definitionExpression),d.where=f,d.spatialRelationship=this._makeRelationshipEnum(a),d.relationParameter=this._makeRelationshipParam(a),d.geometry=null===s?null:s,d.returnDistinctValues=!0,d.returnGeometry=!1,d.outFields=[h],this.executeQuery(d,"execute").then(c=>{if(this._checkCancelled(u),!c.hasOwnProperty("features"))return Object(n["t"])(new Error("Unnexected Result querying statistics from layer"));let d=!1;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name===h){"date"===this._layer.fields[e].type&&(d=!0);break}for(let e=0;e<c.features.length;e++){if(d){const t=c.features[e].attributes[h];null!==t?o.push(new Date(t)):o.push(t)}else o.push(c.features[e].attributes[h]);if(o.length>=l)break}return 0===c.features.length?o:c.features.length===this._layer.capabilities.query.maxRecordCount&&o.length<l?this._getDistinctPages(e+c.features.length,t,r,a,s,i,l,o,u).then(e=>({calculated:!0,result:e})):o})})}_distinctStat(e,t,r,n,a,s,i){return this._getDistinctPages(0,e,t,r,n,a,s,[],i).then(e=>({calculated:!0,result:e}))}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType}_countstat(e,t,r,n){return this.databaseType().then(e=>{const a=new G["a"];if(this._requestStandardised&&(a.sqlFormat="standard"),this.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};let s=null===n?null===r?"1=1":"":Object(b["i"])(n,e);return this._layer.definitionExpression&&(s=""!==s?"(("+this._layer.definitionExpression+") AND ("+s+"))":this._layer.definitionExpression),a.where=s,a.where=s,a.spatialRelationship=this._makeRelationshipEnum(t),a.relationParameter=this._makeRelationshipParam(t),a.geometry=null===r?null:r,a.returnGeometry=!1,this.executeQuery(a,"executeForCount").then(e=>({calculated:!0,result:e}))})}_stats(e,t,r,a,s,i,l){return this._ensureLoaded().then(()=>{const o=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,u=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics,c=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsDistinct;return"count"===e?c?this._countstat(e,r,a,s):{calculated:!1}:!1===u||!1===Object(b["c"])(t)&&!1===o||!1===t.isStandardized?""!==r||null!==s?{calculated:!1}:this._manualStat(e,t,i,l):"distinct"===e?!1===c?""!==r||null!==s?{calculated:!1}:this._manualStat(e,t,i,l):this._distinctStat(e,t,r,a,s,i,l):this.databaseType().then(i=>{if(this.isTable()&&a&&null!==r&&""!==r)return{calculated:!0,result:null};const l=new G["a"];this._requestStandardised&&(l.sqlFormat="standard");let o=null===s?null===a?"1=1":"":Object(b["i"])(s,i);this._layer.definitionExpression&&(o=""!==o?"(("+this._layer.definitionExpression+") AND ("+o+"))":this._layer.definitionExpression),l.where=o,l.spatialRelationship=this._makeRelationshipEnum(r),l.relationParameter=this._makeRelationshipParam(r),l.geometry=null===a?null:a;const u=new M["a"];u.statisticType=Object(w["c"])(e),u.onStatisticField=Object(b["i"])(t,i),u.outStatisticFieldName="ARCADE_STAT_RESULT",l.returnGeometry=!1;let c="ARCADE_STAT_RESULT";return l.outStatistics=[u],this.executeQuery(l,"execute").then(e=>{if(!e.hasOwnProperty("features")||0===e.features.length)return Object(n["t"])(new Error("Unnexected Result querying statistics from layer"));let t=!1;for(let r=0;r<e.fields.length;r++)if("ARCADE_STAT_RESULT"===e.fields[r].name.toUpperCase()){c=e.fields[r].name,"date"===e.fields[r].type&&(t=!0);break}if(t){let t=e.features[0].attributes[c];return null!==t&&(t=new Date(e.features[0].attributes[c])),{calculated:!0,result:t}}return{calculated:!0,result:e.features[0].attributes[c]}})})})}_stat(e,t,r,n,a,s,i){return this._stats(e,t,r,n,a,s,i)}_canDoAggregates(e,t){return this._ensureLoaded().then(()=>{let e=!1;const r=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression;if(void 0!==this._layer.capabilities&&null!==this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics&&!0===this._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(let n=0;n<t.length-1;n++)null!==t[n].workingexpr&&(!1===t[n].workingexpr.isStandardized||!1===Object(b["c"])(t[n].workingexpr)&&!1===r)&&(e=!1);return!1!==e})}_makeRelationshipEnum(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""}_getAggregatePagesDataSourceDefinition(e,t,r,n,a,s,i){return this._ensureLoaded().then(()=>this.databaseType()).then(l=>{let o="",u=!1,c=!1;null!==s&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(o=s.constructClause(),c=!0),this._layer.capabilities&&this._layer.capabilities.query&&!1===this._layer.capabilities.query.supportsPagination&&(c=!1,u=!0,o=this._layer.objectIdField);const h=[];for(let e=0;e<t.length;e++){const r=new M["a"];r.onStatisticField=null!==t[e].workingexpr?Object(b["i"])(t[e].workingexpr,l):"",r.outStatisticFieldName=t[e].field,r.statisticType=t[e].toStatisticsName(),h.push(r)}""===o&&(o=e.join(","));let d=this._maxQueryRate();const f=this._layer.capabilities.query.maxRecordCount;void 0!==f&&f<d&&(d=f);let p=null===a?null===n?"1=1":"":Object(b["i"])(a,l);return this._layer.definitionExpression&&(p=""!==p?"(("+this._layer.definitionExpression+") AND ("+p+"))":this._layer.definitionExpression),new y["a"]([],["GETPAGES"],c,{groupbypage:!0,spatialRel:this._makeRelationshipEnum(r),relationParam:this._makeRelationshipParam(r),outFields:["*"],useOIDpagination:u,generatedOid:i,resultRecordCount:d,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:h,geometry:null===n?null:n,where:p,orderByFields:o,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})})}_getAgregagtePhysicalPage(e,t,r){try{let t=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(t=""!==t?"("+t+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());const a=e.pagesDefinition.internal.lastRetrieved,s=a,i=e.pagesDefinition.internal.lastPage,l=new G["a"];return this._requestStandardised&&(l.sqlFormat="standard"),l.where=t,l.spatialRelationship=e.pagesDefinition.spatialRel,l.relationParameter=e.pagesDefinition.relationParam,l.outFields=e.pagesDefinition.outFields,l.outStatistics=e.pagesDefinition.outStatistics,l.geometry=e.pagesDefinition.geometry,l.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,l.num=e.pagesDefinition.resultRecordCount,l.start=e.pagesDefinition.internal.lastPage,l.returnGeometry=e.pagesDefinition.returnGeometry,l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&l.geometry&&l.spatialRelationship?Object(n["u"])([]):this.executeQuery(l,"execute").then(t=>{if(this._checkCancelled(r),!t.hasOwnProperty("features"))return Object(n["t"])(new Error("Unnexected Result querying aggregates from layer"));const l=[];if(e.pagesDefinition.internal.lastPage!==i)return[];for(let r=0;r<t.features.length;r++)e.pagesDefinition.internal.set[s+r]=t.features[r].attributes[e.pagesDefinition.generatedOid];for(let e=0;e<t.features.length;e++)l.push(new _["a"]({attributes:t.features[e].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===t.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=t.features[t.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===t.exceededTransferLimit&&t.features.length!==e.pagesDefinition.resultRecordCount||!1===t.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+t.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,l})}catch(e){return Object(n["t"])(e)}}static create(e,t,r,n){const a=new R["default"]({url:e,outFields:null===t?["*"]:t});return new V({layer:a,spatialReference:r,lrucache:n})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return Object(o["i"])(this._layer.parsedUrl.path)}queryAttachments(e,t,r,a){if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){const n={objectIds:[e]};return(t&&t>0||r&&r>0)&&(n.size=[t&&t>0?t:0,r&&r>0?r:t+1]),a&&a.length>0&&(n.attachmentTypes=a),this._layer.queryAttachments(n).then(t=>{const r=[];return t&&t[e]&&t[e].forEach(t=>{const n=this._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+t.id.toString();r.push(new P["a"](t.id,t.name,t.contentType,t.size,n))}),r})}return Object(n["u"])([])}queryRelatedFeatures(e){const t={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields.join(","),returnGeometry:e.returnGeometry.toString()};return void 0!==e.resultOffset&&null!==e.resultOffset&&(t.resultOffset=e.resultOffset.toString()),void 0!==e.resultRecordCount&&null!==e.resultRecordCount&&(t.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(t.orderByFields=e.orderByFields.join(",")),e.objectIds.length>0&&(t.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(t.outSR=JSON.stringify(e.outSpatialReference.toJSON())),Object(s["default"])(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:t}).then(e=>{if(e.data){const t={},r=e.data;if(r&&r.relatedRecordGroups){const e=r.spatialReference;for(const n of r.relatedRecordGroups){const a=n.objectId,s=[];for(const t of n.relatedRecords){t.geometry&&(t.geometry.spatialReference=e);const r=new _["a"]({geometry:t.geometry?Object(A["a"])(t.geometry):null,attributes:t.attributes});s.push(r)}t[a]={features:s,exceededTransferLimit:!0===r.exceededTransferLimit}}}return t}return Object(n["t"])("Invalid Request")})}getFeatureByObjectId(e,t){const r=new B["a"]({url:this._layer.parsedUrl.path}),n=new G["a"];return n.outFields=t,n.returnGeometry=!1,n.outSpatialReference=this.spatialReference,n.where=this.objectIdField+"="+e.toString(),r.execute(n).then(e=>1===e.features.length?e.features[0]:null)}getIdentityUser(){return this.load().then(()=>{var e;const t=null==(e=a["b"])?void 0:e.findCredential(this._layer.url);return t?t.userId:null})}getOwningSystemUrl(){return this.load().then(()=>{var e;const t=null==(e=a["b"])?void 0:e.findServerInfo(this._layer.url);if(t)return Object(n["u"])(t.owningSystemUrl);let r=this._layer.url;const i=r.toLowerCase().indexOf("/rest/services");return r=i>-1?r.substring(0,i):r,r?(r+="/rest/info",Object(n["c"])((e,t)=>{Object(s["default"])(r,{query:{f:"json"}}).then(t=>{let r="";t.data&&t.data.owningSystemUrl&&(r=t.data.owningSystemUrl),e(r)},t=>{e("")})})):Object(n["u"])("")})}}var W=V,z=r("3802"),J=r("9fa3"),Y=class extends S["a"]{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,this.relatedLayer=null,this.relationship=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this.relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return o["f"]}end(){return this._layer}optimisePagingFeatureQueries(){}load(){return null===this._loadPromise&&(this._loadPromise=Object(n["c"])((e,t)=>{Object(n["b"])([this._layer.load(),this.relatedLayer.load()]).then(()=>{this._initialiseFeatureSet(),e(this)},t)})),this._loadPromise}nativeCapabilities(){return this.relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this.relatedLayer.objectIdField,this.globalIdField=this.relatedLayer.globalIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types}databaseType(){return this.relatedLayer.databaseType().then(()=>(this._databaseType=this.relatedLayer._databaseType,this._databaseType))}isTable(){return this.relatedLayer.isTable()}_isInFeatureSet(){return o["b"].InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){return null===this._wset?this._ensureLoaded().then(()=>this._getFilteredSet("",null,null,null,e)).then(e=>(this._wset=e,e)):Object(n["u"])(this._wset)}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new _["a"]({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,t,r,n,a){return this.databaseType().then(()=>{if(this.isTable()&&t&&null!==e&&""!==e)return new y["a"]([],[],!0,null);const s=this._layer.nativeCapabilities();if(!1===s.canQueryRelated)return new y["a"]([],[],!0,null);if(s.capabilities.queryRelated&&s.capabilities.queryRelated.supportsPagination)return this._getFilteredSetUsingPaging(e,t,r,n,a);let i="",l=!1;null!==n&&s.capabilities&&s.capabilities.queryRelated&&!0===s.capabilities.queryRelated.supportsOrderBy&&(i=n.constructClause(),l=!0);const o=new J["a"];o.objectIds=[this._findObjectId];const u=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this.relatedLayer.fields?this.relatedLayer.fields.map(e=>e.name):["*"]);o.outFields=u,o.relationshipId=this.relationship.id,o.where="1=1";let c=!0;return!0===this._removeGeometry&&(c=!1),o.returnGeometry=c,this._requestStandardised&&(o.sqlFormat="standard"),o.outSpatialReference=this.spatialReference,o.orderByFields=""!==i?i.split(","):null,s.source.queryRelatedFeatures(o).then(n=>{this._checkCancelled(a);const s=n[this._findObjectId]?n[this._findObjectId].features:[],i=[];for(let e=0;e<s.length;e++)this._featureCache[s[e].attributes[this._layer.objectIdField]]=s[e],i.push(s[e].attributes[this._layer.objectIdField]);const o=t&&null!==e&&""!==e,u=null!=r;return new y["a"](o||u?i:[],o||u?[]:i,l,null)})})}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.indexOf("*")>-1)return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFilteredSetUsingPaging(e,t,r,a,s){try{let n="",i=!1;const l=this._layer.nativeCapabilities();return null!==a&&l&&l.capabilities.queryRelated&&!0===l.capabilities.queryRelated.supportsOrderBy&&(n=a.constructClause(),i=!0),this.databaseType().then(()=>{let a=this._maxQueryRate();const o=l.capabilities.query.maxRecordCount;void 0!==o&&o<a&&(a=o);const u=t&&null!==e&&""!==e,c=null!=r;let h=null,d=!0;!0===this._removeGeometry&&(d=!1);const f=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this.relatedLayer.fields?this.relatedLayer.fields.map(e=>e.name):["*"]);return h=new y["a"](u||c?["GETPAGES"]:[],u||c?[]:["GETPAGES"],i,{outFields:f.join(","),resultRecordCount:a,resultOffset:0,objectIds:[this._findObjectId],where:"1=1",orderByFields:n,returnGeometry:d,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),this._expandPagedSet(h,a,0,0,s).then(()=>h)})}catch(e){return Object(n["t"])(e)}}_expandPagedSet(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){try{const t=e.pagesDefinition.internal.lastRetrieved,n=t,a=e.pagesDefinition.internal.lastPage,s=this._layer.nativeCapabilities(),i=new J["a"];return!0===this._requestStandardised&&(i.sqlFormat="standard"),i.relationshipId=this.relationship.id,i.objectIds=e.pagesDefinition.objectIds,i.resultOffset=e.pagesDefinition.internal.lastPage,i.resultRecordCount=e.pagesDefinition.resultRecordCount,i.outFields=e.pagesDefinition.outFields.split(","),i.where=e.pagesDefinition.where,i.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,i.returnGeometry=e.pagesDefinition.returnGeometry,i.outSpatialReference=this.spatialReference,s.source.queryRelatedFeatures(i).then(s=>{if(this._checkCancelled(r),e.pagesDefinition.internal.lastPage!==a)return 0;const i=s[this._findObjectId]?s[this._findObjectId].features:[];for(let t=0;t<i.length;t++)e.pagesDefinition.internal.set[n+t]=i[t].attributes[this._layer.objectIdField];for(let e=0;e<i.length;e++)this._featureCache[i[e].attributes[this._layer.objectIdField]]=i[e];const l=!s[this._findObjectId]||!1===s[this._findObjectId].exceededTransferLimit;return i.length!==e.pagesDefinition.resultRecordCount&&l&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=t+i.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,i.length})}catch(e){return Object(n["t"])(e)}}_getFeatures(e,t,r,a){const s=[];-1!==t&&void 0===this._featureCache[t]&&s.push(t);const i=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,i))return this._expandPagedSet(e,i,0,0,a).then(()=>this._getFeatures(e,t,r,a));let l=0;for(let n=e._lastFetchedIndex;n<e._known.length&&(l++,l<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[n]&&void 0===this._featureCache[e._known[n]]&&(e._known[n]!==t&&s.push(e._known[n]),s.length>r)))&&!(l>=r&&0===s.length);n++);return 0===s.length?Object(n["u"])("success"):Object(n["t"])(new Error("Unaccounted for Features. Not in Feature Collection"))}_refineSetBlock(e,t,r){return Object(n["u"])(e)}_stat(e,t,r,a,s,i,l){return Object(n["u"])({calculated:!1})}get gdbVersion(){return this.relatedLayer.gdbVersion}_canDoAggregates(e,t,r,a,s){return Object(n["u"])(!1)}relationshipMetaData(){return this.relatedLayer.relationshipMetaData()}serviceUrl(){return this.relatedLayer.serviceUrl()}queryAttachments(e,t,r,n){return this.relatedLayer.queryAttachments(e,t,r,n)}getFeatureByObjectId(e,t){return this.relatedLayer.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this.relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this.relatedLayer.getIdentityUser()}};function Q(){null===c["a"].applicationCache&&(c["a"].applicationCache=new c["a"])}function H(e,t){if(c["a"].applicationCache){const r=c["a"].applicationCache.getLayerInfo(e);if(r)return r.then(r=>Object(n["u"])(new R["default"]({url:e,outFields:t,sourceJSON:r})));const a=new R["default"]({url:e,outFields:t});let s=Object(n["c"])((e,t)=>{a.load().then(()=>{e(a.sourceJSON)},e=>{t(e)})});return c["a"].applicationCache&&(c["a"].applicationCache.setLayerInfo(e,s),s=s.catch(t=>{throw c["a"].applicationCache.clearLayerInfo(e),t})),s.then(()=>Object(n["u"])(a))}return Object(n["u"])(new R["default"]({url:e,outFields:t}))}function K(e,t,r,a,s){return H(e,["*"]).then(e=>Object(n["u"])($(e,t,r,a,s)))}function $(e,t=null,r=null,n=!0,a=null){return!0===e._hasMemorySource()?new z["a"]({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a}):new W({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a})}function Z(e){if(null!==c["a"].applicationCache){const t=c["a"].applicationCache.getLayerInfo(e);if(null!==t)return t}let t=Object(s["default"])(e,{responseType:"json",query:{f:"json"}}).then(e=>{if(e.data){const t=e.data;return t.layers||(t.layers=[]),t.tables||(t.tables=[]),Object(n["u"])(t)}return Object(n["u"])({layers:[],tables:[]})});return null!==c["a"].applicationCache&&(c["a"].applicationCache.setLayerInfo(e,t),t=t.catch(t=>{throw c["a"].applicationCache.clearLayerInfo(e),t})),t}function X(e,t){const r={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null};return Z(e).then(a=>{if(r.metadata=a,a.controllerDatasetLayers&&void 0!==a.controllerDatasetLayers.utilityNetworkLayerId&&null!==a.controllerDatasetLayers.utilityNetworkLayerId){if(a.layers)for(const e of a.layers)r.layerNameLkp[e.id]=e.name;if(a.tables)for(const e of a.tables)r.layerNameLkp[e.id]=e.name;const i=a.controllerDatasetLayers.utilityNetworkLayerId;return r.networkId=i,function(e,t){const r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==c["a"].applicationCache){const e=c["a"].applicationCache.getLayerInfo(r);if(null!==e)return e}let n=Object(s["default"])(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}}).then(e=>{if(e.data){const t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error("Not Found")});return null!==c["a"].applicationCache&&(c["a"].applicationCache.setLayerInfo(r,n),n=n.catch(e=>{throw c["a"].applicationCache.clearLayerInfo(r),e})),n}(e,i).then(a=>{if(a){r.queryelem=a,r.queryelem&&r.queryelem.dataElement&&void 0!==r.queryelem.dataElement.schemaGeneration&&(r.unVersion=r.queryelem.dataElement.schemaGeneration),r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);for(const e of r.queryelem.dataElement.domainNetworks){for(const t of e.edgeSources?e.edgeSources:[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:r.layerNameLkp[t.layerId]?r.layerNameLkp[t.layerId]:null};e.className&&(r.lkp[e.className]=e)}for(const t of e.junctionSources?e.junctionSources:[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:r.layerNameLkp[t.layerId]?r.layerNameLkp[t.layerId]:null};e.className&&(r.lkp[e.className]=e)}}if(r.queryelem.dataElement.terminalConfigurations)for(const e of r.queryelem.dataElement.terminalConfigurations)for(const t of e.terminals)r.terminals.push({terminalId:t.terminalId,terminalName:t.terminalName});return function(e){if(null!==c["a"].applicationCache){const t=c["a"].applicationCache.getLayerInfo(e);if(null!==t)return t}let t=Object(s["default"])(e,{responseType:"json",query:{f:"json"}}).then(e=>{if(e.data){const t=e.data;return Object(n["u"])(t)}return Object(n["u"])(null)});return null!==c["a"].applicationCache&&(c["a"].applicationCache.setLayerInfo(e,t),t=t.catch(t=>{throw c["a"].applicationCache.clearLayerInfo(e),t})),t}(e+"/"+i).then(n=>{if(n.systemLayers&&void 0!==n.systemLayers.associationsTableId&&null!==n.systemLayers.associationsTableId){const a=[];return r.unVersion>=4&&(a.push("STATUS"),a.push("PERCENTALONG")),K(e+"/"+n.systemLayers.associationsTableId.toString(),t,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...a],!1,null).then(e=>e.load()).then(e=>r.unVersion>=4?(e=e.filter(h["WhereClause"].create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",e.getFieldsIndex()))).load():e).then(e=>({lkp:r.lkp,associations:e,unVersion:r.unVersion,terminals:r.terminals}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}})}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}})}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}})}function ee(e,t,r,n=null,a=null,s=!0,i=null){let l=e.serviceUrl();return l?(l="/"===l.charAt(l.length-1)?l+t.relatedTableId.toString():l+"/"+t.relatedTableId.toString(),K(l,n,a,s,i).then(l=>new Y({layer:e,relatedLayer:l,relationship:t,objectId:r,spatialReference:n,outFields:a,includeGeometry:s,lrucache:i}))):null}d["a"].registerAction(),E.registerAction(),f["a"].registerAction(),N["a"].registerAction(),D["a"].registerAction();class te extends u["a"]{constructor(e,t=null,r=null){super(),this._map=e,this._overridespref=t,this.lrucache=r,this._instantLayers=[]}makeAndAddFeatureSet(e,t=!0,r=null){const n=$(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}featureSetByName(e,t=!0,r=null){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then(()=>{try{return this.featureSetByName(e,t,r)}catch(e){return Object(n["t"])(e)}});null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const a=JSON.stringify(r);for(let n=0;n<this._instantLayers.length;n++){const r=this._instantLayers[n];if(r.opitem.title===e&&r.includeGeometry===t&&r.outFields===a)return this.resolvePromise(this._instantLayers[n].featureset)}const s=this._map.layers.find(t=>t instanceof R["default"]&&t.title===e);if(s)return this.resolvePromise(this.makeAndAddFeatureSet(s,t,r));if(this._map.tables){const n=this._map.tables.find(t=>!!(t.title&&t.title===e||t.title&&t.title===e));if(n){if(n instanceof R["default"])return this.resolvePromise(this.makeAndAddFeatureSet(n,t,r));if(n._materializedTable);else{const e=n.outFields?n:{...n,outFields:["*"]};n._materializedTable=new R["default"](e)}return n._materializedTable.load().then(()=>this.resolvePromise(this.makeAndAddFeatureSet(n._materializedTable,t,r)))}}return this.resolvePromise(null)}featureSetById(e,t=!0,r=["*"]){if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then(()=>{try{return this.featureSetById(e,t,r)}catch(e){return Object(n["t"])(e)}});null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const a=JSON.stringify(r);for(let n=0;n<this._instantLayers.length;n++){const r=this._instantLayers[n];if(r.opitem.id===e&&r.includeGeometry===t&&r.outFields===a)return this.resolvePromise(this._instantLayers[n].featureset)}const s=this._map.layers.find(t=>t instanceof R["default"]&&t.id===e);if(s)return this.resolvePromise(this.makeAndAddFeatureSet(s,t,r));if(this._map.tables){const n=this._map.tables.find(t=>t.id===e);if(n){if(n instanceof R["default"])return this.resolvePromise(this.makeAndAddFeatureSet(n,t,r));if(n._materializedTable);else{const e={...n,outFields:["*"]};n._materializedTable=new R["default"](e)}return n._materializedTable.load().then(()=>this.resolvePromise(this.makeAndAddFeatureSet(n._materializedTable,t,r)))}}return this.resolvePromise(null)}}class re extends u["a"]{constructor(e,t=null,r=null){super(),this._url=e,this._overridespref=t,this.lrucache=r,this.metadata=null,this._instantLayers=[]}get url(){return this._url}makeAndAddFeatureSet(e,t=!0,r=null){const n=$(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}_loadMetaData(){return Z(this._url).then(e=>(this.metadata=e,e))}load(){return this._loadMetaData()}clone(){return new re(this._url,this._overridespref,this.lrucache)}featureSetByName(e,t=!0,r=null){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const n=JSON.stringify(r);for(let a=0;a<this._instantLayers.length;a++){const r=this._instantLayers[a];if(r.opitem.title===e&&r.includeGeometry===t&&r.outFields===n)return this.resolvePromise(this._instantLayers[a].featureset)}return this._loadMetaData().then(n=>{let a=null;for(const t of n.layers?n.layers:[])t.name===e&&(a=t);if(!a)for(const t of n.tables?n.tables:[])t.name===e&&(a=t);return a?H(this._url+"/"+a.id,["*"]).then(e=>this.makeAndAddFeatureSet(e,t,r)):this.resolvePromise(null)})}featureSetById(e,t=!0,r=["*"]){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const n=JSON.stringify(r);e=null!=e?e.toString():"";for(let a=0;a<this._instantLayers.length;a++){const r=this._instantLayers[a];if(r.opitem.id===e&&r.includeGeometry===t&&r.outFields===n)return this.resolvePromise(this._instantLayers[a].featureset)}return this._loadMetaData().then(n=>{let a=null;for(const t of n.layers?n.layers:[])null!==t.id&&void 0!==t.id&&t.id.toString()===e&&(a=t);if(!a)for(const t of n.tables?n.tables:[])null!==t.id&&void 0!==t.id&&t.id.toString()===e&&(a=t);return a?H(this._url+"/"+a.id,["*"]).then(e=>this.makeAndAddFeatureSet(e,t,r)):this.resolvePromise(null)})}}function ne(e,t,r=null){return new te(e,t,r)}function ae(e,t,r=null){return new re(e,t,r)}function se(e,t){return null===e?t:new i["a"]({url:e.field("url")})}function ie(e,t,r){return a["b"].findCredential(e.restUrl)?"loaded"===e.loadStatus&&""===t&&e.user&&e.user.sourceJSON&&!1===r?Object(n["u"])(e.user.sourceJSON):""===t?Object(s["default"])(e.restUrl+"/community/self",{responseType:"json",query:{f:"json",...!1===r?{}:{returnUserLicenseTypeExtensions:!0}}}).then(e=>{if(e.data){const t=e.data;if(t&&t.username)return Object(n["u"])(t)}return Object(n["u"])(null)}):Object(s["default"])(e.restUrl+"/community/users/"+t,{responseType:"json",query:{f:"json"}}).then(e=>{if(e.data){const t=e.data;return t.error?null:Object(n["u"])(t)}return Object(n["u"])(null)}):Object(n["u"])(null)}function le(e,t,r,a,s,i,u){if(c["a"].applicationCache){const l=c["a"].applicationCache.getLayerInfo(e+":"+i.url);if(l)return l.then(e=>{try{const i=new R["default"]({url:Object(o["i"])(e.url)+"/"+t,outFields:["*"]});return Object(n["u"])($(i,r,a,s,u))}catch(i){return Object(n["t"])(i)}},e=>Object(n["t"])(e))}return Object(n["c"])((n,h)=>{const d=new l["default"]({id:e,portal:i}).load();c["a"].applicationCache&&c["a"].applicationCache.setLayerInfo(e+":"+i.url,d),d.then(e=>{try{const i=new R["default"]({url:Object(o["i"])(e.url)+"/"+t,outFields:["*"]});n($(i,r,a,s,u))}catch(n){h(n)}},t=>{c["a"].applicationCache&&c["a"].applicationCache.clearLayerInfo(e+":"+i.url),h(t)})})}}}]);